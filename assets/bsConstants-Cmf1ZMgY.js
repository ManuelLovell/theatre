(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();var v=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};class at{constructor(e){this.messageBus=e}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return v(this,void 0,void 0,function*(){const{selection:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return e})}select(e,t){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:e,replace:t})})}deselect(e){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:e})})}getName(){return v(this,void 0,void 0,function*(){const{name:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return e})}setName(e){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:e})})}getColor(){return v(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return e})}setColor(e){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:e})})}getSyncView(){return v(this,void 0,void 0,function*(){const{syncView:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return e})}setSyncView(e){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:e})})}getId(){return v(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return e})}getRole(){return v(this,void 0,void 0,function*(){const{role:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return e})}getMetadata(){return v(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return e})}setMetadata(e){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:e})})}hasPermission(e){return v(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:s}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return s.indexOf(e)>-1})}getConnectionId(){return v(this,void 0,void 0,function*(){const{connectionId:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return e})}onChange(e){const t=s=>{e(s.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",t)}}}var N=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};class ct{constructor(e){this.messageBus=e}reset(){return N(this,void 0,void 0,function*(){const{transform:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return e})}animateTo(e){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:e})})}animateToBounds(e){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:e})})}getPosition(){return N(this,void 0,void 0,function*(){const{position:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return e})}setPosition(e){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:e})})}getScale(){return N(this,void 0,void 0,function*(){const{scale:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return e})}setScale(e){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:e})})}getWidth(){return N(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return e})}getHeight(){return N(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return e})}transformPoint(e){return N(this,void 0,void 0,function*(){const{point:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:e});return t})}inverseTransformPoint(e){return N(this,void 0,void 0,function*(){const{point:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:e});return t})}}function dt(n){return typeof n.id=="string"}var me={exports:{}},W=typeof Reflect=="object"?Reflect:null,Le=W&&typeof W.apply=="function"?W.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)},q;W&&typeof W.ownKeys=="function"?q=W.ownKeys:Object.getOwnPropertySymbols?q=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:q=function(e){return Object.getOwnPropertyNames(e)};function lt(n){console&&console.warn&&console.warn(n)}var Ke=Number.isNaN||function(e){return e!==e};function _(){_.init.call(this)}me.exports=_;me.exports.once=Et;_.EventEmitter=_;_.prototype._events=void 0;_.prototype._eventsCount=0;_.prototype._maxListeners=void 0;var xe=10;function ie(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(_,"defaultMaxListeners",{enumerable:!0,get:function(){return xe},set:function(n){if(typeof n!="number"||n<0||Ke(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");xe=n}});_.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};_.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Ke(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function ze(n){return n._maxListeners===void 0?_.defaultMaxListeners:n._maxListeners}_.prototype.getMaxListeners=function(){return ze(this)};_.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var u;if(t.length>0&&(u=t[0]),u instanceof Error)throw u;var d=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw d.context=u,d}var l=o[e];if(l===void 0)return!1;if(typeof l=="function")Le(l,this,t);else for(var a=l.length,r=qe(l,a),s=0;s<a;++s)Le(r[s],this,t);return!0};function Xe(n,e,t,s){var i,o,u;if(ie(t),o=n._events,o===void 0?(o=n._events=Object.create(null),n._eventsCount=0):(o.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),o=n._events),u=o[e]),u===void 0)u=o[e]=t,++n._eventsCount;else if(typeof u=="function"?u=o[e]=s?[t,u]:[u,t]:s?u.unshift(t):u.push(t),i=ze(n),i>0&&u.length>i&&!u.warned){u.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=n,d.type=e,d.count=u.length,lt(d)}return n}_.prototype.addListener=function(e,t){return Xe(this,e,t,!1)};_.prototype.on=_.prototype.addListener;_.prototype.prependListener=function(e,t){return Xe(this,e,t,!0)};function ht(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ze(n,e,t){var s={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},i=ht.bind(s);return i.listener=t,s.wrapFn=i,i}_.prototype.once=function(e,t){return ie(t),this.on(e,Ze(this,e,t)),this};_.prototype.prependOnceListener=function(e,t){return ie(t),this.prependListener(e,Ze(this,e,t)),this};_.prototype.removeListener=function(e,t){var s,i,o,u,d;if(ie(t),i=this._events,i===void 0)return this;if(s=i[e],s===void 0)return this;if(s===t||s.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,s.listener||t));else if(typeof s!="function"){for(o=-1,u=s.length-1;u>=0;u--)if(s[u]===t||s[u].listener===t){d=s[u].listener,o=u;break}if(o<0)return this;o===0?s.shift():ft(s,o),s.length===1&&(i[e]=s[0]),i.removeListener!==void 0&&this.emit("removeListener",e,d||t)}return this};_.prototype.off=_.prototype.removeListener;_.prototype.removeAllListeners=function(e){var t,s,i;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var o=Object.keys(s),u;for(i=0;i<o.length;++i)u=o[i],u!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=s[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function Je(n,e,t){var s=n._events;if(s===void 0)return[];var i=s[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?_t(i):qe(i,i.length)}_.prototype.listeners=function(e){return Je(this,e,!0)};_.prototype.rawListeners=function(e){return Je(this,e,!1)};_.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):Qe.call(n,e)};_.prototype.listenerCount=Qe;function Qe(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}_.prototype.eventNames=function(){return this._eventsCount>0?q(this._events):[]};function qe(n,e){for(var t=new Array(e),s=0;s<e;++s)t[s]=n[s];return t}function ft(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function _t(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function Et(n,e){return new Promise(function(t,s){function i(u){n.removeListener(e,o),s(u)}function o(){typeof n.removeListener=="function"&&n.removeListener("error",i),t([].slice.call(arguments))}et(n,e,o,{once:!0}),e!=="error"&&yt(n,i,{once:!0})})}function yt(n,e,t){typeof n.on=="function"&&et(n,"error",e,t)}function et(n,e,t,s){if(typeof n.on=="function")s.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function i(o){s.once&&n.removeEventListener(e,i),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var Ot=me.exports;let X;const pt=new Uint8Array(16);function mt(){if(!X&&(X=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!X))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return X(pt)}const p=[];for(let n=0;n<256;++n)p.push((n+256).toString(16).slice(1));function vt(n,e=0){return p[n[e+0]]+p[n[e+1]]+p[n[e+2]]+p[n[e+3]]+"-"+p[n[e+4]]+p[n[e+5]]+"-"+p[n[e+6]]+p[n[e+7]]+"-"+p[n[e+8]]+p[n[e+9]]+"-"+p[n[e+10]]+p[n[e+11]]+p[n[e+12]]+p[n[e+13]]+p[n[e+14]]+p[n[e+15]]}const At=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),be={randomUUID:At};function tt(n,e,t){if(be.randomUUID&&!e&&!n)return be.randomUUID();n=n||{};const s=n.random||(n.rng||mt)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=s[i];return e}return vt(s)}class Tt extends Ot.EventEmitter{constructor(e,t){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=s=>{const i=s.data;if(s.origin===this.targetOrigin&&dt(i)){if(i.id==="OBR_READY"){this.ready=!0;const o=i.data;this.ref=o.ref,this.userId=o.userId}this.emit(i.id,i.data)}},this.send=(s,i,o)=>{var u;if(!this.ref)throw Error("Unable to send message: not ready");(u=window.parent)===null||u===void 0||u.postMessage({id:s,data:i,ref:this.ref,nonce:o},this.targetOrigin)},this.sendAsync=(s,i,o=5e3)=>{const u=`_${tt()}`;return this.send(s,i,u),Promise.race([new Promise((d,l)=>{const a=this;function r(f){a.off(`${s}_RESPONSE${u}`,r),a.off(`${s}_ERROR${u}`,c),d(f)}function c(f){a.off(`${s}_RESPONSE${u}`,r),a.off(`${s}_ERROR${u}`,c),l(f)}this.on(`${s}_RESPONSE${u}`,r),this.on(`${s}_ERROR${u}`,c)}),...o>0?[new Promise((d,l)=>window.setTimeout(()=>l(new Error(`Message ${s} took longer than ${o}ms to get a result`)),o))]:[]])},this.roomId=t,this.targetOrigin=e,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var De=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};class Bt{constructor(e){this.messageBus=e}show(e,t){return De(this,void 0,void 0,function*(){const{id:s}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:e,variant:t});return s})}close(e){return De(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:e})})}}var U=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};class gt{constructor(e){this.messageBus=e}getColor(){return U(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return e})}setColor(e){return U(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:e})})}getStrokeWidth(){return U(this,void 0,void 0,function*(){const{strokeWidth:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return e})}setStrokeWidth(e){return U(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:e})})}getFilled(){return U(this,void 0,void 0,function*(){const{filled:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return e})}setFilled(e){return U(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:e})})}onChange(e){const t=s=>{e(s.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",t)}}}var A=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};class Rt{constructor(e){this.messageBus=e}getDpi(){return A(this,void 0,void 0,function*(){const{dpi:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return e})}getScale(){return A(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(e){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:e})})}getColor(){return A(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return e})}setColor(e){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:e})})}getOpacity(){return A(this,void 0,void 0,function*(){const{opacity:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return e})}setOpacity(e){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:e})})}getType(){return A(this,void 0,void 0,function*(){const{type:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return e})}setType(e){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:e})})}getLineType(){return A(this,void 0,void 0,function*(){const{lineType:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return e})}setLineType(e){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:e})})}getMeasurement(){return A(this,void 0,void 0,function*(){const{measurement:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return e})}setMeasurement(e){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:e})})}snapPosition(e,t,s,i){return A(this,void 0,void 0,function*(){const{position:o}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:e,snappingSensitivity:t,useCorners:s,useCenter:i});return o})}getDistance(e,t){return A(this,void 0,void 0,function*(){const{distance:s}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:e,to:t});return s})}onChange(e){const t=s=>{e(s.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",t)}}}var Z=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};class Ct{constructor(e){this.messageBus=e}undo(){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return Z(this,void 0,void 0,function*(){const{canUndo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return e})}canRedo(){return Z(this,void 0,void 0,function*(){const{canRedo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return e})}}function m(n){for(var e=arguments.length,t=Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];throw Error("[Immer] minified error nr: "+n+(t.length?" "+t.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function P(n){return!!n&&!!n[C]}function L(n){var e;return!!n&&(function(t){if(!t||typeof t!="object")return!1;var s=Object.getPrototypeOf(t);if(s===null)return!0;var i=Object.hasOwnProperty.call(s,"constructor")&&s.constructor;return i===Object||typeof i=="function"&&Function.toString.call(i)===bt}(n)||Array.isArray(n)||!!n[F]||!!(!((e=n.constructor)===null||e===void 0)&&e[F])||oe(n)||re(n))}function j(n,e,t){t===void 0&&(t=!1),x(n)===0?(t?Object.keys:Ce)(n).forEach(function(s){t&&typeof s=="symbol"||e(s,n[s],n)}):n.forEach(function(s,i){return e(i,s,n)})}function x(n){var e=n[C];return e?e.i>3?e.i-4:e.i:Array.isArray(n)?1:oe(n)?2:re(n)?3:0}function K(n,e){return x(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function ee(n,e){return x(n)===2?n.get(e):n[e]}function nt(n,e,t){var s=x(n);s===2?n.set(e,t):s===3?n.add(t):n[e]=t}function St(n,e){return n===e?n!==0||1/n==1/e:n!=n&&e!=e}function oe(n){return Lt&&n instanceof Map}function re(n){return xt&&n instanceof Set}function b(n){return n.o||n.t}function ve(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var e=Dt(n);delete e[C];for(var t=Ce(e),s=0;s<t.length;s++){var i=t[s],o=e[i];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(e[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:n[i]})}return Object.create(Object.getPrototypeOf(n),e)}function Ae(n,e){return e===void 0&&(e=!1),Te(n)||P(n)||!L(n)||(x(n)>1&&(n.set=n.add=n.clear=n.delete=It),Object.freeze(n),e&&j(n,function(t,s){return Ae(s,!0)},!0)),n}function It(){m(2)}function Te(n){return n==null||typeof n!="object"||Object.isFrozen(n)}function M(n){var e=ye[n];return e||m(18,n),e}function Nt(n,e){ye[n]||(ye[n]=e)}function Pe(){return z}function ue(n,e){e&&(M("Patches"),n.u=[],n.s=[],n.v=e)}function te(n){fe(n),n.p.forEach(wt),n.p=null}function fe(n){n===z&&(z=n.l)}function Ge(n){return z={p:[],l:z,h:n,m:!0,_:0}}function wt(n){var e=n[C];e.i===0||e.i===1?e.j():e.g=!0}function ae(n,e){e._=e.p.length;var t=e.p[0],s=n!==void 0&&n!==t;return e.h.O||M("ES5").S(e,n,s),s?(t[C].P&&(te(e),m(4)),L(n)&&(n=ne(e,n),e.l||se(e,n)),e.u&&M("Patches").M(t[C].t,n,e.u,e.s)):n=ne(e,t,[]),te(e),e.u&&e.v(e.u,e.s),n!==Re?n:void 0}function ne(n,e,t){if(Te(e))return e;var s=e[C];if(!s)return j(e,function(d,l){return Ue(n,s,e,d,l,t)},!0),e;if(s.A!==n)return e;if(!s.P)return se(n,s.t,!0),s.t;if(!s.I){s.I=!0,s.A._--;var i=s.i===4||s.i===5?s.o=ve(s.k):s.o,o=i,u=!1;s.i===3&&(o=new Set(i),i.clear(),u=!0),j(o,function(d,l){return Ue(n,s,i,d,l,t,u)}),se(n,i,!1),t&&n.u&&M("Patches").N(s,t,n.u,n.s)}return s.o}function Ue(n,e,t,s,i,o,u){if(P(i)){var d=ne(n,i,o&&e&&e.i!==3&&!K(e.R,s)?o.concat(s):void 0);if(nt(t,s,d),!P(d))return;n.m=!1}else u&&t.add(i);if(L(i)&&!Te(i)){if(!n.h.D&&n._<1)return;ne(n,i),e&&e.A.l||se(n,i)}}function se(n,e,t){t===void 0&&(t=!1),!n.l&&n.h.D&&n.m&&Ae(e,t)}function ce(n,e){var t=n[C];return(t?b(t):n)[e]}function Ve(n,e){if(e in n)for(var t=Object.getPrototypeOf(n);t;){var s=Object.getOwnPropertyDescriptor(t,e);if(s)return s;t=Object.getPrototypeOf(t)}}function _e(n){n.P||(n.P=!0,n.l&&_e(n.l))}function de(n){n.o||(n.o=ve(n.t))}function Ee(n,e,t){var s=oe(e)?M("MapSet").F(e,t):re(e)?M("MapSet").T(e,t):n.O?function(i,o){var u=Array.isArray(i),d={i:u?1:0,A:o?o.A:Pe(),P:!1,I:!1,R:{},l:o,t:i,k:null,o:null,j:null,C:!1},l=d,a=Oe;u&&(l=[d],a=Y);var r=Proxy.revocable(l,a),c=r.revoke,f=r.proxy;return d.k=f,d.j=c,f}(e,t):M("ES5").J(e,t);return(t?t.A:Pe()).p.push(s),s}function Mt(n){return P(n)||m(22,n),function e(t){if(!L(t))return t;var s,i=t[C],o=x(t);if(i){if(!i.P&&(i.i<4||!M("ES5").K(i)))return i.t;i.I=!0,s=ke(t,o),i.I=!1}else s=ke(t,o);return j(s,function(u,d){i&&ee(i.t,u)===d||nt(s,u,e(d))}),o===3?new Set(s):s}(n)}function ke(n,e){switch(e){case 2:return new Map(n);case 3:return Array.from(n)}return ve(n)}function Be(){function n(s){if(!L(s))return s;if(Array.isArray(s))return s.map(n);if(oe(s))return new Map(Array.from(s.entries()).map(function(u){return[u[0],n(u[1])]}));if(re(s))return new Set(Array.from(s).map(n));var i=Object.create(Object.getPrototypeOf(s));for(var o in s)i[o]=n(s[o]);return K(s,F)&&(i[F]=s[F]),i}function e(s){return P(s)?n(s):s}var t="add";Nt("Patches",{$:function(s,i){return i.forEach(function(o){for(var u=o.path,d=o.op,l=s,a=0;a<u.length-1;a++){var r=x(l),c=u[a];typeof c!="string"&&typeof c!="number"&&(c=""+c),r!==0&&r!==1||c!=="__proto__"&&c!=="constructor"||m(24),typeof l=="function"&&c==="prototype"&&m(24),typeof(l=ee(l,c))!="object"&&m(15,u.join("/"))}var f=x(l),h=n(o.value),E=u[u.length-1];switch(d){case"replace":switch(f){case 2:return l.set(E,h);case 3:m(16);default:return l[E]=h}case t:switch(f){case 1:return E==="-"?l.push(h):l.splice(E,0,h);case 2:return l.set(E,h);case 3:return l.add(h);default:return l[E]=h}case"remove":switch(f){case 1:return l.splice(E,1);case 2:return l.delete(E);case 3:return l.delete(o.value);default:return delete l[E]}default:m(17,d)}}),s},N:function(s,i,o,u){switch(s.i){case 0:case 4:case 2:return function(d,l,a,r){var c=d.t,f=d.o;j(d.R,function(h,E){var y=ee(c,h),B=ee(f,h),g=E?K(c,h)?"replace":t:"remove";if(y!==B||g!=="replace"){var R=l.concat(h);a.push(g==="remove"?{op:g,path:R}:{op:g,path:R,value:B}),r.push(g===t?{op:"remove",path:R}:g==="remove"?{op:t,path:R,value:e(y)}:{op:"replace",path:R,value:e(y)})}})}(s,i,o,u);case 5:case 1:return function(d,l,a,r){var c=d.t,f=d.R,h=d.o;if(h.length<c.length){var E=[h,c];c=E[0],h=E[1];var y=[r,a];a=y[0],r=y[1]}for(var B=0;B<c.length;B++)if(f[B]&&h[B]!==c[B]){var g=l.concat([B]);a.push({op:"replace",path:g,value:e(h[B])}),r.push({op:"replace",path:g,value:e(c[B])})}for(var R=c.length;R<h.length;R++){var G=l.concat([R]);a.push({op:t,path:G,value:e(h[R])})}c.length<h.length&&r.push({op:"replace",path:l.concat(["length"]),value:c.length})}(s,i,o,u);case 3:return function(d,l,a,r){var c=d.t,f=d.o,h=0;c.forEach(function(E){if(!f.has(E)){var y=l.concat([h]);a.push({op:"remove",path:y,value:E}),r.unshift({op:t,path:y,value:E})}h++}),h=0,f.forEach(function(E){if(!c.has(E)){var y=l.concat([h]);a.push({op:t,path:y,value:E}),r.unshift({op:"remove",path:y,value:E})}h++})}(s,i,o,u)}},M:function(s,i,o,u){o.push({op:"replace",path:[],value:i===Re?void 0:i}),u.push({op:"replace",path:[],value:s})}})}var He,z,ge=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Lt=typeof Map<"u",xt=typeof Set<"u",We=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Re=ge?Symbol.for("immer-nothing"):((He={})["immer-nothing"]=!0,He),F=ge?Symbol.for("immer-draftable"):"__$immer_draftable",C=ge?Symbol.for("immer-state"):"__$immer_state",bt=""+Object.prototype.constructor,Ce=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,Dt=Object.getOwnPropertyDescriptors||function(n){var e={};return Ce(n).forEach(function(t){e[t]=Object.getOwnPropertyDescriptor(n,t)}),e},ye={},Oe={get:function(n,e){if(e===C)return n;var t=b(n);if(!K(t,e))return function(i,o,u){var d,l=Ve(o,u);return l?"value"in l?l.value:(d=l.get)===null||d===void 0?void 0:d.call(i.k):void 0}(n,t,e);var s=t[e];return n.I||!L(s)?s:s===ce(n.t,e)?(de(n),n.o[e]=Ee(n.A.h,s,n)):s},has:function(n,e){return e in b(n)},ownKeys:function(n){return Reflect.ownKeys(b(n))},set:function(n,e,t){var s=Ve(b(n),e);if(s?.set)return s.set.call(n.k,t),!0;if(!n.P){var i=ce(b(n),e),o=i?.[C];if(o&&o.t===t)return n.o[e]=t,n.R[e]=!1,!0;if(St(t,i)&&(t!==void 0||K(n.t,e)))return!0;de(n),_e(n)}return n.o[e]===t&&(t!==void 0||e in n.o)||Number.isNaN(t)&&Number.isNaN(n.o[e])||(n.o[e]=t,n.R[e]=!0),!0},deleteProperty:function(n,e){return ce(n.t,e)!==void 0||e in n.t?(n.R[e]=!1,de(n),_e(n)):delete n.R[e],n.o&&delete n.o[e],!0},getOwnPropertyDescriptor:function(n,e){var t=b(n),s=Reflect.getOwnPropertyDescriptor(t,e);return s&&{writable:!0,configurable:n.i!==1||e!=="length",enumerable:s.enumerable,value:t[e]}},defineProperty:function(){m(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){m(12)}},Y={};j(Oe,function(n,e){Y[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),Y.deleteProperty=function(n,e){return Y.set.call(this,n,e,void 0)},Y.set=function(n,e,t){return Oe.set.call(this,n[0],e,t,n[0])};var Pt=function(){function n(t){var s=this;this.O=We,this.D=!0,this.produce=function(i,o,u){if(typeof i=="function"&&typeof o!="function"){var d=o;o=i;var l=s;return function(y){var B=this;y===void 0&&(y=d);for(var g=arguments.length,R=Array(g>1?g-1:0),G=1;G<g;G++)R[G-1]=arguments[G];return l.produce(y,function(ut){var Me;return(Me=o).call.apply(Me,[B,ut].concat(R))})}}var a;if(typeof o!="function"&&m(6),u!==void 0&&typeof u!="function"&&m(7),L(i)){var r=Ge(s),c=Ee(s,i,void 0),f=!0;try{a=o(c),f=!1}finally{f?te(r):fe(r)}return typeof Promise<"u"&&a instanceof Promise?a.then(function(y){return ue(r,u),ae(y,r)},function(y){throw te(r),y}):(ue(r,u),ae(a,r))}if(!i||typeof i!="object"){if((a=o(i))===void 0&&(a=i),a===Re&&(a=void 0),s.D&&Ae(a,!0),u){var h=[],E=[];M("Patches").M(i,a,h,E),u(h,E)}return a}m(21,i)},this.produceWithPatches=function(i,o){if(typeof i=="function")return function(a){for(var r=arguments.length,c=Array(r>1?r-1:0),f=1;f<r;f++)c[f-1]=arguments[f];return s.produceWithPatches(a,function(h){return i.apply(void 0,[h].concat(c))})};var u,d,l=s.produce(i,o,function(a,r){u=a,d=r});return typeof Promise<"u"&&l instanceof Promise?l.then(function(a){return[a,u,d]}):[l,u,d]},typeof t?.useProxies=="boolean"&&this.setUseProxies(t.useProxies),typeof t?.autoFreeze=="boolean"&&this.setAutoFreeze(t.autoFreeze)}var e=n.prototype;return e.createDraft=function(t){L(t)||m(8),P(t)&&(t=Mt(t));var s=Ge(this),i=Ee(this,t,void 0);return i[C].C=!0,fe(s),i},e.finishDraft=function(t,s){var i=t&&t[C],o=i.A;return ue(o,s),ae(void 0,o)},e.setAutoFreeze=function(t){this.D=t},e.setUseProxies=function(t){t&&!We&&m(20),this.O=t},e.applyPatches=function(t,s){var i;for(i=s.length-1;i>=0;i--){var o=s[i];if(o.path.length===0&&o.op==="replace"){t=o.value;break}}i>-1&&(s=s.slice(i+1));var u=M("Patches").$;return P(t)?u(t,s):this.produce(t,function(d){return u(d,s)})},n}(),S=new Pt;S.produce;var Se=S.produceWithPatches.bind(S);S.setAutoFreeze.bind(S);S.setUseProxies.bind(S);S.applyPatches.bind(S);S.createDraft.bind(S);S.finishDraft.bind(S);var V=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};Be();class Gt{constructor(e){this.messageBus=e}getItems(e){return V(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:e});return t}else if(e){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return t.filter(e)}else{const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return t}})}isItemArray(e){return Array.isArray(e)&&e.every(t=>typeof t!="string")}updateItems(e,t,s=!0){return V(this,void 0,void 0,function*(){let i;this.isItemArray(e)?i=e:i=yield this.getItems(e);const[o,u]=Se(i,t),d=o.map(a=>({id:a.id,type:a.type}));for(const a of u){const[r,c]=a.path;typeof r=="number"&&typeof c=="string"&&(d[r][c]=o[r][c])}const l=d.filter(a=>Object.keys(a).length>2);l.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:l,updateAttachments:s}))})}addItems(e){return V(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:e})})}deleteItems(e){return V(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return V(this,void 0,void 0,function*(){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:e});return t})}getItemBounds(e){return V(this,void 0,void 0,function*(){const{bounds:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:e});return t})}onChange(e){const t=s=>{e(s.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",t)}}}var k=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};Be();class Ut{constructor(e){this.messageBus=e}getItems(e){return k(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:e});return t}else if(e){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return t.filter(e)}else{const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return t}})}updateItems(e,t,s,i=!0){return k(this,void 0,void 0,function*(){const o=yield this.getItems(e),[u,d]=Se(o,t),l=u.map(r=>({id:r.id,type:r.type}));for(const r of d){const[c,f]=r.path;typeof c=="number"&&typeof f=="string"&&(l[c][f]=u[c][f])}const a=l.filter(r=>Object.keys(r).length>2);a.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:a,fastUpdate:s,updateAttachments:i}))})}addItems(e){return k(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:e})})}deleteItems(e){return k(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return k(this,void 0,void 0,function*(){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:e});return t})}getItemBounds(e){return k(this,void 0,void 0,function*(){const{bounds:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:e});return t})}onChange(e){const t=s=>{e(s.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",t)}}}var le=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};class Vt{constructor(e){this.messageBus=e,this.grid=new Rt(e),this.fog=new gt(e),this.history=new Ct(e),this.items=new Gt(e),this.local=new Ut(e)}isReady(){return le(this,void 0,void 0,function*(){const{ready:e}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return e})}onReadyChange(e){const t=s=>{e(s.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",t)}}getMetadata(){return le(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return e})}setMetadata(e){return le(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:e})})}onMetadataChange(e){const t=s=>{e(s.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",t)}}}function st(n){return n.startsWith("http")?n:`${window.location.origin}${n}`}function $(n){return n.map(e=>Object.assign(Object.assign({},e),{icon:st(e.icon)}))}function Ie(n){return Object.assign(Object.assign({},n),{url:st(n.url)})}var je=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};class kt{constructor(e){this.contextMenus={},this.handleClick=t=>{var s;const i=this.contextMenus[t.id];i&&((s=i.onClick)===null||s===void 0||s.call(i,t.context,t.elementId))},this.messageBus=e,e.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(e){return je(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:e.id,shortcut:e.shortcut,icons:$(e.icons),embed:e.embed&&Ie(e.embed)}),this.contextMenus[e.id]=e})}remove(e){return je(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:e}),delete this.contextMenus[e]})}}var w=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};class Ht{constructor(e){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=t=>{const s=this.tools[t.id];if(s)if(s.onClick){const i=s.onClick(t.context,t.elementId);Promise.resolve(i).then(o=>{o&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:t.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:t.id})},this.handleToolActionClick=t=>{var s;const i=this.toolActions[t.id];i&&((s=i.onClick)===null||s===void 0||s.call(i,t.context,t.elementId))},this.handleToolModeClick=t=>{const s=this.toolModes[t.id];if(s)if(s.onClick){const i=s.onClick(t.context,t.elementId);Promise.resolve(i).then(o=>{o&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:t.context.activeTool,modeId:t.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:t.context.activeTool,modeId:t.id})},this.handleToolModeToolClick=t=>{const s=this.toolModes[t.id];if(s)if(s.onToolClick){const i=s.onToolClick(t.context,t.event);Promise.resolve(i).then(o=>{o&&t.event.target&&!t.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})})}else t.event.target&&!t.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})},this.handleToolModeToolDoubleClick=t=>{const s=this.toolModes[t.id];if(s)if(s.onToolDoubleClick){const i=s.onToolDoubleClick(t.context,t.event);Promise.resolve(i).then(o=>{o&&t.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})})}else t.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})},this.handleToolModeToolDown=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onToolDown)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeToolMove=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onToolMove)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeToolUp=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onToolUp)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeToolDragStart=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onToolDragStart)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeToolDragMove=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onToolDragMove)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeToolDragEnd=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onToolDragEnd)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeToolDragCancel=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onToolDragCancel)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeKeyDown=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onKeyDown)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeKeyUp=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onKeyUp)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeActivate=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onActivate)===null||s===void 0||s.call(i,t.context))},this.handleToolModeDeactivate=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onDeactivate)===null||s===void 0||s.call(i,t.context))},this.messageBus=e,e.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),e.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),e.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),e.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),e.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),e.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),e.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),e.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(e){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:e.id,shortcut:e.shortcut,defaultMode:e.defaultMode,defaultMetadata:e.defaultMetadata,icons:$(e.icons),disabled:e.disabled}),this.tools[e.id]=e})}remove(e){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:e}),delete this.tools[e]})}activateTool(e){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:e})})}getMetadata(e){return w(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:e});return t})}setMetadata(e,t){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:e,update:t})})}createAction(e){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:e.id,shortcut:e.shortcut,icons:$(e.icons),disabled:e.disabled}),this.toolActions[e.id]=e})}removeAction(e){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:e}),delete this.tools[e]})}createMode(e){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:e.id,shortcut:e.shortcut,icons:$(e.icons),preventDrag:e.preventDrag,disabled:e.disabled,cursors:e.cursors}),this.toolModes[e.id]=e})}removeMode(e){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:e}),delete this.tools[e]})}activateMode(e,t){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:e,modeId:t})})}}var H=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};class Wt{constructor(e){this.messageBus=e}open(e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},Ie(e)))})}close(e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:e})})}getWidth(e){return H(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:e});return t})}setWidth(e,t){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:e,width:t})})}getHeight(e){return H(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:e});return t})}setHeight(e,t){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:e,height:t})})}}var Ye=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};class jt{constructor(e){this.messageBus=e}open(e){return Ye(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},Ie(e)))})}close(e){return Ye(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:e})})}}var T=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};class Yt{constructor(e){this.messageBus=e}getWidth(){return T(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return e})}setWidth(e){return T(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:e})})}getHeight(){return T(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return e})}setHeight(e){return T(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:e})})}getBadgeText(){return T(this,void 0,void 0,function*(){const{badgeText:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return e})}setBadgeText(e){return T(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:e})})}getBadgeBackgroundColor(){return T(this,void 0,void 0,function*(){const{badgeBackgroundColor:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return e})}setBadgeBackgroundColor(e){return T(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:e})})}getIcon(){return T(this,void 0,void 0,function*(){const{icon:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return e})}setIcon(e){return T(this,void 0,void 0,function*(){const t=$([{icon:e}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:t[0].icon})})}getTitle(){return T(this,void 0,void 0,function*(){const{title:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return e})}setTitle(e){return T(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:e})})}isOpen(){return T(this,void 0,void 0,function*(){const{isOpen:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return e})}open(){return T(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return T(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(e){const t=s=>{e(s.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",t)}}}var Ft=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};Be();class $t{constructor(e){this.messageBus=e}startItemInteraction(e,t=!0){return Ft(this,void 0,void 0,function*(){const{id:s}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:e,updateAttachments:t});let i=e;return[d=>{const[l,a]=Se(i,d);return i=l,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:s,patches:a}),l},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:s})}]})}}var Kt=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};class zt{constructor(e){this.messageBus=e}getPlayers(){return Kt(this,void 0,void 0,function*(){const{players:e}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return e})}onChange(e){const t=s=>{e(s.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",t)}}}var he=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};class Xt{constructor(e){this.messageBus=e}get id(){return this.messageBus.roomId}getPermissions(){return he(this,void 0,void 0,function*(){const{permissions:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return e})}getMetadata(){return he(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return e})}setMetadata(e){return he(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:e})})}onMetadataChange(e){const t=s=>{e(s.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",t)}}onPermissionsChange(e){const t=s=>{e(s.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",t)}}}var Zt=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};class Jt{constructor(e){this.messageBus=e}getTheme(){return Zt(this,void 0,void 0,function*(){const{theme:e}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return e})}onChange(e){const t=s=>{e(s.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",t)}}}var J=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};class Qt{constructor(e){this.messageBus=e}uploadImages(e,t){return J(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_IMAGES",{images:e,typeHint:t})})}uploadScenes(e,t){return J(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_SCENES",{scenes:e,disableShowScenes:t})})}downloadImages(e,t,s){return J(this,void 0,void 0,function*(){const{images:i}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_IMAGES",{multiple:e,defaultSearch:t,typeHint:s},-1);return i})}downloadScenes(e,t){return J(this,void 0,void 0,function*(){const{scenes:s}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_SCENES",{multiple:e,defaultSearch:t},-1);return s})}}var qt=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(r){try{a(s.next(r))}catch(c){u(c)}}function l(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?o(r.value):i(r.value).then(d,l)}a((s=s.apply(n,e||[])).next())})};class en{constructor(e){this.messageBus=e}sendMessage(e,t){return qt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_BROADCAST_SEND_MESSAGE",{channel:e,data:t})})}onMessage(e,t){return this.messageBus.send("OBR_BROADCAST_SUBSCRIBE",{channel:e}),this.messageBus.on(`OBR_BROADCAST_MESSAGE_${e}`,t),()=>{this.messageBus.send("OBR_BROADCAST_UNSUBSCRIBE",{channel:e}),this.messageBus.off(`OBR_BROADCAST_MESSAGE_${e}`,t)}}}class it{constructor(e){this._item={createdUserId:e.id,id:tt(),name:"Item",zIndex:Date.now(),lastModified:new Date().toISOString(),lastModifiedUserId:e.id,locked:!1,metadata:{},position:{x:0,y:0},rotation:0,scale:{x:1,y:1},type:"ITEM",visible:!0,layer:"POPOVER"}}createdUserId(e){return this._item.createdUserId=e,this.self()}id(e){return this._item.id=e,this.self()}name(e){return this._item.name=e,this.self()}description(e){return this._item.description=e,this.self()}lastModified(e){return this._item.lastModified=e,this.self()}zIndex(e){return this._item.zIndex=e,this.self()}lastModifiedUserId(e){return this._item.lastModifiedUserId=e,this.self()}locked(e){return this._item.locked=e,this.self()}metadata(e){return this._item.metadata=e,this.self()}position(e){return this._item.position=e,this.self()}rotation(e){return this._item.rotation=e,this.self()}scale(e){return this._item.scale=e,this.self()}visible(e){return this._item.visible=e,this.self()}attachedTo(e){return this._item.attachedTo=e,this.self()}layer(e){return this._item.layer=e,this.self()}disableHit(e){return this._item.disableHit=e,this.self()}disableAutoZIndex(e){return this._item.disableAutoZIndex=e,this.self()}disableAttachmentBehavior(e){return this._item.disableAttachmentBehavior=e,this.self()}self(){return this}}class tn extends it{constructor(e){super(e),this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:0,fontFamily:"Roboto",fontSize:16,fontWeight:400,textAlign:"LEFT",textAlignVertical:"TOP",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"RICH",width:"AUTO",height:"AUTO"},this._item.layer="TEXT",this._item.name="Text"}text(e){return this._text=e,this.self()}width(e){return this._text.width=e,this.self()}height(e){return this._text.height=e,this.self()}richText(e){return this._text.richText=e,this.self()}plainText(e){return this._text.plainText=e,this.self()}textType(e){return this._text.type=e,this.self()}padding(e){return this._text.style.padding=e,this.self()}fontFamily(e){return this._text.style.fontFamily=e,this.self()}fontSize(e){return this._text.style.fontSize=e,this.self()}fontWeight(e){return this._text.style.fontWeight=e,this.self()}textAlign(e){return this._text.style.textAlign=e,this.self()}textAlignVertical(e){return this._text.style.textAlignVertical=e,this.self()}fillColor(e){return this._text.style.fillColor=e,this.self()}fillOpacity(e){return this._text.style.fillOpacity=e,this.self()}strokeColor(e){return this._text.style.strokeColor=e,this.self()}strokeOpacity(e){return this._text.style.strokeOpacity=e,this.self()}strokeWidth(e){return this._text.style.strokeWidth=e,this.self()}lineHeight(e){return this._text.style.lineHeight=e,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"TEXT",text:this._text})}}class nn extends it{constructor(e){super(e),this._commands=[],this._fillRule="nonzero",this._style={fillColor:"black",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:5,strokeDash:[]},this._item.name="Path",this._item.layer="DRAWING"}commands(e){return this._commands=e,this.self()}fillRule(e){return this._fillRule=e,this.self()}style(e){return this._style=e,this.self()}fillColor(e){return this._style.fillColor=e,this.self()}fillOpacity(e){return this._style.fillOpacity=e,this.self()}strokeColor(e){return this._style.strokeColor=e,this.self()}strokeOpacity(e){return this._style.strokeOpacity=e,this.self()}strokeWidth(e){return this._style.strokeWidth=e,this.self()}strokeDash(e){return this._style.strokeDash=e,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"PATH",commands:this._commands,fillRule:this._fillRule,style:this._style})}}const sn=typeof atob=="function",Ne=typeof Buffer=="function",Fe=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const on="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",rn=Array.prototype.slice.call(on),Q=(n=>{let e={};return n.forEach((t,s)=>e[t]=s),e})(rn),un=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,D=String.fromCharCode.bind(String),$e=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):n=>new Uint8Array(Array.prototype.slice.call(n,0)),ot=n=>n.replace(/[^A-Za-z0-9\+\/]/g,""),an=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,cn=n=>{switch(n.length){case 4:var e=(7&n.charCodeAt(0))<<18|(63&n.charCodeAt(1))<<12|(63&n.charCodeAt(2))<<6|63&n.charCodeAt(3),t=e-65536;return D((t>>>10)+55296)+D((t&1023)+56320);case 3:return D((15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2));default:return D((31&n.charCodeAt(0))<<6|63&n.charCodeAt(1))}},dn=n=>n.replace(an,cn),ln=n=>{if(n=n.replace(/\s+/g,""),!un.test(n))throw new TypeError("malformed base64.");n+="==".slice(2-(n.length&3));let e,t="",s,i;for(let o=0;o<n.length;)e=Q[n.charAt(o++)]<<18|Q[n.charAt(o++)]<<12|(s=Q[n.charAt(o++)])<<6|(i=Q[n.charAt(o++)]),t+=s===64?D(e>>16&255):i===64?D(e>>16&255,e>>8&255):D(e>>16&255,e>>8&255,e&255);return t},rt=sn?n=>atob(ot(n)):Ne?n=>Buffer.from(n,"base64").toString("binary"):ln,hn=Ne?n=>$e(Buffer.from(n,"base64")):n=>$e(rt(n).split("").map(e=>e.charCodeAt(0))),fn=Ne?n=>Buffer.from(n,"base64").toString("utf8"):Fe?n=>Fe.decode(hn(n)):n=>dn(rt(n)),_n=n=>ot(n.replace(/[-_]/g,e=>e=="-"?"+":"/")),En=n=>fn(_n(n));function yn(){const e=new URLSearchParams(window.location.search).get("obrref");let t="",s="";if(e){const o=En(e).split(" ");o.length===2&&(t=o[0],s=o[1])}return{origin:t,roomId:s}}var I;(function(n){n[n.MOVE=0]="MOVE",n[n.LINE=1]="LINE",n[n.QUAD=2]="QUAD",n[n.CONIC=3]="CONIC",n[n.CUBIC=4]="CUBIC",n[n.CLOSE=5]="CLOSE"})(I||(I={}));const pe=yn(),O=new Tt(pe.origin,pe.roomId),On=new ct(O),we=new at(O),pn=new zt(O),mn=new Bt(O),vn=new Vt(O),An=new kt(O),Tn=new Ht(O),Bn=new Wt(O),gn=new jt(O),Rn=new Yt(O),Cn=new $t(O),Sn=new Xt(O),In=new Jt(O),Nn=new Qt(O),wn=new en(O),Mn={onReady:n=>{O.ready?n():O.once("OBR_READY",()=>n())},get isReady(){return O.ready},viewport:On,player:we,party:pn,notification:mn,scene:vn,contextMenu:An,tool:Tn,popover:Bn,modal:gn,action:Rn,interaction:Cn,room:Sn,theme:In,assets:Nn,broadcast:wn,isAvailable:!!pe.origin};function Ln(){return new tn(we)}function xn(){return new nn(we)}class bn{static EXTENSIONID="com.battle-system.theatre";static EXTENSIONWHATSNEW="com.battle-system.theatre-whatsnew";static BROADCASTCHANNEL="com.battle-system.theatre-broadcast";static SELFCHANNEL="com.battle-system.threatre-self";static ANONAUTH="Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0";static CLOSEBUTTON=[[I.MOVE,0,-50],[I.QUAD,50,-50,50,0],[I.QUAD,50,50,0,50],[I.QUAD,-50,50,-50,0],[I.QUAD,-50,-50,0,-50],[I.MOVE,-35,-35],[I.LINE,35,35],[I.MOVE,-35,35],[I.LINE,35,-35],[I.CLOSE]];static MULTIPAGE=`What is Lorem Ipsum?
        Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged.
        ::
        Why are you doing this?
        Because I hate writing filler text.
        `;static LOGHTML=`<b>LOG HISTORY</b><div class="full-container">
        <ul id="dialogLog">
        </ul>
        </div>`;static FRESHPRINCE=`Now, this is a story all about how
        My life got flipped-turned upside down
        And I'd like to take a minute
        Just sit right there
        I'll tell you how I became the prince of a town called Bel-Air
        In West Philadelphia born and raised
        On the playground was where I spent most of my days
        Chillin' out, maxin', relaxin', all cool
        And all shootin' some b-ball outside of the school
        When a couple of guys who were up to no good
        Started making trouble in my neighborhood
        I got in one little fight and my mom got scared
        She said, "You're movin' with your auntie and uncle in Bel-Air"
        I begged and pleaded with her day after day
        But she packed my suitcase and sent me on my way
        She gave me a kiss and then she gave me my ticket
        I put my Walkman on and said, "I might as well kick it"
        First class, yo this is bad`}export{bn as C,Mn as O,xn as a,Ln as b,I as c};
