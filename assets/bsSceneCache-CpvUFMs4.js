(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))n(d);new MutationObserver(d=>{for(const o of d)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function i(d){const o={};return d.integrity&&(o.integrity=d.integrity),d.referrerPolicy&&(o.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?o.credentials="include":d.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(d){if(d.ep)return;d.ep=!0;const o=i(d);fetch(d.href,o)}})();var se=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};class li{constructor(e){this.messageBus=e}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return se(this,void 0,void 0,function*(){const{selection:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return e})}select(e,i){return se(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:e,replace:i})})}deselect(e){return se(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:e})})}getName(){return se(this,void 0,void 0,function*(){const{name:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return e})}setName(e){return se(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:e})})}getColor(){return se(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return e})}setColor(e){return se(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:e})})}getSyncView(){return se(this,void 0,void 0,function*(){const{syncView:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return e})}setSyncView(e){return se(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:e})})}getId(){return se(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return e})}getRole(){return se(this,void 0,void 0,function*(){const{role:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return e})}getMetadata(){return se(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return e})}setMetadata(e){return se(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:e})})}hasPermission(e){return se(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:n}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return n.indexOf(e)>-1})}getConnectionId(){return se(this,void 0,void 0,function*(){const{connectionId:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return e})}onChange(e){const i=n=>{e(n.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",i),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",i)}}}var be=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};class fi{constructor(e){this.messageBus=e}reset(){return be(this,void 0,void 0,function*(){const{transform:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return e})}animateTo(e){return be(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:e})})}animateToBounds(e){return be(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:e})})}getPosition(){return be(this,void 0,void 0,function*(){const{position:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return e})}setPosition(e){return be(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:e})})}getScale(){return be(this,void 0,void 0,function*(){const{scale:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return e})}setScale(e){return be(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:e})})}getWidth(){return be(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return e})}getHeight(){return be(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return e})}transformPoint(e){return be(this,void 0,void 0,function*(){const{point:i}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:e});return i})}inverseTransformPoint(e){return be(this,void 0,void 0,function*(){const{point:i}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:e});return i})}}function hi(t){return typeof t.id=="string"}var pi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},En={exports:{}},Je=typeof Reflect=="object"?Reflect:null,Un=Je&&typeof Je.apply=="function"?Je.apply:function(e,i,n){return Function.prototype.apply.call(e,i,n)},$t;Je&&typeof Je.ownKeys=="function"?$t=Je.ownKeys:Object.getOwnPropertySymbols?$t=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:$t=function(e){return Object.getOwnPropertyNames(e)};function mi(t){console&&console.warn&&console.warn(t)}var br=Number.isNaN||function(e){return e!==e};function Y(){Y.init.call(this)}En.exports=Y;En.exports.once=vi;Y.EventEmitter=Y;Y.prototype._events=void 0;Y.prototype._eventsCount=0;Y.prototype._maxListeners=void 0;var Gn=10;function Xt(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Y,"defaultMaxListeners",{enumerable:!0,get:function(){return Gn},set:function(t){if(typeof t!="number"||t<0||br(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Gn=t}});Y.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Y.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||br(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Er(t){return t._maxListeners===void 0?Y.defaultMaxListeners:t._maxListeners}Y.prototype.getMaxListeners=function(){return Er(this)};Y.prototype.emit=function(e){for(var i=[],n=1;n<arguments.length;n++)i.push(arguments[n]);var d=e==="error",o=this._events;if(o!==void 0)d=d&&o.error===void 0;else if(!d)return!1;if(d){var u;if(i.length>0&&(u=i[0]),u instanceof Error)throw u;var p=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw p.context=u,p}var _=o[e];if(_===void 0)return!1;if(typeof _=="function")Un(_,this,i);else for(var v=_.length,l=Cr(_,v),n=0;n<v;++n)Un(l[n],this,i);return!0};function Or(t,e,i,n){var d,o,u;if(Xt(i),o=t._events,o===void 0?(o=t._events=Object.create(null),t._eventsCount=0):(o.newListener!==void 0&&(t.emit("newListener",e,i.listener?i.listener:i),o=t._events),u=o[e]),u===void 0)u=o[e]=i,++t._eventsCount;else if(typeof u=="function"?u=o[e]=n?[i,u]:[u,i]:n?u.unshift(i):u.push(i),d=Er(t),d>0&&u.length>d&&!u.warned){u.warned=!0;var p=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");p.name="MaxListenersExceededWarning",p.emitter=t,p.type=e,p.count=u.length,mi(p)}return t}Y.prototype.addListener=function(e,i){return Or(this,e,i,!1)};Y.prototype.on=Y.prototype.addListener;Y.prototype.prependListener=function(e,i){return Or(this,e,i,!0)};function _i(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Tr(t,e,i){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},d=_i.bind(n);return d.listener=i,n.wrapFn=d,d}Y.prototype.once=function(e,i){return Xt(i),this.on(e,Tr(this,e,i)),this};Y.prototype.prependOnceListener=function(e,i){return Xt(i),this.prependListener(e,Tr(this,e,i)),this};Y.prototype.removeListener=function(e,i){var n,d,o,u,p;if(Xt(i),d=this._events,d===void 0)return this;if(n=d[e],n===void 0)return this;if(n===i||n.listener===i)--this._eventsCount===0?this._events=Object.create(null):(delete d[e],d.removeListener&&this.emit("removeListener",e,n.listener||i));else if(typeof n!="function"){for(o=-1,u=n.length-1;u>=0;u--)if(n[u]===i||n[u].listener===i){p=n[u].listener,o=u;break}if(o<0)return this;o===0?n.shift():gi(n,o),n.length===1&&(d[e]=n[0]),d.removeListener!==void 0&&this.emit("removeListener",e,p||i)}return this};Y.prototype.off=Y.prototype.removeListener;Y.prototype.removeAllListeners=function(e){var i,n,d;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var o=Object.keys(n),u;for(d=0;d<o.length;++d)u=o[d],u!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(i=n[e],typeof i=="function")this.removeListener(e,i);else if(i!==void 0)for(d=i.length-1;d>=0;d--)this.removeListener(e,i[d]);return this};function Ar(t,e,i){var n=t._events;if(n===void 0)return[];var d=n[e];return d===void 0?[]:typeof d=="function"?i?[d.listener||d]:[d]:i?yi(d):Cr(d,d.length)}Y.prototype.listeners=function(e){return Ar(this,e,!0)};Y.prototype.rawListeners=function(e){return Ar(this,e,!1)};Y.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Sr.call(t,e)};Y.prototype.listenerCount=Sr;function Sr(t){var e=this._events;if(e!==void 0){var i=e[t];if(typeof i=="function")return 1;if(i!==void 0)return i.length}return 0}Y.prototype.eventNames=function(){return this._eventsCount>0?$t(this._events):[]};function Cr(t,e){for(var i=new Array(e),n=0;n<e;++n)i[n]=t[n];return i}function gi(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function yi(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}function vi(t,e){return new Promise(function(i,n){function d(u){t.removeListener(e,o),n(u)}function o(){typeof t.removeListener=="function"&&t.removeListener("error",d),i([].slice.call(arguments))}Rr(t,e,o,{once:!0}),e!=="error"&&wi(t,d,{once:!0})})}function wi(t,e,i){typeof t.on=="function"&&Rr(t,"error",e,i)}function Rr(t,e,i,n){if(typeof t.on=="function")n.once?t.once(e,i):t.on(e,i);else if(typeof t.addEventListener=="function")t.addEventListener(e,function d(o){n.once&&t.removeEventListener(e,d),i(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var bi=En.exports;let Dt;const Ei=new Uint8Array(16);function Oi(){if(!Dt&&(Dt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Dt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Dt(Ei)}const re=[];for(let t=0;t<256;++t)re.push((t+256).toString(16).slice(1));function Ti(t,e=0){return re[t[e+0]]+re[t[e+1]]+re[t[e+2]]+re[t[e+3]]+"-"+re[t[e+4]]+re[t[e+5]]+"-"+re[t[e+6]]+re[t[e+7]]+"-"+re[t[e+8]]+re[t[e+9]]+"-"+re[t[e+10]]+re[t[e+11]]+re[t[e+12]]+re[t[e+13]]+re[t[e+14]]+re[t[e+15]]}const Ai=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),$n={randomUUID:Ai};function Br(t,e,i){if($n.randomUUID&&!e&&!t)return $n.randomUUID();t=t||{};const n=t.random||(t.rng||Oi)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Ti(n)}class Si extends bi.EventEmitter{constructor(e,i){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=n=>{const d=n.data;if(n.origin===this.targetOrigin&&hi(d)){if(d.id==="OBR_READY"){this.ready=!0;const o=d.data;this.ref=o.ref,this.userId=o.userId}this.emit(d.id,d.data)}},this.send=(n,d,o)=>{var u;if(!this.ref)throw Error("Unable to send message: not ready");(u=window.parent)===null||u===void 0||u.postMessage({id:n,data:d,ref:this.ref,nonce:o},this.targetOrigin)},this.sendAsync=(n,d,o=5e3)=>{const u=`_${Br()}`;return this.send(n,d,u),Promise.race([new Promise((p,_)=>{const v=this;function l(C){v.off(`${n}_RESPONSE${u}`,l),v.off(`${n}_ERROR${u}`,w),p(C)}function w(C){v.off(`${n}_RESPONSE${u}`,l),v.off(`${n}_ERROR${u}`,w),_(C)}this.on(`${n}_RESPONSE${u}`,l),this.on(`${n}_ERROR${u}`,w)}),...o>0?[new Promise((p,_)=>window.setTimeout(()=>_(new Error(`Message ${n} took longer than ${o}ms to get a result`)),o))]:[]])},this.roomId=i,this.targetOrigin=e,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var Vn=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};class Ci{constructor(e){this.messageBus=e}show(e,i){return Vn(this,void 0,void 0,function*(){const{id:n}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:e,variant:i});return n})}close(e){return Vn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:e})})}}var Xe=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};class Ri{constructor(e){this.messageBus=e}getColor(){return Xe(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return e})}setColor(e){return Xe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:e})})}getStrokeWidth(){return Xe(this,void 0,void 0,function*(){const{strokeWidth:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return e})}setStrokeWidth(e){return Xe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:e})})}getFilled(){return Xe(this,void 0,void 0,function*(){const{filled:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return e})}setFilled(e){return Xe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:e})})}onChange(e){const i=n=>{e(n.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",i),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",i)}}}var de=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};class Bi{constructor(e){this.messageBus=e}getDpi(){return de(this,void 0,void 0,function*(){const{dpi:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return e})}getScale(){return de(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(e){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:e})})}getColor(){return de(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return e})}setColor(e){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:e})})}getOpacity(){return de(this,void 0,void 0,function*(){const{opacity:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return e})}setOpacity(e){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:e})})}getType(){return de(this,void 0,void 0,function*(){const{type:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return e})}setType(e){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:e})})}getLineType(){return de(this,void 0,void 0,function*(){const{lineType:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return e})}setLineType(e){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:e})})}getMeasurement(){return de(this,void 0,void 0,function*(){const{measurement:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return e})}setMeasurement(e){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:e})})}snapPosition(e,i,n,d){return de(this,void 0,void 0,function*(){const{position:o}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:e,snappingSensitivity:i,useCorners:n,useCenter:d});return o})}getDistance(e,i){return de(this,void 0,void 0,function*(){const{distance:n}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:e,to:i});return n})}onChange(e){const i=n=>{e(n.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",i),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",i)}}}var Ht=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};class Ii{constructor(e){this.messageBus=e}undo(){return Ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return Ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return Ht(this,void 0,void 0,function*(){const{canUndo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return e})}canRedo(){return Ht(this,void 0,void 0,function*(){const{canRedo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return e})}}var On=Symbol.for("immer-nothing"),ct=Symbol.for("immer-draftable"),le=Symbol.for("immer-state");function ie(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var Ge=Object.getPrototypeOf;function $e(t){return!!t&&!!t[le]}function Ne(t){return t?Ir(t)||Array.isArray(t)||!!t[ct]||!!t.constructor?.[ct]||bt(t)||Et(t):!1}var ki=Object.prototype.constructor.toString();function Ir(t){if(!t||typeof t!="object")return!1;const e=Ge(t);if(e===null)return!0;const i=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return i===Object?!0:typeof i=="function"&&Function.toString.call(i)===ki}function mt(t,e){Ve(t)===0?Reflect.ownKeys(t).forEach(i=>{e(i,t[i],t)}):t.forEach((i,n)=>e(n,i,t))}function Ve(t){const e=t[le];return e?e.type_:Array.isArray(t)?1:bt(t)?2:Et(t)?3:0}function _t(t,e){return Ve(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function en(t,e){return Ve(t)===2?t.get(e):t[e]}function kr(t,e,i){const n=Ve(t);n===2?t.set(e,i):n===3?t.add(i):t[e]=i}function Mi(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function bt(t){return t instanceof Map}function Et(t){return t instanceof Set}function He(t){return t.copy_||t.base_}function ln(t,e){if(bt(t))return new Map(t);if(Et(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const i=Ir(t);if(e===!0||e==="class_only"&&!i){const n=Object.getOwnPropertyDescriptors(t);delete n[le];let d=Reflect.ownKeys(n);for(let o=0;o<d.length;o++){const u=d[o],p=n[u];p.writable===!1&&(p.writable=!0,p.configurable=!0),(p.get||p.set)&&(n[u]={configurable:!0,writable:!0,enumerable:p.enumerable,value:t[u]})}return Object.create(Ge(t),n)}else{const n=Ge(t);if(n!==null&&i)return{...t};const d=Object.create(n);return Object.assign(d,t)}}function Tn(t,e=!1){return qt(t)||$e(t)||!Ne(t)||(Ve(t)>1&&(t.set=t.add=t.clear=t.delete=Ni),Object.freeze(t),e&&Object.entries(t).forEach(([i,n])=>Tn(n,!0))),t}function Ni(){ie(2)}function qt(t){return Object.isFrozen(t)}var fn={};function xe(t){const e=fn[t];return e||ie(0,t),e}function Li(t,e){fn[t]||(fn[t]=e)}var gt;function Mr(){return gt}function Pi(t,e){return{drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function xn(t,e){e&&(xe("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function hn(t){pn(t),t.drafts_.forEach(Di),t.drafts_=null}function pn(t){t===gt&&(gt=t.parent_)}function Wn(t){return gt=Pi(gt,t)}function Di(t){const e=t[le];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function Fn(t,e){e.unfinalizedDrafts_=e.drafts_.length;const i=e.drafts_[0];return t!==void 0&&t!==i?(i[le].modified_&&(hn(e),ie(4)),Ne(t)&&(t=xt(e,t),e.parent_||Wt(e,t)),e.patches_&&xe("Patches").generateReplacementPatches_(i[le].base_,t,e.patches_,e.inversePatches_)):t=xt(e,i,[]),hn(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==On?t:void 0}function xt(t,e,i){if(qt(e))return e;const n=e[le];if(!n)return mt(e,(d,o)=>Yn(t,n,e,d,o,i)),e;if(n.scope_!==t)return e;if(!n.modified_)return Wt(t,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const d=n.copy_;let o=d,u=!1;n.type_===3&&(o=new Set(d),d.clear(),u=!0),mt(o,(p,_)=>Yn(t,n,d,p,_,i,u)),Wt(t,d,!1),i&&t.patches_&&xe("Patches").generatePatches_(n,i,t.patches_,t.inversePatches_)}return n.copy_}function Yn(t,e,i,n,d,o,u){if($e(d)){const p=o&&e&&e.type_!==3&&!_t(e.assigned_,n)?o.concat(n):void 0,_=xt(t,d,p);if(kr(i,n,_),$e(_))t.canAutoFreeze_=!1;else return}else u&&i.add(d);if(Ne(d)&&!qt(d)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;xt(t,d),(!e||!e.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(i,n)&&Wt(t,d)}}function Wt(t,e,i=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&Tn(e,i)}function Hi(t,e){const i=Array.isArray(t),n={type_:i?1:0,scope_:e?e.scope_:Mr(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let d=n,o=An;i&&(d=[n],o=yt);const{revoke:u,proxy:p}=Proxy.revocable(d,o);return n.draft_=p,n.revoke_=u,p}var An={get(t,e){if(e===le)return t;const i=He(t);if(!_t(i,e))return ji(t,i,e);const n=i[e];return t.finalized_||!Ne(n)?n:n===tn(t.base_,e)?(nn(t),t.copy_[e]=_n(n,t)):n},has(t,e){return e in He(t)},ownKeys(t){return Reflect.ownKeys(He(t))},set(t,e,i){const n=Nr(He(t),e);if(n?.set)return n.set.call(t.draft_,i),!0;if(!t.modified_){const d=tn(He(t),e),o=d?.[le];if(o&&o.base_===i)return t.copy_[e]=i,t.assigned_[e]=!1,!0;if(Mi(i,d)&&(i!==void 0||_t(t.base_,e)))return!0;nn(t),mn(t)}return t.copy_[e]===i&&(i!==void 0||e in t.copy_)||Number.isNaN(i)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=i,t.assigned_[e]=!0),!0},deleteProperty(t,e){return tn(t.base_,e)!==void 0||e in t.base_?(t.assigned_[e]=!1,nn(t),mn(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const i=He(t),n=Reflect.getOwnPropertyDescriptor(i,e);return n&&{writable:!0,configurable:t.type_!==1||e!=="length",enumerable:n.enumerable,value:i[e]}},defineProperty(){ie(11)},getPrototypeOf(t){return Ge(t.base_)},setPrototypeOf(){ie(12)}},yt={};mt(An,(t,e)=>{yt[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});yt.deleteProperty=function(t,e){return yt.set.call(this,t,e,void 0)};yt.set=function(t,e,i){return An.set.call(this,t[0],e,i,t[0])};function tn(t,e){const i=t[le];return(i?He(i):t)[e]}function ji(t,e,i){const n=Nr(e,i);return n?"value"in n?n.value:n.get?.call(t.draft_):void 0}function Nr(t,e){if(!(e in t))return;let i=Ge(t);for(;i;){const n=Object.getOwnPropertyDescriptor(i,e);if(n)return n;i=Ge(i)}}function mn(t){t.modified_||(t.modified_=!0,t.parent_&&mn(t.parent_))}function nn(t){t.copy_||(t.copy_=ln(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var zi=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,i,n)=>{if(typeof e=="function"&&typeof i!="function"){const o=i;i=e;const u=this;return function(_=o,...v){return u.produce(_,l=>i.call(this,l,...v))}}typeof i!="function"&&ie(6),n!==void 0&&typeof n!="function"&&ie(7);let d;if(Ne(e)){const o=Wn(this),u=_n(e,void 0);let p=!0;try{d=i(u),p=!1}finally{p?hn(o):pn(o)}return xn(o,n),Fn(d,o)}else if(!e||typeof e!="object"){if(d=i(e),d===void 0&&(d=e),d===On&&(d=void 0),this.autoFreeze_&&Tn(d,!0),n){const o=[],u=[];xe("Patches").generateReplacementPatches_(e,d,o,u),n(o,u)}return d}else ie(1,e)},this.produceWithPatches=(e,i)=>{if(typeof e=="function")return(u,...p)=>this.produceWithPatches(u,_=>e(_,...p));let n,d;return[this.produce(e,i,(u,p)=>{n=u,d=p}),n,d]},typeof t?.autoFreeze=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof t?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){Ne(t)||ie(8),$e(t)&&(t=Ui(t));const e=Wn(this),i=_n(t,void 0);return i[le].isManual_=!0,pn(e),i}finishDraft(t,e){const i=t&&t[le];(!i||!i.isManual_)&&ie(9);const{scope_:n}=i;return xn(n,e),Fn(void 0,n)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,e){let i;for(i=e.length-1;i>=0;i--){const d=e[i];if(d.path.length===0&&d.op==="replace"){t=d.value;break}}i>-1&&(e=e.slice(i+1));const n=xe("Patches").applyPatches_;return $e(t)?n(t,e):this.produce(t,d=>n(d,e))}};function _n(t,e){const i=bt(t)?xe("MapSet").proxyMap_(t,e):Et(t)?xe("MapSet").proxySet_(t,e):Hi(t,e);return(e?e.scope_:Mr()).drafts_.push(i),i}function Ui(t){return $e(t)||ie(10,t),Lr(t)}function Lr(t){if(!Ne(t)||qt(t))return t;const e=t[le];let i;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,i=ln(t,e.scope_.immer_.useStrictShallowCopy_)}else i=ln(t,!0);return mt(i,(n,d)=>{kr(i,n,Lr(d))}),e&&(e.finalized_=!1),i}function Sn(){const e="replace",i="add",n="remove";function d(C,B,N,I){switch(C.type_){case 0:case 2:return u(C,B,N,I);case 1:return o(C,B,N,I);case 3:return p(C,B,N,I)}}function o(C,B,N,I){let{base_:P,assigned_:k}=C,z=C.copy_;z.length<P.length&&([P,z]=[z,P],[N,I]=[I,N]);for(let L=0;L<P.length;L++)if(k[L]&&z[L]!==P[L]){const r=B.concat([L]);N.push({op:e,path:r,value:w(z[L])}),I.push({op:e,path:r,value:w(P[L])})}for(let L=P.length;L<z.length;L++){const r=B.concat([L]);N.push({op:i,path:r,value:w(z[L])})}for(let L=z.length-1;P.length<=L;--L){const r=B.concat([L]);I.push({op:n,path:r})}}function u(C,B,N,I){const{base_:P,copy_:k}=C;mt(C.assigned_,(z,L)=>{const r=en(P,z),s=en(k,z),a=L?_t(P,z)?e:i:n;if(r===s&&a===e)return;const c=B.concat(z);N.push(a===n?{op:a,path:c}:{op:a,path:c,value:s}),I.push(a===i?{op:n,path:c}:a===n?{op:i,path:c,value:w(r)}:{op:e,path:c,value:w(r)})})}function p(C,B,N,I){let{base_:P,copy_:k}=C,z=0;P.forEach(L=>{if(!k.has(L)){const r=B.concat([z]);N.push({op:n,path:r,value:L}),I.unshift({op:i,path:r,value:L})}z++}),z=0,k.forEach(L=>{if(!P.has(L)){const r=B.concat([z]);N.push({op:i,path:r,value:L}),I.unshift({op:n,path:r,value:L})}z++})}function _(C,B,N,I){N.push({op:e,path:[],value:B===On?void 0:B}),I.push({op:e,path:[],value:C})}function v(C,B){return B.forEach(N=>{const{path:I,op:P}=N;let k=C;for(let s=0;s<I.length-1;s++){const a=Ve(k);let c=I[s];typeof c!="string"&&typeof c!="number"&&(c=""+c),(a===0||a===1)&&(c==="__proto__"||c==="constructor")&&ie(19),typeof k=="function"&&c==="prototype"&&ie(19),k=en(k,c),typeof k!="object"&&ie(18,I.join("/"))}const z=Ve(k),L=l(N.value),r=I[I.length-1];switch(P){case e:switch(z){case 2:return k.set(r,L);case 3:ie(16);default:return k[r]=L}case i:switch(z){case 1:return r==="-"?k.push(L):k.splice(r,0,L);case 2:return k.set(r,L);case 3:return k.add(L);default:return k[r]=L}case n:switch(z){case 1:return k.splice(r,1);case 2:return k.delete(r);case 3:return k.delete(N.value);default:return delete k[r]}default:ie(17,P)}}),C}function l(C){if(!Ne(C))return C;if(Array.isArray(C))return C.map(l);if(bt(C))return new Map(Array.from(C.entries()).map(([N,I])=>[N,l(I)]));if(Et(C))return new Set(Array.from(C).map(l));const B=Object.create(Ge(C));for(const N in C)B[N]=l(C[N]);return _t(C,ct)&&(B[ct]=C[ct]),B}function w(C){return $e(C)?l(C):C}Li("Patches",{applyPatches_:v,generatePatches_:d,generateReplacementPatches_:_})}var fe=new zi;fe.produce;var Cn=fe.produceWithPatches.bind(fe);fe.setAutoFreeze.bind(fe);fe.setUseStrictShallowCopy.bind(fe);fe.applyPatches.bind(fe);fe.createDraft.bind(fe);fe.finishDraft.bind(fe);var qe=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};Sn();class Gi{constructor(e){this.messageBus=e}getItems(e){return qe(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:i}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:e});return i}else if(e){const{items:i}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return i.filter(e)}else{const{items:i}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return i}})}isItemArray(e){return Array.isArray(e)&&e.every(i=>typeof i!="string")}updateItems(e,i){return qe(this,void 0,void 0,function*(){let n;this.isItemArray(e)?n=e:n=yield this.getItems(e);const[d,o]=Cn(n,i),u=d.map(_=>({id:_.id,type:_.type}));for(const _ of o){const[v,l]=_.path;typeof v=="number"&&typeof l=="string"&&(u[v][l]=d[v][l])}const p=u.filter(_=>Object.keys(_).length>2);p.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:p}))})}addItems(e){return qe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:e})})}deleteItems(e){return qe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return qe(this,void 0,void 0,function*(){const{items:i}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:e});return i})}getItemBounds(e){return qe(this,void 0,void 0,function*(){const{bounds:i}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:e});return i})}onChange(e){const i=n=>{e(n.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",i),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",i)}}}var Ke=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};Sn();class $i{constructor(e){this.messageBus=e}getItems(e){return Ke(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:i}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:e});return i}else if(e){const{items:i}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return i.filter(e)}else{const{items:i}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return i}})}isItemArray(e){return Array.isArray(e)&&e.every(i=>typeof i!="string")}updateItems(e,i,n){return Ke(this,void 0,void 0,function*(){let d;this.isItemArray(e)?d=e:d=yield this.getItems(e);const[o,u]=Cn(d,i),p=o.map(v=>({id:v.id,type:v.type}));for(const v of u){const[l,w]=v.path;typeof l=="number"&&typeof w=="string"&&(p[l][w]=o[l][w])}const _=p.filter(v=>Object.keys(v).length>2);_.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:_,fastUpdate:n}))})}addItems(e){return Ke(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:e})})}deleteItems(e){return Ke(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return Ke(this,void 0,void 0,function*(){const{items:i}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:e});return i})}getItemBounds(e){return Ke(this,void 0,void 0,function*(){const{bounds:i}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:e});return i})}onChange(e){const i=n=>{e(n.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",i),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",i)}}}var rn=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};class Vi{constructor(e){this.messageBus=e,this.grid=new Bi(e),this.fog=new Ri(e),this.history=new Ii(e),this.items=new Gi(e),this.local=new $i(e)}isReady(){return rn(this,void 0,void 0,function*(){const{ready:e}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return e})}onReadyChange(e){const i=n=>{e(n.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",i),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",i)}}getMetadata(){return rn(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return e})}setMetadata(e){return rn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:e})})}onMetadataChange(e){const i=n=>{e(n.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",i),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",i)}}}function Pr(t){return t.startsWith("http")?t:`${window.location.origin}${t}`}function lt(t){return t.map(e=>Object.assign(Object.assign({},e),{icon:Pr(e.icon)}))}function Rn(t){return Object.assign(Object.assign({},t),{url:Pr(t.url)})}var Xn=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};class xi{constructor(e){this.contextMenus={},this.handleClick=i=>{var n;const d=this.contextMenus[i.id];d&&((n=d.onClick)===null||n===void 0||n.call(d,i.context,i.elementId))},this.messageBus=e,e.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(e){return Xn(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:e.id,shortcut:e.shortcut,icons:lt(e.icons),embed:e.embed&&Rn(e.embed)}),this.contextMenus[e.id]=e})}remove(e){return Xn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:e}),delete this.contextMenus[e]})}}var _e=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};class Wi{constructor(e){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=i=>{const n=this.tools[i.id];if(n)if(n.onClick){const d=n.onClick(i.context,i.elementId);Promise.resolve(d).then(o=>{o&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:i.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:i.id})},this.handleToolActionClick=i=>{var n;const d=this.toolActions[i.id];d&&((n=d.onClick)===null||n===void 0||n.call(d,i.context,i.elementId))},this.handleToolModeClick=i=>{const n=this.toolModes[i.id];if(n)if(n.onClick){const d=n.onClick(i.context,i.elementId);Promise.resolve(d).then(o=>{o&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:i.context.activeTool,modeId:i.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:i.context.activeTool,modeId:i.id})},this.handleToolModeToolClick=i=>{const n=this.toolModes[i.id];if(n)if(n.onToolClick){const d=n.onToolClick(i.context,i.event);Promise.resolve(d).then(o=>{o&&i.event.target&&!i.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[i.event.target.id]})})}else i.event.target&&!i.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[i.event.target.id]})},this.handleToolModeToolDoubleClick=i=>{const n=this.toolModes[i.id];if(n)if(n.onToolDoubleClick){const d=n.onToolDoubleClick(i.context,i.event);Promise.resolve(d).then(o=>{o&&i.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[i.event.target.id]})})}else i.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[i.event.target.id]})},this.handleToolModeToolDown=i=>{var n;const d=this.toolModes[i.id];d&&((n=d.onToolDown)===null||n===void 0||n.call(d,i.context,i.event))},this.handleToolModeToolMove=i=>{var n;const d=this.toolModes[i.id];d&&((n=d.onToolMove)===null||n===void 0||n.call(d,i.context,i.event))},this.handleToolModeToolUp=i=>{var n;const d=this.toolModes[i.id];d&&((n=d.onToolUp)===null||n===void 0||n.call(d,i.context,i.event))},this.handleToolModeToolDragStart=i=>{var n;const d=this.toolModes[i.id];d&&((n=d.onToolDragStart)===null||n===void 0||n.call(d,i.context,i.event))},this.handleToolModeToolDragMove=i=>{var n;const d=this.toolModes[i.id];d&&((n=d.onToolDragMove)===null||n===void 0||n.call(d,i.context,i.event))},this.handleToolModeToolDragEnd=i=>{var n;const d=this.toolModes[i.id];d&&((n=d.onToolDragEnd)===null||n===void 0||n.call(d,i.context,i.event))},this.handleToolModeToolDragCancel=i=>{var n;const d=this.toolModes[i.id];d&&((n=d.onToolDragCancel)===null||n===void 0||n.call(d,i.context,i.event))},this.handleToolModeKeyDown=i=>{var n;const d=this.toolModes[i.id];d&&((n=d.onKeyDown)===null||n===void 0||n.call(d,i.context,i.event))},this.handleToolModeKeyUp=i=>{var n;const d=this.toolModes[i.id];d&&((n=d.onKeyUp)===null||n===void 0||n.call(d,i.context,i.event))},this.handleToolModeActivate=i=>{var n;const d=this.toolModes[i.id];d&&((n=d.onActivate)===null||n===void 0||n.call(d,i.context))},this.handleToolModeDeactivate=i=>{var n;const d=this.toolModes[i.id];d&&((n=d.onDeactivate)===null||n===void 0||n.call(d,i.context))},this.messageBus=e,e.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),e.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),e.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),e.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),e.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),e.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),e.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),e.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(e){return _e(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:e.id,shortcut:e.shortcut,defaultMode:e.defaultMode,defaultMetadata:e.defaultMetadata,icons:lt(e.icons),disabled:e.disabled}),this.tools[e.id]=e})}remove(e){return _e(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:e}),delete this.tools[e]})}activateTool(e){return _e(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:e})})}getActiveTool(){return _e(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_TOOL_GET_ACTIVE",{});return e})}onToolChange(e){const i=n=>{e(n.id)};return this.messageBus.send("OBR_TOOL_ACTIVE_SUBSCRIBE",{}),this.messageBus.on("OBR_TOOL_ACTIVE_EVENT_CHANGE",i),()=>{this.messageBus.send("OBR_TOOL_ACTIVE_UNSUBSCRIBE",{}),this.messageBus.off("OBR_TOOL_ACTIVE_EVENT_CHANGE",i)}}getMetadata(e){return _e(this,void 0,void 0,function*(){const{metadata:i}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:e});return i})}setMetadata(e,i){return _e(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:e,update:i})})}createAction(e){return _e(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:e.id,shortcut:e.shortcut,icons:lt(e.icons),disabled:e.disabled}),this.toolActions[e.id]=e})}removeAction(e){return _e(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:e}),delete this.tools[e]})}createMode(e){return _e(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:e.id,shortcut:e.shortcut,icons:lt(e.icons),preventDrag:e.preventDrag,disabled:e.disabled,cursors:e.cursors}),this.toolModes[e.id]=e})}removeMode(e){return _e(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:e}),delete this.tools[e]})}activateMode(e,i){return _e(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:e,modeId:i})})}getActiveToolMode(){return _e(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_TOOL_MODE_GET_ACTIVE",{});return e})}onToolModeChange(e){const i=n=>{e(n.id)};return this.messageBus.send("OBR_TOOL_MODE_ACTIVE_SUBSCRIBE",{}),this.messageBus.on("OBR_TOOL_MODE_ACTIVE_EVENT_CHANGE",i),()=>{this.messageBus.send("OBR_TOOL_MODE_ACTIVE_UNSUBSCRIBE",{}),this.messageBus.off("OBR_TOOL_MODE_ACTIVE_EVENT_CHANGE",i)}}}var Ze=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};class Fi{constructor(e){this.messageBus=e}open(e){return Ze(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},Rn(e)))})}close(e){return Ze(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:e})})}getWidth(e){return Ze(this,void 0,void 0,function*(){const{width:i}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:e});return i})}setWidth(e,i){return Ze(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:e,width:i})})}getHeight(e){return Ze(this,void 0,void 0,function*(){const{height:i}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:e});return i})}setHeight(e,i){return Ze(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:e,height:i})})}}var qn=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};class Yi{constructor(e){this.messageBus=e}open(e){return qn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},Rn(e)))})}close(e){return qn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:e})})}}var oe=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};class Xi{constructor(e){this.messageBus=e}getWidth(){return oe(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return e})}setWidth(e){return oe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:e})})}getHeight(){return oe(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return e})}setHeight(e){return oe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:e})})}getBadgeText(){return oe(this,void 0,void 0,function*(){const{badgeText:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return e})}setBadgeText(e){return oe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:e})})}getBadgeBackgroundColor(){return oe(this,void 0,void 0,function*(){const{badgeBackgroundColor:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return e})}setBadgeBackgroundColor(e){return oe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:e})})}getIcon(){return oe(this,void 0,void 0,function*(){const{icon:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return e})}setIcon(e){return oe(this,void 0,void 0,function*(){const i=lt([{icon:e}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:i[0].icon})})}getTitle(){return oe(this,void 0,void 0,function*(){const{title:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return e})}setTitle(e){return oe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:e})})}isOpen(){return oe(this,void 0,void 0,function*(){const{isOpen:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return e})}open(){return oe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return oe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(e){const i=n=>{e(n.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",i),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",i)}}}var qi=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};Sn();class Ki{constructor(e){this.messageBus=e}startItemInteraction(e){return qi(this,void 0,void 0,function*(){const{id:i}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:e});let n=e;return[u=>{const[p,_]=Cn(n,u);return n=p,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:i,patches:_}),p},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:i})}]})}}var Zi=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};class Qi{constructor(e){this.messageBus=e}getPlayers(){return Zi(this,void 0,void 0,function*(){const{players:e}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return e})}onChange(e){const i=n=>{e(n.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",i),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",i)}}}var an=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};class Ji{constructor(e){this.messageBus=e}get id(){return this.messageBus.roomId}getPermissions(){return an(this,void 0,void 0,function*(){const{permissions:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return e})}getMetadata(){return an(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return e})}setMetadata(e){return an(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:e})})}onMetadataChange(e){const i=n=>{e(n.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",i),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",i)}}onPermissionsChange(e){const i=n=>{e(n.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",i),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",i)}}}var ea=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};class ta{constructor(e){this.messageBus=e}getTheme(){return ea(this,void 0,void 0,function*(){const{theme:e}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return e})}onChange(e){const i=n=>{e(n.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",i),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",i)}}}var jt=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};class na{constructor(e){this.messageBus=e}uploadImages(e,i){return jt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_IMAGES",{images:e,typeHint:i})})}uploadScenes(e,i){return jt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_SCENES",{scenes:e,disableShowScenes:i})})}downloadImages(e,i,n){return jt(this,void 0,void 0,function*(){const{images:d}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_IMAGES",{multiple:e,defaultSearch:i,typeHint:n},-1);return d})}downloadScenes(e,i){return jt(this,void 0,void 0,function*(){const{scenes:n}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_SCENES",{multiple:e,defaultSearch:i},-1);return n})}}var ra=function(t,e,i,n){function d(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function p(l){try{v(n.next(l))}catch(w){u(w)}}function _(l){try{v(n.throw(l))}catch(w){u(w)}}function v(l){l.done?o(l.value):d(l.value).then(p,_)}v((n=n.apply(t,e||[])).next())})};class ia{constructor(e){this.messageBus=e}sendMessage(e,i,n){return ra(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_BROADCAST_SEND_MESSAGE",{channel:e,data:i,options:n})})}onMessage(e,i){return this.messageBus.send("OBR_BROADCAST_SUBSCRIBE",{channel:e}),this.messageBus.on(`OBR_BROADCAST_MESSAGE_${e}`,i),()=>{this.messageBus.send("OBR_BROADCAST_UNSUBSCRIBE",{channel:e}),this.messageBus.off(`OBR_BROADCAST_MESSAGE_${e}`,i)}}}class Dr{constructor(e){this._item={createdUserId:e.id,id:Br(),name:"Item",zIndex:Date.now(),lastModified:new Date().toISOString(),lastModifiedUserId:e.id,locked:!1,metadata:{},position:{x:0,y:0},rotation:0,scale:{x:1,y:1},type:"ITEM",visible:!0,layer:"POPOVER"}}createdUserId(e){return this._item.createdUserId=e,this.self()}id(e){return this._item.id=e,this.self()}name(e){return this._item.name=e,this.self()}description(e){return this._item.description=e,this.self()}lastModified(e){return this._item.lastModified=e,this.self()}zIndex(e){return this._item.zIndex=e,this.self()}lastModifiedUserId(e){return this._item.lastModifiedUserId=e,this.self()}locked(e){return this._item.locked=e,this.self()}metadata(e){return this._item.metadata=e,this.self()}position(e){return this._item.position=e,this.self()}rotation(e){return this._item.rotation=e,this.self()}scale(e){return this._item.scale=e,this.self()}visible(e){return this._item.visible=e,this.self()}attachedTo(e){return this._item.attachedTo=e,this.self()}layer(e){return this._item.layer=e,this.self()}disableHit(e){return this._item.disableHit=e,this.self()}disableAutoZIndex(e){return this._item.disableAutoZIndex=e,this.self()}disableAttachmentBehavior(e){return this._item.disableAttachmentBehavior=e,this.self()}self(){return this}}class aa extends Dr{constructor(e){super(e),this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:0,fontFamily:"Roboto",fontSize:16,fontWeight:400,textAlign:"LEFT",textAlignVertical:"TOP",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"RICH",width:"AUTO",height:"AUTO"},this._item.layer="TEXT",this._item.name="Text"}text(e){return this._text=e,this.self()}width(e){return this._text.width=e,this.self()}height(e){return this._text.height=e,this.self()}richText(e){return this._text.richText=e,this.self()}plainText(e){return this._text.plainText=e,this.self()}textType(e){return this._text.type=e,this.self()}padding(e){return this._text.style.padding=e,this.self()}fontFamily(e){return this._text.style.fontFamily=e,this.self()}fontSize(e){return this._text.style.fontSize=e,this.self()}fontWeight(e){return this._text.style.fontWeight=e,this.self()}textAlign(e){return this._text.style.textAlign=e,this.self()}textAlignVertical(e){return this._text.style.textAlignVertical=e,this.self()}fillColor(e){return this._text.style.fillColor=e,this.self()}fillOpacity(e){return this._text.style.fillOpacity=e,this.self()}strokeColor(e){return this._text.style.strokeColor=e,this.self()}strokeOpacity(e){return this._text.style.strokeOpacity=e,this.self()}strokeWidth(e){return this._text.style.strokeWidth=e,this.self()}lineHeight(e){return this._text.style.lineHeight=e,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"TEXT",text:this._text})}}class sa extends Dr{constructor(e){super(e),this._commands=[],this._fillRule="nonzero",this._style={fillColor:"black",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:5,strokeDash:[]},this._item.name="Path",this._item.layer="DRAWING"}commands(e){return this._commands=e,this.self()}fillRule(e){return this._fillRule=e,this.self()}style(e){return this._style=e,this.self()}fillColor(e){return this._style.fillColor=e,this.self()}fillOpacity(e){return this._style.fillOpacity=e,this.self()}strokeColor(e){return this._style.strokeColor=e,this.self()}strokeOpacity(e){return this._style.strokeOpacity=e,this.self()}strokeWidth(e){return this._style.strokeWidth=e,this.self()}strokeDash(e){return this._style.strokeDash=e,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"PATH",commands:this._commands,fillRule:this._fillRule,style:this._style})}}const Bn=typeof Buffer=="function",Kn=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const da="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",oa=Array.prototype.slice.call(da),zt=(t=>{let e={};return t.forEach((i,n)=>e[i]=n),e})(oa),ua=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,ze=String.fromCharCode.bind(String),Zn=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),Hr=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),ca=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,la=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),i=e-65536;return ze((i>>>10)+55296)+ze((i&1023)+56320);case 3:return ze((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return ze((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},fa=t=>t.replace(ca,la),ha=t=>{if(t=t.replace(/\s+/g,""),!ua.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,i="",n,d;for(let o=0;o<t.length;)e=zt[t.charAt(o++)]<<18|zt[t.charAt(o++)]<<12|(n=zt[t.charAt(o++)])<<6|(d=zt[t.charAt(o++)]),i+=n===64?ze(e>>16&255):d===64?ze(e>>16&255,e>>8&255):ze(e>>16&255,e>>8&255,e&255);return i},jr=typeof atob=="function"?t=>atob(Hr(t)):Bn?t=>Buffer.from(t,"base64").toString("binary"):ha,pa=Bn?t=>Zn(Buffer.from(t,"base64")):t=>Zn(jr(t).split("").map(e=>e.charCodeAt(0))),ma=Bn?t=>Buffer.from(t,"base64").toString("utf8"):Kn?t=>Kn.decode(pa(t)):t=>fa(jr(t)),_a=t=>Hr(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),ga=t=>ma(_a(t));function ya(){const e=new URLSearchParams(window.location.search).get("obrref");let i="",n="";if(e){const o=ga(e).split(" ");o.length===2&&(i=o[0],n=o[1])}return{origin:i,roomId:n}}function Qn(t){return t.type==="IMAGE"}var K;(function(t){t[t.MOVE=0]="MOVE",t[t.LINE=1]="LINE",t[t.QUAD=2]="QUAD",t[t.CONIC=3]="CONIC",t[t.CUBIC=4]="CUBIC",t[t.CLOSE=5]="CLOSE"})(K||(K={}));const gn=ya(),ne=new Si(gn.origin,gn.roomId),va=new fi(ne),In=new li(ne),wa=new Qi(ne),ba=new Ci(ne),Ea=new Vi(ne),Oa=new xi(ne),Ta=new Wi(ne),Aa=new Fi(ne),Sa=new Yi(ne),Ca=new Xi(ne),Ra=new Ki(ne),Ba=new Ji(ne),Ia=new ta(ne),ka=new na(ne),Ma=new ia(ne),j={onReady:t=>{ne.ready?t():ne.once("OBR_READY",()=>t())},get isReady(){return ne.ready},viewport:va,player:In,party:wa,notification:ba,scene:Ea,contextMenu:Oa,tool:Ta,popover:Aa,modal:Sa,action:Ca,interaction:Ra,room:Ba,theme:Ia,assets:ka,broadcast:Ma,isAvailable:!!gn.origin};function Na(){return new aa(In)}function Jn(){return new sa(In)}class U{static EXTENSIONID="com.battle-system.theatre";static STORAGEID="com.battle-system.theatre-storage";static SELECTEDTOKENOPTION="SELECTED-0000";static BROADCASTCHANNEL="com.battle-system.theatre-broadcast";static STORAGECHANNEL="com.battle-system.theatre-storage-broadcast";static CLOSECHANNEL="com.battle-system.theatre-close";static SELFCHANNEL="com.battle-system.threatre-self";static RUMBLECHANNEL="THEATRERUMBLE";static CHECKREGISTRATION="https://vrwtdtmnbyhaehtitrlb.supabase.co/functions/v1/patreon-check";static ANONAUTH="Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0";static CLOSEBUTTON=[[K.MOVE,0,-50],[K.QUAD,50,-50,50,0],[K.QUAD,50,50,0,50],[K.QUAD,-50,50,-50,0],[K.QUAD,-50,-50,0,-50],[K.MOVE,-35,-35],[K.LINE,35,35],[K.MOVE,-35,35],[K.LINE,35,-35],[K.CLOSE]];static MULTIPAGE=`What is Lorem Ipsum?
Lorem Ipsum is simply dummy text of the printing and typesetting industry.
 Lorem Ipsum has been the industry's standard dummy text ever since the 1500s,
 when an unknown printer took a galley of type and scrambled it to make a type specimen book.
 It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged.
::
Why are you doing this?	 Who knows.

Because I hate writing filler text.
`;static LOGHTML=`<b>LOG HISTORY</b><div class="full-container">
        <ul id="dialogLog">
        </ul>
        </div>`;static FRESHPRINCE=`Now, this is a story all about how

        My life got flipped-turned upside down

        And I'd like to take a minute

        Just sit right there

        I'll tell you how I became the prince of a town called Bel-Air

        In West Philadelphia born and raised

        On the playground was where I spent most of my days

        Chillin' out, maxin', relaxin', all cool

        And all shootin' some b-ball outside of the school

        When a couple of guys who were up to no good

        Started making trouble in my neighborhood

        I got in one little fight and my mom got scared

        She said, "You're movin' with your auntie and uncle in Bel-Air"

        I begged and pleaded with her day after day

        But she packed my suitcase and sent me on my way

        She gave me a kiss and then she gave me my ticket

        I put my Walkman on and said, "I might as well kick it"

        First class, yo this is bad`;static MARKDOWNHELP=`
<a id="theatre" name="theatre"></a>
<!-- TABLE OF CONTENTS -->
<details open>
<summary>Table of Contents</summary>
<ol>
<li><a href="#getting-started">Getting Started</a>
<li><a href="#theatre-ui">Theatre UI</a>
<ul>
<li><a href="#ui-token">Token Selector</a></li>
<li><a href="#ui-override">Override Input</a></li>
<li><a href="#ui-style">Style Selector</a></li>
<li><a href="#ui-speech">Speech Range Inputs (Whisper/Talk/Yell)</a></li>
<li><a href="#ui-message">Message Box</a></li>
<li><a href="#ui-range">Target/Range Selector</a></li>
</ul></li>
<li><a href="#dialogue-styles">Dialogue Styles</a>
<ul>
<li><a href="#style-dialogue">Dialogue</a></li>
<li><a href="#style-bubble">Speech Bubble</a></li>
<li><a href="#style-notification">Notification</a></li>
</ul>
<li><a href="#support">Support</a></li>
</ol>
</details>

<p align="right">(<a href="#theatre">back to top</a>)</p>


## <a id="getting-started" name="getting-started"></a>Getting Started
Theatre! operates on two wave-lengths.
1. Message-Box style dialogue delivery, which comes across in a 'type-writer' style of one character at a time.  You can queue up several 'pages' at once and it will be sent to all players, displayed with the image of the token that is currently selected.
2. Speech Bubble style dialogue delivery, which let's you choose a token and select 'How Loud' they are saying their message.  It will then be drawn on the map via a text bubble, and only players who have a token in range will be able to hear (see) it.
<p align="right">(<a href="#theatre">back to top</a>)</p>

## <a id="theatre-ui" name="theatre-ui">Theatre UI
<i>Note: All players have access to the Theatre UI, but only the GM can change the speech bubble ranges.</i>
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-ui.png)

#### <a id="ui-token"></a>1. Token Selector
The Token Selector compiles a list of all tokens the user has access to, using the label name - or the default token name if no label name is available.
When used with Dialogue-Style/Notification-Style, this controls which image/name is used for the dialogue window.
When used with Bubble-Style, this controls where the speech bubble will appear from and where the range is based on.
<i>Note: The input will pulse red briefly if there is a change on the map that would've resulted in a change in the list, to let you know the selection may have changed.</i>

#### <a id="ui-override"></a>2. Override Input
The Override input is to 'override' the token name that is displayed with the displayed text.
Useful if you want to obscure something's 'true name' but still use the image.

#### <a id="ui-style"></a>3. Style Selector
There are three different chat styles to choose from.  Dialogue, Speech Bubble and Notification.  While Dialogue and Notification differ mostly in orientation (dialogue is a long narrow window, while notification is more of a poster) - speech bubble is completely different.
1. Dialogue Style
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-style1.png)

2. Notification Style 
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-style3.png)
3. Speech Bubble Style
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-style2.png)
<i>Note: Only players who own a token in the range of the token speaking via Speech Bubble will be able to see it. Please make sure your players are properly owning tokens!</i>

#### <a id="ui-speech"></a>4. Speech Range Inputs
These inputs only have an effect when using Speech Bubbles, as they discern the 'hearable' range for the text.  This number represents how many units away a token can be to hear/see the message.

#### <a id="ui-message"></a>5. Message Box
This is where you will type the message that appears in the dialogue window or speech bubble. 
When using the Dialogue/Notification window, you can use '::' to separate the pages for that message. For example;
"Hello, friend!::How are you?"
<i>Note: Paging is not available with Speech Bubbles.</i>
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-pages.webp)

#### <a id="ui-range"></a>6. Target/Range Selector
When on the Dialogue or Notification styles, you can select a 'target' for your message.  It can be sent to the entire party, or just a single person.
When using Speech Bubble style, you can choose which 'volume/range' you want your message to reach. If you have whisper set to 1 square, people 2 squares away or more won't be able to see it!

<p align="right">(<a href="#theatre">back to top</a>)</p>

## <a id="dialogue-styles" name="dialogue-styles">Dialogue Styles

#### <a id="style-dialogue"></a>1. Dialogue
The Dialogue style is your typical JRPG text-box that display in type-writer fashion.  If there are pages of text, a 'Next' arrow will flash next to where the close button is.
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-style1.png)
#### <a id="style-bubble"></a>2. Speech Bubble
Speech Bubbles are more of a chat-system than a post-it message, and is likely better suited to the style of game that wants to have more RP-based chats.  If you have 'View on Send' checked, you will also see the resulting speech bubble pop up on the token it was sent from.
There are some things to note in how it's used;
1. The outline and casing of the message is based on the volume.  Whispers are lower-cased and Blue. Talking is as-is and White.  Yelling is upper-cased and Red.
![notice view](https://battle-system.com/owlbear/theatre-docs/ui-speech1.png)
![notice view](https://battle-system.com/owlbear/theatre-docs/ui-speech2.png)
![notice view](https://battle-system.com/owlbear/theatre-docs/ui-speech3.png)
2. Who can see the message is based on WHERE the token is, what RANGE the token said the message at and WHO owns which tokens. As with the example below, Greensley cannot hear the whisper until he is 1 square away. (I have Whisper range set to 1 in this example.) ![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-whisper.webp)
And the following example shows a Yell, where the range is set to 20 squares.  So Greensley is able to see this despite not being close at all.
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-yell.webp)
3. For the person who sent the message, if you have 'View on Send' turned on - the speech bubble will stay attached to that character if you move the token.  THIS DOES NOT HAPPEN ON THE OTHER USERS END. To make it clear where something was said, the bubble stays where it was made.  You wouldn't want to whisper something, and then walk up to someone, and have that whisper travel with you right? No. (The correct answer is no.) The whisper stays where the whisper was made.
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-fart.webp)
<i>Note: I am aware that farts travel.</i>
4. Speech bubbles stay open until they are either closed (via the X button), the page is refreshed or until a new message is sent.  A new message will replace an old message. They are not queued up, it's similar to them talking too fast.


#### <a id="style-notification"></a>3. Notification
The notification style mimics the dialogue one, but in a 'poster' fashion. It's more suited to pre-prepped copy/pasted text as the formatting can be fickle at times. (Improvements to this will be made at a later date.)
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-notification.png)

<p align="right">(<a href="#theatre">back to top</a>)</p>

## Support

If you have questions, please join the [Owlbear Rodeo Discord](https://discord.gg/UY8AXjhzhe).

Or you can reach out to me at manuel@battle-system.com.
You can also support these projects at the [Battle-System Patreon](https://www.patreon.com/battlesystem).
<p align="right">(<a href="#flip">back to top</a>)</p>
`}async function La(t){if(/\.(jpg|jpeg|png|gif|bmp|webp|svg)$/i.test(t))return!0;if(!t.includes("http://")&&!t.includes("https://"))return!1;try{const i=await fetch(t,{method:"HEAD",mode:"no-cors"});if(i.type==="opaque")return!0;const n=i.headers.get("Content-Type");return n?n.startsWith("image/"):!1}catch(i){return console.error("Error checking image URL:",i),!1}}function Pa(){const t=document.createElement("img");return t.id="PatreonButton",t.setAttribute("class","icon"),t.classList.add("patreon-clickable"),t.setAttribute("title",te.USER_REGISTERED?"Thanks for subscribing!":"Get the news on updates on the Battle-System Patreon"),t.setAttribute("src",te.USER_REGISTERED?"/w-thankyou.svg":"/w-patreon-2.png"),t.onclick=async function(e){e.preventDefault(),window.open("https://www.patreon.com/battlesystem","_blank")},t}function er(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function zr(){let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const n=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i==="x"?n:n&3|8).toString(16)})}function sn(t,e){let i;return function(){clearTimeout(i),i=setTimeout(()=>{t()},e)}}function Da(){try{return localStorage.setItem("STORAGECHECK","test"),!0}catch{return!1}}function tr(t,e){const i=window.matchMedia("(prefers-color-scheme: dark)"),n=i.matches?"dark":"light",d=i.matches?"light":"dark";for(var o=0;o<e.styleSheets.length;o++)for(var u=0;u<e.styleSheets[o].cssRules.length;u++){let p=e.styleSheets[o].cssRules[u];p&&p.media&&p.media.mediaText.includes("prefers-color-scheme")&&(t.mode=="LIGHT"?(p.media.appendMedium(`(prefers-color-scheme: ${n})`),p.media.mediaText.includes(d)&&p.media.deleteMedium(`(prefers-color-scheme: ${d})`)):t.mode=="DARK"&&(p.media.appendMedium(`(prefers-color-scheme: ${d})`),p.media.mediaText.includes(n)&&p.media.deleteMedium(`(prefers-color-scheme: ${n})`)))}}function Ha(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function ja(t,e,i){return Ha(t,e)<=i}var Ur={exports:{}};(function(t){(function(){function e(r){var s={omitExtraWLInCodeBlocks:{defaultValue:!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{defaultValue:!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{defaultValue:!1,describe:"Add a prefix to the generated header ids. Passing a string will prefix that string to the header id. Setting to true will add a generic 'section-' prefix",type:"string"},rawPrefixHeaderId:{defaultValue:!1,describe:'Setting this option to true will prevent showdown from modifying the prefix. This might result in malformed IDs (if, for instance, the " char is used in the prefix)',type:"boolean"},ghCompatibleHeaderId:{defaultValue:!1,describe:"Generate header ids compatible with github style (spaces are replaced with dashes, a bunch of non alphanumeric chars are removed)",type:"boolean"},rawHeaderId:{defaultValue:!1,describe:`Remove only spaces, ' and " from generated header ids (including prefixes), replacing them with dashes (-). WARNING: This might result in malformed ids`,type:"boolean"},headerLevelStart:{defaultValue:!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{defaultValue:!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{defaultValue:!1,describe:"Turn on/off GFM autolink style",type:"boolean"},excludeTrailingPunctuationFromURLs:{defaultValue:!1,describe:"Excludes trailing punctuation from links generated with autoLinking",type:"boolean"},literalMidWordUnderscores:{defaultValue:!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},literalMidWordAsterisks:{defaultValue:!1,describe:"Parse midword asterisks as literal asterisks",type:"boolean"},strikethrough:{defaultValue:!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{defaultValue:!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{defaultValue:!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{defaultValue:!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{defaultValue:!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{defaultValue:!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"},smartIndentationFix:{defaultValue:!1,describe:"Tries to smartly fix indentation in es6 strings",type:"boolean"},disableForced4SpacesIndentedSublists:{defaultValue:!1,describe:"Disables the requirement of indenting nested sublists by 4 spaces",type:"boolean"},simpleLineBreaks:{defaultValue:!1,describe:"Parses simple line breaks as <br> (GFM Style)",type:"boolean"},requireSpaceBeforeHeadingText:{defaultValue:!1,describe:"Makes adding a space between `#` and the header text mandatory (GFM Style)",type:"boolean"},ghMentions:{defaultValue:!1,describe:"Enables github @mentions",type:"boolean"},ghMentionsLink:{defaultValue:"https://github.com/{u}",describe:"Changes the link generated by @mentions. Only applies if ghMentions option is enabled.",type:"string"},encodeEmails:{defaultValue:!0,describe:"Encode e-mail addresses through the use of Character Entities, transforming ASCII e-mail addresses into its equivalent decimal entities",type:"boolean"},openLinksInNewWindow:{defaultValue:!1,describe:"Open all links in new windows",type:"boolean"},backslashEscapesHTMLTags:{defaultValue:!1,describe:"Support for HTML Tag escaping. ex: <div>foo</div>",type:"boolean"},emoji:{defaultValue:!1,describe:"Enable emoji support. Ex: `this is a :smile: emoji`",type:"boolean"},underline:{defaultValue:!1,describe:"Enable support for underline. Syntax is double or triple underscores: `__underline word__`. With this option enabled, underscores no longer parses into `<em>` and `<strong>`",type:"boolean"},ellipsis:{defaultValue:!0,describe:"Replaces three dots with the ellipsis unicode character",type:"boolean"},completeHTMLDocument:{defaultValue:!1,describe:"Outputs a complete html document, including `<html>`, `<head>` and `<body>` tags",type:"boolean"},metadata:{defaultValue:!1,describe:"Enable support for document metadata (defined at the top of the document between `«««` and `»»»` or between `---` and `---`).",type:"boolean"},splitAdjacentBlockquotes:{defaultValue:!1,describe:"Split adjacent blockquote blocks",type:"boolean"}};if(r===!1)return JSON.parse(JSON.stringify(s));var a={};for(var c in s)s.hasOwnProperty(c)&&(a[c]=s[c].defaultValue);return a}function i(){var r=e(!0),s={};for(var a in r)r.hasOwnProperty(a)&&(s[a]=!0);return s}var n={},d={},o={},u=e(!0),p="vanilla",_={github:{omitExtraWLInCodeBlocks:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,disableForced4SpacesIndentedSublists:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghCompatibleHeaderId:!0,ghMentions:!0,backslashEscapesHTMLTags:!0,emoji:!0,splitAdjacentBlockquotes:!0},original:{noHeaderId:!0,ghCodeBlocks:!1},ghost:{omitExtraWLInCodeBlocks:!0,parseImgDimensions:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,smoothLivePreview:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghMentions:!1,encodeEmails:!0},vanilla:e(!0),allOn:i()};n.helper={},n.extensions={},n.setOption=function(r,s){return u[r]=s,this},n.getOption=function(r){return u[r]},n.getOptions=function(){return u},n.resetOptions=function(){u=e(!0)},n.setFlavor=function(r){if(!_.hasOwnProperty(r))throw Error(r+" flavor was not found");n.resetOptions();var s=_[r];p=r;for(var a in s)s.hasOwnProperty(a)&&(u[a]=s[a])},n.getFlavor=function(){return p},n.getFlavorOptions=function(r){if(_.hasOwnProperty(r))return _[r]},n.getDefaultOptions=function(r){return e(r)},n.subParser=function(r,s){if(n.helper.isString(r))if(typeof s<"u")d[r]=s;else{if(d.hasOwnProperty(r))return d[r];throw Error("SubParser named "+r+" not registered!")}},n.extension=function(r,s){if(!n.helper.isString(r))throw Error("Extension 'name' must be a string");if(r=n.helper.stdExtName(r),n.helper.isUndefined(s)){if(!o.hasOwnProperty(r))throw Error("Extension named "+r+" is not registered!");return o[r]}else{typeof s=="function"&&(s=s()),n.helper.isArray(s)||(s=[s]);var a=v(s,r);if(a.valid)o[r]=s;else throw Error(a.error)}},n.getAllExtensions=function(){return o},n.removeExtension=function(r){delete o[r]},n.resetExtensions=function(){o={}};function v(r,s){var a=s?"Error in "+s+" extension->":"Error in unnamed extension",c={valid:!0,error:""};n.helper.isArray(r)||(r=[r]);for(var m=0;m<r.length;++m){var g=a+" sub-extension "+m+": ",h=r[m];if(typeof h!="object")return c.valid=!1,c.error=g+"must be an object, but "+typeof h+" given",c;if(!n.helper.isString(h.type))return c.valid=!1,c.error=g+'property "type" must be a string, but '+typeof h.type+" given",c;var y=h.type=h.type.toLowerCase();if(y==="language"&&(y=h.type="lang"),y==="html"&&(y=h.type="output"),y!=="lang"&&y!=="output"&&y!=="listener")return c.valid=!1,c.error=g+"type "+y+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',c;if(y==="listener"){if(n.helper.isUndefined(h.listeners))return c.valid=!1,c.error=g+'. Extensions of type "listener" must have a property called "listeners"',c}else if(n.helper.isUndefined(h.filter)&&n.helper.isUndefined(h.regex))return c.valid=!1,c.error=g+y+' extensions must define either a "regex" property or a "filter" method',c;if(h.listeners){if(typeof h.listeners!="object")return c.valid=!1,c.error=g+'"listeners" property must be an object but '+typeof h.listeners+" given",c;for(var A in h.listeners)if(h.listeners.hasOwnProperty(A)&&typeof h.listeners[A]!="function")return c.valid=!1,c.error=g+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+A+" must be a function but "+typeof h.listeners[A]+" given",c}if(h.filter){if(typeof h.filter!="function")return c.valid=!1,c.error=g+'"filter" must be a function, but '+typeof h.filter+" given",c}else if(h.regex){if(n.helper.isString(h.regex)&&(h.regex=new RegExp(h.regex,"g")),!(h.regex instanceof RegExp))return c.valid=!1,c.error=g+'"regex" property must either be a string or a RegExp object, but '+typeof h.regex+" given",c;if(n.helper.isUndefined(h.replace))return c.valid=!1,c.error=g+'"regex" extensions must implement a replace string or function',c}}return c}n.validateExtension=function(r){var s=v(r,null);return s.valid?!0:(console.warn(s.error),!1)},n.hasOwnProperty("helper")||(n.helper={}),n.helper.isString=function(r){return typeof r=="string"||r instanceof String},n.helper.isFunction=function(r){var s={};return r&&s.toString.call(r)==="[object Function]"},n.helper.isArray=function(r){return Array.isArray(r)},n.helper.isUndefined=function(r){return typeof r>"u"},n.helper.forEach=function(r,s){if(n.helper.isUndefined(r))throw new Error("obj param is required");if(n.helper.isUndefined(s))throw new Error("callback param is required");if(!n.helper.isFunction(s))throw new Error("callback param must be a function/closure");if(typeof r.forEach=="function")r.forEach(s);else if(n.helper.isArray(r))for(var a=0;a<r.length;a++)s(r[a],a,r);else if(typeof r=="object")for(var c in r)r.hasOwnProperty(c)&&s(r[c],c,r);else throw new Error("obj does not seem to be an array or an iterable object")},n.helper.stdExtName=function(r){return r.replace(/[_?*+\/\\.^-]/g,"").replace(/\s/g,"").toLowerCase()};function l(r,s){var a=s.charCodeAt(0);return"¨E"+a+"E"}n.helper.escapeCharactersCallback=l,n.helper.escapeCharacters=function(r,s,a){var c="(["+s.replace(/([\[\]\\])/g,"\\$1")+"])";a&&(c="\\\\"+c);var m=new RegExp(c,"g");return r=r.replace(m,l),r},n.helper.unescapeHTMLEntities=function(r){return r.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};var w=function(r,s,a,c){var m=c||"",g=m.indexOf("g")>-1,h=new RegExp(s+"|"+a,"g"+m.replace(/g/g,"")),y=new RegExp(s,m.replace(/g/g,"")),A=[],b,O,S,f,T;do for(b=0;S=h.exec(r);)if(y.test(S[0]))b++||(O=h.lastIndex,f=O-S[0].length);else if(b&&!--b){T=S.index+S[0].length;var R={left:{start:f,end:O},match:{start:O,end:S.index},right:{start:S.index,end:T},wholeMatch:{start:f,end:T}};if(A.push(R),!g)return A}while(b&&(h.lastIndex=O));return A};n.helper.matchRecursiveRegExp=function(r,s,a,c){for(var m=w(r,s,a,c),g=[],h=0;h<m.length;++h)g.push([r.slice(m[h].wholeMatch.start,m[h].wholeMatch.end),r.slice(m[h].match.start,m[h].match.end),r.slice(m[h].left.start,m[h].left.end),r.slice(m[h].right.start,m[h].right.end)]);return g},n.helper.replaceRecursiveRegExp=function(r,s,a,c,m){if(!n.helper.isFunction(s)){var g=s;s=function(){return g}}var h=w(r,a,c,m),y=r,A=h.length;if(A>0){var b=[];h[0].wholeMatch.start!==0&&b.push(r.slice(0,h[0].wholeMatch.start));for(var O=0;O<A;++O)b.push(s(r.slice(h[O].wholeMatch.start,h[O].wholeMatch.end),r.slice(h[O].match.start,h[O].match.end),r.slice(h[O].left.start,h[O].left.end),r.slice(h[O].right.start,h[O].right.end))),O<A-1&&b.push(r.slice(h[O].wholeMatch.end,h[O+1].wholeMatch.start));h[A-1].wholeMatch.end<r.length&&b.push(r.slice(h[A-1].wholeMatch.end)),y=b.join("")}return y},n.helper.regexIndexOf=function(r,s,a){if(!n.helper.isString(r))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";if(!(s instanceof RegExp))throw"InvalidArgumentError: second parameter of showdown.helper.regexIndexOf function must be an instance of RegExp";var c=r.substring(a||0).search(s);return c>=0?c+(a||0):c},n.helper.splitAtIndex=function(r,s){if(!n.helper.isString(r))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";return[r.substring(0,s),r.substring(s)]},n.helper.encodeEmailAddress=function(r){var s=[function(a){return"&#"+a.charCodeAt(0)+";"},function(a){return"&#x"+a.charCodeAt(0).toString(16)+";"},function(a){return a}];return r=r.replace(/./g,function(a){if(a==="@")a=s[Math.floor(Math.random()*2)](a);else{var c=Math.random();a=c>.9?s[2](a):c>.45?s[1](a):s[0](a)}return a}),r},n.helper.padEnd=function(s,a,c){return a=a>>0,c=String(c||" "),s.length>a?String(s):(a=a-s.length,a>c.length&&(c+=c.repeat(a/c.length)),String(s)+c.slice(0,a))},typeof console>"u"&&(console={warn:function(r){alert(r)},log:function(r){alert(r)},error:function(r){throw r}}),n.helper.regexes={asteriskDashAndColon:/([*_:~])/g},n.helper.emojis={"+1":"👍","-1":"👎",100:"💯",1234:"🔢","1st_place_medal":"🥇","2nd_place_medal":"🥈","3rd_place_medal":"🥉","8ball":"🎱",a:"🅰️",ab:"🆎",abc:"🔤",abcd:"🔡",accept:"🉑",aerial_tramway:"🚡",airplane:"✈️",alarm_clock:"⏰",alembic:"⚗️",alien:"👽",ambulance:"🚑",amphora:"🏺",anchor:"⚓️",angel:"👼",anger:"💢",angry:"😠",anguished:"😧",ant:"🐜",apple:"🍎",aquarius:"♒️",aries:"♈️",arrow_backward:"◀️",arrow_double_down:"⏬",arrow_double_up:"⏫",arrow_down:"⬇️",arrow_down_small:"🔽",arrow_forward:"▶️",arrow_heading_down:"⤵️",arrow_heading_up:"⤴️",arrow_left:"⬅️",arrow_lower_left:"↙️",arrow_lower_right:"↘️",arrow_right:"➡️",arrow_right_hook:"↪️",arrow_up:"⬆️",arrow_up_down:"↕️",arrow_up_small:"🔼",arrow_upper_left:"↖️",arrow_upper_right:"↗️",arrows_clockwise:"🔃",arrows_counterclockwise:"🔄",art:"🎨",articulated_lorry:"🚛",artificial_satellite:"🛰",astonished:"😲",athletic_shoe:"👟",atm:"🏧",atom_symbol:"⚛️",avocado:"🥑",b:"🅱️",baby:"👶",baby_bottle:"🍼",baby_chick:"🐤",baby_symbol:"🚼",back:"🔙",bacon:"🥓",badminton:"🏸",baggage_claim:"🛄",baguette_bread:"🥖",balance_scale:"⚖️",balloon:"🎈",ballot_box:"🗳",ballot_box_with_check:"☑️",bamboo:"🎍",banana:"🍌",bangbang:"‼️",bank:"🏦",bar_chart:"📊",barber:"💈",baseball:"⚾️",basketball:"🏀",basketball_man:"⛹️",basketball_woman:"⛹️&zwj;♀️",bat:"🦇",bath:"🛀",bathtub:"🛁",battery:"🔋",beach_umbrella:"🏖",bear:"🐻",bed:"🛏",bee:"🐝",beer:"🍺",beers:"🍻",beetle:"🐞",beginner:"🔰",bell:"🔔",bellhop_bell:"🛎",bento:"🍱",biking_man:"🚴",bike:"🚲",biking_woman:"🚴&zwj;♀️",bikini:"👙",biohazard:"☣️",bird:"🐦",birthday:"🎂",black_circle:"⚫️",black_flag:"🏴",black_heart:"🖤",black_joker:"🃏",black_large_square:"⬛️",black_medium_small_square:"◾️",black_medium_square:"◼️",black_nib:"✒️",black_small_square:"▪️",black_square_button:"🔲",blonde_man:"👱",blonde_woman:"👱&zwj;♀️",blossom:"🌼",blowfish:"🐡",blue_book:"📘",blue_car:"🚙",blue_heart:"💙",blush:"😊",boar:"🐗",boat:"⛵️",bomb:"💣",book:"📖",bookmark:"🔖",bookmark_tabs:"📑",books:"📚",boom:"💥",boot:"👢",bouquet:"💐",bowing_man:"🙇",bow_and_arrow:"🏹",bowing_woman:"🙇&zwj;♀️",bowling:"🎳",boxing_glove:"🥊",boy:"👦",bread:"🍞",bride_with_veil:"👰",bridge_at_night:"🌉",briefcase:"💼",broken_heart:"💔",bug:"🐛",building_construction:"🏗",bulb:"💡",bullettrain_front:"🚅",bullettrain_side:"🚄",burrito:"🌯",bus:"🚌",business_suit_levitating:"🕴",busstop:"🚏",bust_in_silhouette:"👤",busts_in_silhouette:"👥",butterfly:"🦋",cactus:"🌵",cake:"🍰",calendar:"📆",call_me_hand:"🤙",calling:"📲",camel:"🐫",camera:"📷",camera_flash:"📸",camping:"🏕",cancer:"♋️",candle:"🕯",candy:"🍬",canoe:"🛶",capital_abcd:"🔠",capricorn:"♑️",car:"🚗",card_file_box:"🗃",card_index:"📇",card_index_dividers:"🗂",carousel_horse:"🎠",carrot:"🥕",cat:"🐱",cat2:"🐈",cd:"💿",chains:"⛓",champagne:"🍾",chart:"💹",chart_with_downwards_trend:"📉",chart_with_upwards_trend:"📈",checkered_flag:"🏁",cheese:"🧀",cherries:"🍒",cherry_blossom:"🌸",chestnut:"🌰",chicken:"🐔",children_crossing:"🚸",chipmunk:"🐿",chocolate_bar:"🍫",christmas_tree:"🎄",church:"⛪️",cinema:"🎦",circus_tent:"🎪",city_sunrise:"🌇",city_sunset:"🌆",cityscape:"🏙",cl:"🆑",clamp:"🗜",clap:"👏",clapper:"🎬",classical_building:"🏛",clinking_glasses:"🥂",clipboard:"📋",clock1:"🕐",clock10:"🕙",clock1030:"🕥",clock11:"🕚",clock1130:"🕦",clock12:"🕛",clock1230:"🕧",clock130:"🕜",clock2:"🕑",clock230:"🕝",clock3:"🕒",clock330:"🕞",clock4:"🕓",clock430:"🕟",clock5:"🕔",clock530:"🕠",clock6:"🕕",clock630:"🕡",clock7:"🕖",clock730:"🕢",clock8:"🕗",clock830:"🕣",clock9:"🕘",clock930:"🕤",closed_book:"📕",closed_lock_with_key:"🔐",closed_umbrella:"🌂",cloud:"☁️",cloud_with_lightning:"🌩",cloud_with_lightning_and_rain:"⛈",cloud_with_rain:"🌧",cloud_with_snow:"🌨",clown_face:"🤡",clubs:"♣️",cocktail:"🍸",coffee:"☕️",coffin:"⚰️",cold_sweat:"😰",comet:"☄️",computer:"💻",computer_mouse:"🖱",confetti_ball:"🎊",confounded:"😖",confused:"😕",congratulations:"㊗️",construction:"🚧",construction_worker_man:"👷",construction_worker_woman:"👷&zwj;♀️",control_knobs:"🎛",convenience_store:"🏪",cookie:"🍪",cool:"🆒",policeman:"👮",copyright:"©️",corn:"🌽",couch_and_lamp:"🛋",couple:"👫",couple_with_heart_woman_man:"💑",couple_with_heart_man_man:"👨&zwj;❤️&zwj;👨",couple_with_heart_woman_woman:"👩&zwj;❤️&zwj;👩",couplekiss_man_man:"👨&zwj;❤️&zwj;💋&zwj;👨",couplekiss_man_woman:"💏",couplekiss_woman_woman:"👩&zwj;❤️&zwj;💋&zwj;👩",cow:"🐮",cow2:"🐄",cowboy_hat_face:"🤠",crab:"🦀",crayon:"🖍",credit_card:"💳",crescent_moon:"🌙",cricket:"🏏",crocodile:"🐊",croissant:"🥐",crossed_fingers:"🤞",crossed_flags:"🎌",crossed_swords:"⚔️",crown:"👑",cry:"😢",crying_cat_face:"😿",crystal_ball:"🔮",cucumber:"🥒",cupid:"💘",curly_loop:"➰",currency_exchange:"💱",curry:"🍛",custard:"🍮",customs:"🛃",cyclone:"🌀",dagger:"🗡",dancer:"💃",dancing_women:"👯",dancing_men:"👯&zwj;♂️",dango:"🍡",dark_sunglasses:"🕶",dart:"🎯",dash:"💨",date:"📅",deciduous_tree:"🌳",deer:"🦌",department_store:"🏬",derelict_house:"🏚",desert:"🏜",desert_island:"🏝",desktop_computer:"🖥",male_detective:"🕵️",diamond_shape_with_a_dot_inside:"💠",diamonds:"♦️",disappointed:"😞",disappointed_relieved:"😥",dizzy:"💫",dizzy_face:"😵",do_not_litter:"🚯",dog:"🐶",dog2:"🐕",dollar:"💵",dolls:"🎎",dolphin:"🐬",door:"🚪",doughnut:"🍩",dove:"🕊",dragon:"🐉",dragon_face:"🐲",dress:"👗",dromedary_camel:"🐪",drooling_face:"🤤",droplet:"💧",drum:"🥁",duck:"🦆",dvd:"📀","e-mail":"📧",eagle:"🦅",ear:"👂",ear_of_rice:"🌾",earth_africa:"🌍",earth_americas:"🌎",earth_asia:"🌏",egg:"🥚",eggplant:"🍆",eight_pointed_black_star:"✴️",eight_spoked_asterisk:"✳️",electric_plug:"🔌",elephant:"🐘",email:"✉️",end:"🔚",envelope_with_arrow:"📩",euro:"💶",european_castle:"🏰",european_post_office:"🏤",evergreen_tree:"🌲",exclamation:"❗️",expressionless:"😑",eye:"👁",eye_speech_bubble:"👁&zwj;🗨",eyeglasses:"👓",eyes:"👀",face_with_head_bandage:"🤕",face_with_thermometer:"🤒",fist_oncoming:"👊",factory:"🏭",fallen_leaf:"🍂",family_man_woman_boy:"👪",family_man_boy:"👨&zwj;👦",family_man_boy_boy:"👨&zwj;👦&zwj;👦",family_man_girl:"👨&zwj;👧",family_man_girl_boy:"👨&zwj;👧&zwj;👦",family_man_girl_girl:"👨&zwj;👧&zwj;👧",family_man_man_boy:"👨&zwj;👨&zwj;👦",family_man_man_boy_boy:"👨&zwj;👨&zwj;👦&zwj;👦",family_man_man_girl:"👨&zwj;👨&zwj;👧",family_man_man_girl_boy:"👨&zwj;👨&zwj;👧&zwj;👦",family_man_man_girl_girl:"👨&zwj;👨&zwj;👧&zwj;👧",family_man_woman_boy_boy:"👨&zwj;👩&zwj;👦&zwj;👦",family_man_woman_girl:"👨&zwj;👩&zwj;👧",family_man_woman_girl_boy:"👨&zwj;👩&zwj;👧&zwj;👦",family_man_woman_girl_girl:"👨&zwj;👩&zwj;👧&zwj;👧",family_woman_boy:"👩&zwj;👦",family_woman_boy_boy:"👩&zwj;👦&zwj;👦",family_woman_girl:"👩&zwj;👧",family_woman_girl_boy:"👩&zwj;👧&zwj;👦",family_woman_girl_girl:"👩&zwj;👧&zwj;👧",family_woman_woman_boy:"👩&zwj;👩&zwj;👦",family_woman_woman_boy_boy:"👩&zwj;👩&zwj;👦&zwj;👦",family_woman_woman_girl:"👩&zwj;👩&zwj;👧",family_woman_woman_girl_boy:"👩&zwj;👩&zwj;👧&zwj;👦",family_woman_woman_girl_girl:"👩&zwj;👩&zwj;👧&zwj;👧",fast_forward:"⏩",fax:"📠",fearful:"😨",feet:"🐾",female_detective:"🕵️&zwj;♀️",ferris_wheel:"🎡",ferry:"⛴",field_hockey:"🏑",file_cabinet:"🗄",file_folder:"📁",film_projector:"📽",film_strip:"🎞",fire:"🔥",fire_engine:"🚒",fireworks:"🎆",first_quarter_moon:"🌓",first_quarter_moon_with_face:"🌛",fish:"🐟",fish_cake:"🍥",fishing_pole_and_fish:"🎣",fist_raised:"✊",fist_left:"🤛",fist_right:"🤜",flags:"🎏",flashlight:"🔦",fleur_de_lis:"⚜️",flight_arrival:"🛬",flight_departure:"🛫",floppy_disk:"💾",flower_playing_cards:"🎴",flushed:"😳",fog:"🌫",foggy:"🌁",football:"🏈",footprints:"👣",fork_and_knife:"🍴",fountain:"⛲️",fountain_pen:"🖋",four_leaf_clover:"🍀",fox_face:"🦊",framed_picture:"🖼",free:"🆓",fried_egg:"🍳",fried_shrimp:"🍤",fries:"🍟",frog:"🐸",frowning:"😦",frowning_face:"☹️",frowning_man:"🙍&zwj;♂️",frowning_woman:"🙍",middle_finger:"🖕",fuelpump:"⛽️",full_moon:"🌕",full_moon_with_face:"🌝",funeral_urn:"⚱️",game_die:"🎲",gear:"⚙️",gem:"💎",gemini:"♊️",ghost:"👻",gift:"🎁",gift_heart:"💝",girl:"👧",globe_with_meridians:"🌐",goal_net:"🥅",goat:"🐐",golf:"⛳️",golfing_man:"🏌️",golfing_woman:"🏌️&zwj;♀️",gorilla:"🦍",grapes:"🍇",green_apple:"🍏",green_book:"📗",green_heart:"💚",green_salad:"🥗",grey_exclamation:"❕",grey_question:"❔",grimacing:"😬",grin:"😁",grinning:"😀",guardsman:"💂",guardswoman:"💂&zwj;♀️",guitar:"🎸",gun:"🔫",haircut_woman:"💇",haircut_man:"💇&zwj;♂️",hamburger:"🍔",hammer:"🔨",hammer_and_pick:"⚒",hammer_and_wrench:"🛠",hamster:"🐹",hand:"✋",handbag:"👜",handshake:"🤝",hankey:"💩",hatched_chick:"🐥",hatching_chick:"🐣",headphones:"🎧",hear_no_evil:"🙉",heart:"❤️",heart_decoration:"💟",heart_eyes:"😍",heart_eyes_cat:"😻",heartbeat:"💓",heartpulse:"💗",hearts:"♥️",heavy_check_mark:"✔️",heavy_division_sign:"➗",heavy_dollar_sign:"💲",heavy_heart_exclamation:"❣️",heavy_minus_sign:"➖",heavy_multiplication_x:"✖️",heavy_plus_sign:"➕",helicopter:"🚁",herb:"🌿",hibiscus:"🌺",high_brightness:"🔆",high_heel:"👠",hocho:"🔪",hole:"🕳",honey_pot:"🍯",horse:"🐴",horse_racing:"🏇",hospital:"🏥",hot_pepper:"🌶",hotdog:"🌭",hotel:"🏨",hotsprings:"♨️",hourglass:"⌛️",hourglass_flowing_sand:"⏳",house:"🏠",house_with_garden:"🏡",houses:"🏘",hugs:"🤗",hushed:"😯",ice_cream:"🍨",ice_hockey:"🏒",ice_skate:"⛸",icecream:"🍦",id:"🆔",ideograph_advantage:"🉐",imp:"👿",inbox_tray:"📥",incoming_envelope:"📨",tipping_hand_woman:"💁",information_source:"ℹ️",innocent:"😇",interrobang:"⁉️",iphone:"📱",izakaya_lantern:"🏮",jack_o_lantern:"🎃",japan:"🗾",japanese_castle:"🏯",japanese_goblin:"👺",japanese_ogre:"👹",jeans:"👖",joy:"😂",joy_cat:"😹",joystick:"🕹",kaaba:"🕋",key:"🔑",keyboard:"⌨️",keycap_ten:"🔟",kick_scooter:"🛴",kimono:"👘",kiss:"💋",kissing:"😗",kissing_cat:"😽",kissing_closed_eyes:"😚",kissing_heart:"😘",kissing_smiling_eyes:"😙",kiwi_fruit:"🥝",koala:"🐨",koko:"🈁",label:"🏷",large_blue_circle:"🔵",large_blue_diamond:"🔷",large_orange_diamond:"🔶",last_quarter_moon:"🌗",last_quarter_moon_with_face:"🌜",latin_cross:"✝️",laughing:"😆",leaves:"🍃",ledger:"📒",left_luggage:"🛅",left_right_arrow:"↔️",leftwards_arrow_with_hook:"↩️",lemon:"🍋",leo:"♌️",leopard:"🐆",level_slider:"🎚",libra:"♎️",light_rail:"🚈",link:"🔗",lion:"🦁",lips:"👄",lipstick:"💄",lizard:"🦎",lock:"🔒",lock_with_ink_pen:"🔏",lollipop:"🍭",loop:"➿",loud_sound:"🔊",loudspeaker:"📢",love_hotel:"🏩",love_letter:"💌",low_brightness:"🔅",lying_face:"🤥",m:"Ⓜ️",mag:"🔍",mag_right:"🔎",mahjong:"🀄️",mailbox:"📫",mailbox_closed:"📪",mailbox_with_mail:"📬",mailbox_with_no_mail:"📭",man:"👨",man_artist:"👨&zwj;🎨",man_astronaut:"👨&zwj;🚀",man_cartwheeling:"🤸&zwj;♂️",man_cook:"👨&zwj;🍳",man_dancing:"🕺",man_facepalming:"🤦&zwj;♂️",man_factory_worker:"👨&zwj;🏭",man_farmer:"👨&zwj;🌾",man_firefighter:"👨&zwj;🚒",man_health_worker:"👨&zwj;⚕️",man_in_tuxedo:"🤵",man_judge:"👨&zwj;⚖️",man_juggling:"🤹&zwj;♂️",man_mechanic:"👨&zwj;🔧",man_office_worker:"👨&zwj;💼",man_pilot:"👨&zwj;✈️",man_playing_handball:"🤾&zwj;♂️",man_playing_water_polo:"🤽&zwj;♂️",man_scientist:"👨&zwj;🔬",man_shrugging:"🤷&zwj;♂️",man_singer:"👨&zwj;🎤",man_student:"👨&zwj;🎓",man_teacher:"👨&zwj;🏫",man_technologist:"👨&zwj;💻",man_with_gua_pi_mao:"👲",man_with_turban:"👳",tangerine:"🍊",mans_shoe:"👞",mantelpiece_clock:"🕰",maple_leaf:"🍁",martial_arts_uniform:"🥋",mask:"😷",massage_woman:"💆",massage_man:"💆&zwj;♂️",meat_on_bone:"🍖",medal_military:"🎖",medal_sports:"🏅",mega:"📣",melon:"🍈",memo:"📝",men_wrestling:"🤼&zwj;♂️",menorah:"🕎",mens:"🚹",metal:"🤘",metro:"🚇",microphone:"🎤",microscope:"🔬",milk_glass:"🥛",milky_way:"🌌",minibus:"🚐",minidisc:"💽",mobile_phone_off:"📴",money_mouth_face:"🤑",money_with_wings:"💸",moneybag:"💰",monkey:"🐒",monkey_face:"🐵",monorail:"🚝",moon:"🌔",mortar_board:"🎓",mosque:"🕌",motor_boat:"🛥",motor_scooter:"🛵",motorcycle:"🏍",motorway:"🛣",mount_fuji:"🗻",mountain:"⛰",mountain_biking_man:"🚵",mountain_biking_woman:"🚵&zwj;♀️",mountain_cableway:"🚠",mountain_railway:"🚞",mountain_snow:"🏔",mouse:"🐭",mouse2:"🐁",movie_camera:"🎥",moyai:"🗿",mrs_claus:"🤶",muscle:"💪",mushroom:"🍄",musical_keyboard:"🎹",musical_note:"🎵",musical_score:"🎼",mute:"🔇",nail_care:"💅",name_badge:"📛",national_park:"🏞",nauseated_face:"🤢",necktie:"👔",negative_squared_cross_mark:"❎",nerd_face:"🤓",neutral_face:"😐",new:"🆕",new_moon:"🌑",new_moon_with_face:"🌚",newspaper:"📰",newspaper_roll:"🗞",next_track_button:"⏭",ng:"🆖",no_good_man:"🙅&zwj;♂️",no_good_woman:"🙅",night_with_stars:"🌃",no_bell:"🔕",no_bicycles:"🚳",no_entry:"⛔️",no_entry_sign:"🚫",no_mobile_phones:"📵",no_mouth:"😶",no_pedestrians:"🚷",no_smoking:"🚭","non-potable_water":"🚱",nose:"👃",notebook:"📓",notebook_with_decorative_cover:"📔",notes:"🎶",nut_and_bolt:"🔩",o:"⭕️",o2:"🅾️",ocean:"🌊",octopus:"🐙",oden:"🍢",office:"🏢",oil_drum:"🛢",ok:"🆗",ok_hand:"👌",ok_man:"🙆&zwj;♂️",ok_woman:"🙆",old_key:"🗝",older_man:"👴",older_woman:"👵",om:"🕉",on:"🔛",oncoming_automobile:"🚘",oncoming_bus:"🚍",oncoming_police_car:"🚔",oncoming_taxi:"🚖",open_file_folder:"📂",open_hands:"👐",open_mouth:"😮",open_umbrella:"☂️",ophiuchus:"⛎",orange_book:"📙",orthodox_cross:"☦️",outbox_tray:"📤",owl:"🦉",ox:"🐂",package:"📦",page_facing_up:"📄",page_with_curl:"📃",pager:"📟",paintbrush:"🖌",palm_tree:"🌴",pancakes:"🥞",panda_face:"🐼",paperclip:"📎",paperclips:"🖇",parasol_on_ground:"⛱",parking:"🅿️",part_alternation_mark:"〽️",partly_sunny:"⛅️",passenger_ship:"🛳",passport_control:"🛂",pause_button:"⏸",peace_symbol:"☮️",peach:"🍑",peanuts:"🥜",pear:"🍐",pen:"🖊",pencil2:"✏️",penguin:"🐧",pensive:"😔",performing_arts:"🎭",persevere:"😣",person_fencing:"🤺",pouting_woman:"🙎",phone:"☎️",pick:"⛏",pig:"🐷",pig2:"🐖",pig_nose:"🐽",pill:"💊",pineapple:"🍍",ping_pong:"🏓",pisces:"♓️",pizza:"🍕",place_of_worship:"🛐",plate_with_cutlery:"🍽",play_or_pause_button:"⏯",point_down:"👇",point_left:"👈",point_right:"👉",point_up:"☝️",point_up_2:"👆",police_car:"🚓",policewoman:"👮&zwj;♀️",poodle:"🐩",popcorn:"🍿",post_office:"🏣",postal_horn:"📯",postbox:"📮",potable_water:"🚰",potato:"🥔",pouch:"👝",poultry_leg:"🍗",pound:"💷",rage:"😡",pouting_cat:"😾",pouting_man:"🙎&zwj;♂️",pray:"🙏",prayer_beads:"📿",pregnant_woman:"🤰",previous_track_button:"⏮",prince:"🤴",princess:"👸",printer:"🖨",purple_heart:"💜",purse:"👛",pushpin:"📌",put_litter_in_its_place:"🚮",question:"❓",rabbit:"🐰",rabbit2:"🐇",racehorse:"🐎",racing_car:"🏎",radio:"📻",radio_button:"🔘",radioactive:"☢️",railway_car:"🚃",railway_track:"🛤",rainbow:"🌈",rainbow_flag:"🏳️&zwj;🌈",raised_back_of_hand:"🤚",raised_hand_with_fingers_splayed:"🖐",raised_hands:"🙌",raising_hand_woman:"🙋",raising_hand_man:"🙋&zwj;♂️",ram:"🐏",ramen:"🍜",rat:"🐀",record_button:"⏺",recycle:"♻️",red_circle:"🔴",registered:"®️",relaxed:"☺️",relieved:"😌",reminder_ribbon:"🎗",repeat:"🔁",repeat_one:"🔂",rescue_worker_helmet:"⛑",restroom:"🚻",revolving_hearts:"💞",rewind:"⏪",rhinoceros:"🦏",ribbon:"🎀",rice:"🍚",rice_ball:"🍙",rice_cracker:"🍘",rice_scene:"🎑",right_anger_bubble:"🗯",ring:"💍",robot:"🤖",rocket:"🚀",rofl:"🤣",roll_eyes:"🙄",roller_coaster:"🎢",rooster:"🐓",rose:"🌹",rosette:"🏵",rotating_light:"🚨",round_pushpin:"📍",rowing_man:"🚣",rowing_woman:"🚣&zwj;♀️",rugby_football:"🏉",running_man:"🏃",running_shirt_with_sash:"🎽",running_woman:"🏃&zwj;♀️",sa:"🈂️",sagittarius:"♐️",sake:"🍶",sandal:"👡",santa:"🎅",satellite:"📡",saxophone:"🎷",school:"🏫",school_satchel:"🎒",scissors:"✂️",scorpion:"🦂",scorpius:"♏️",scream:"😱",scream_cat:"🙀",scroll:"📜",seat:"💺",secret:"㊙️",see_no_evil:"🙈",seedling:"🌱",selfie:"🤳",shallow_pan_of_food:"🥘",shamrock:"☘️",shark:"🦈",shaved_ice:"🍧",sheep:"🐑",shell:"🐚",shield:"🛡",shinto_shrine:"⛩",ship:"🚢",shirt:"👕",shopping:"🛍",shopping_cart:"🛒",shower:"🚿",shrimp:"🦐",signal_strength:"📶",six_pointed_star:"🔯",ski:"🎿",skier:"⛷",skull:"💀",skull_and_crossbones:"☠️",sleeping:"😴",sleeping_bed:"🛌",sleepy:"😪",slightly_frowning_face:"🙁",slightly_smiling_face:"🙂",slot_machine:"🎰",small_airplane:"🛩",small_blue_diamond:"🔹",small_orange_diamond:"🔸",small_red_triangle:"🔺",small_red_triangle_down:"🔻",smile:"😄",smile_cat:"😸",smiley:"😃",smiley_cat:"😺",smiling_imp:"😈",smirk:"😏",smirk_cat:"😼",smoking:"🚬",snail:"🐌",snake:"🐍",sneezing_face:"🤧",snowboarder:"🏂",snowflake:"❄️",snowman:"⛄️",snowman_with_snow:"☃️",sob:"😭",soccer:"⚽️",soon:"🔜",sos:"🆘",sound:"🔉",space_invader:"👾",spades:"♠️",spaghetti:"🍝",sparkle:"❇️",sparkler:"🎇",sparkles:"✨",sparkling_heart:"💖",speak_no_evil:"🙊",speaker:"🔈",speaking_head:"🗣",speech_balloon:"💬",speedboat:"🚤",spider:"🕷",spider_web:"🕸",spiral_calendar:"🗓",spiral_notepad:"🗒",spoon:"🥄",squid:"🦑",stadium:"🏟",star:"⭐️",star2:"🌟",star_and_crescent:"☪️",star_of_david:"✡️",stars:"🌠",station:"🚉",statue_of_liberty:"🗽",steam_locomotive:"🚂",stew:"🍲",stop_button:"⏹",stop_sign:"🛑",stopwatch:"⏱",straight_ruler:"📏",strawberry:"🍓",stuck_out_tongue:"😛",stuck_out_tongue_closed_eyes:"😝",stuck_out_tongue_winking_eye:"😜",studio_microphone:"🎙",stuffed_flatbread:"🥙",sun_behind_large_cloud:"🌥",sun_behind_rain_cloud:"🌦",sun_behind_small_cloud:"🌤",sun_with_face:"🌞",sunflower:"🌻",sunglasses:"😎",sunny:"☀️",sunrise:"🌅",sunrise_over_mountains:"🌄",surfing_man:"🏄",surfing_woman:"🏄&zwj;♀️",sushi:"🍣",suspension_railway:"🚟",sweat:"😓",sweat_drops:"💦",sweat_smile:"😅",sweet_potato:"🍠",swimming_man:"🏊",swimming_woman:"🏊&zwj;♀️",symbols:"🔣",synagogue:"🕍",syringe:"💉",taco:"🌮",tada:"🎉",tanabata_tree:"🎋",taurus:"♉️",taxi:"🚕",tea:"🍵",telephone_receiver:"📞",telescope:"🔭",tennis:"🎾",tent:"⛺️",thermometer:"🌡",thinking:"🤔",thought_balloon:"💭",ticket:"🎫",tickets:"🎟",tiger:"🐯",tiger2:"🐅",timer_clock:"⏲",tipping_hand_man:"💁&zwj;♂️",tired_face:"😫",tm:"™️",toilet:"🚽",tokyo_tower:"🗼",tomato:"🍅",tongue:"👅",top:"🔝",tophat:"🎩",tornado:"🌪",trackball:"🖲",tractor:"🚜",traffic_light:"🚥",train:"🚋",train2:"🚆",tram:"🚊",triangular_flag_on_post:"🚩",triangular_ruler:"📐",trident:"🔱",triumph:"😤",trolleybus:"🚎",trophy:"🏆",tropical_drink:"🍹",tropical_fish:"🐠",truck:"🚚",trumpet:"🎺",tulip:"🌷",tumbler_glass:"🥃",turkey:"🦃",turtle:"🐢",tv:"📺",twisted_rightwards_arrows:"🔀",two_hearts:"💕",two_men_holding_hands:"👬",two_women_holding_hands:"👭",u5272:"🈹",u5408:"🈴",u55b6:"🈺",u6307:"🈯️",u6708:"🈷️",u6709:"🈶",u6e80:"🈵",u7121:"🈚️",u7533:"🈸",u7981:"🈲",u7a7a:"🈳",umbrella:"☔️",unamused:"😒",underage:"🔞",unicorn:"🦄",unlock:"🔓",up:"🆙",upside_down_face:"🙃",v:"✌️",vertical_traffic_light:"🚦",vhs:"📼",vibration_mode:"📳",video_camera:"📹",video_game:"🎮",violin:"🎻",virgo:"♍️",volcano:"🌋",volleyball:"🏐",vs:"🆚",vulcan_salute:"🖖",walking_man:"🚶",walking_woman:"🚶&zwj;♀️",waning_crescent_moon:"🌘",waning_gibbous_moon:"🌖",warning:"⚠️",wastebasket:"🗑",watch:"⌚️",water_buffalo:"🐃",watermelon:"🍉",wave:"👋",wavy_dash:"〰️",waxing_crescent_moon:"🌒",wc:"🚾",weary:"😩",wedding:"💒",weight_lifting_man:"🏋️",weight_lifting_woman:"🏋️&zwj;♀️",whale:"🐳",whale2:"🐋",wheel_of_dharma:"☸️",wheelchair:"♿️",white_check_mark:"✅",white_circle:"⚪️",white_flag:"🏳️",white_flower:"💮",white_large_square:"⬜️",white_medium_small_square:"◽️",white_medium_square:"◻️",white_small_square:"▫️",white_square_button:"🔳",wilted_flower:"🥀",wind_chime:"🎐",wind_face:"🌬",wine_glass:"🍷",wink:"😉",wolf:"🐺",woman:"👩",woman_artist:"👩&zwj;🎨",woman_astronaut:"👩&zwj;🚀",woman_cartwheeling:"🤸&zwj;♀️",woman_cook:"👩&zwj;🍳",woman_facepalming:"🤦&zwj;♀️",woman_factory_worker:"👩&zwj;🏭",woman_farmer:"👩&zwj;🌾",woman_firefighter:"👩&zwj;🚒",woman_health_worker:"👩&zwj;⚕️",woman_judge:"👩&zwj;⚖️",woman_juggling:"🤹&zwj;♀️",woman_mechanic:"👩&zwj;🔧",woman_office_worker:"👩&zwj;💼",woman_pilot:"👩&zwj;✈️",woman_playing_handball:"🤾&zwj;♀️",woman_playing_water_polo:"🤽&zwj;♀️",woman_scientist:"👩&zwj;🔬",woman_shrugging:"🤷&zwj;♀️",woman_singer:"👩&zwj;🎤",woman_student:"👩&zwj;🎓",woman_teacher:"👩&zwj;🏫",woman_technologist:"👩&zwj;💻",woman_with_turban:"👳&zwj;♀️",womans_clothes:"👚",womans_hat:"👒",women_wrestling:"🤼&zwj;♀️",womens:"🚺",world_map:"🗺",worried:"😟",wrench:"🔧",writing_hand:"✍️",x:"❌",yellow_heart:"💛",yen:"💴",yin_yang:"☯️",yum:"😋",zap:"⚡️",zipper_mouth_face:"🤐",zzz:"💤",octocat:'<img alt=":octocat:" height="20" width="20" align="absmiddle" src="https://assets-cdn.github.com/images/icons/emoji/octocat.png">',showdown:`<span style="font-family: 'Anonymous Pro', monospace; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #3e8b8a;text-underline-position: under;">S</span>`},n.Converter=function(r){var s={},a=[],c=[],m={},g=p,h={parsed:{},raw:"",format:""};y();function y(){r=r||{};for(var f in u)u.hasOwnProperty(f)&&(s[f]=u[f]);if(typeof r=="object")for(var T in r)r.hasOwnProperty(T)&&(s[T]=r[T]);else throw Error("Converter expects the passed parameter to be an object, but "+typeof r+" was passed instead.");s.extensions&&n.helper.forEach(s.extensions,A)}function A(f,T){if(T=T||null,n.helper.isString(f))if(f=n.helper.stdExtName(f),T=f,n.extensions[f]){console.warn("DEPRECATION WARNING: "+f+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!"),b(n.extensions[f],f);return}else if(!n.helper.isUndefined(o[f]))f=o[f];else throw Error('Extension "'+f+'" could not be loaded. It was either not found or is not a valid extension.');typeof f=="function"&&(f=f()),n.helper.isArray(f)||(f=[f]);var R=v(f,T);if(!R.valid)throw Error(R.error);for(var M=0;M<f.length;++M){switch(f[M].type){case"lang":a.push(f[M]);break;case"output":c.push(f[M]);break}if(f[M].hasOwnProperty("listeners"))for(var $ in f[M].listeners)f[M].listeners.hasOwnProperty($)&&O($,f[M].listeners[$])}}function b(f,T){typeof f=="function"&&(f=f(new n.Converter)),n.helper.isArray(f)||(f=[f]);var R=v(f,T);if(!R.valid)throw Error(R.error);for(var M=0;M<f.length;++M)switch(f[M].type){case"lang":a.push(f[M]);break;case"output":c.push(f[M]);break;default:throw Error("Extension loader error: Type unrecognized!!!")}}function O(f,T){if(!n.helper.isString(f))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof f+" given");if(typeof T!="function")throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof T+" given");m.hasOwnProperty(f)||(m[f]=[]),m[f].push(T)}function S(f){var T=f.match(/^\s*/)[0].length,R=new RegExp("^\\s{0,"+T+"}","gm");return f.replace(R,"")}this._dispatch=function(T,R,M,$){if(m.hasOwnProperty(T))for(var D=0;D<m[T].length;++D){var X=m[T][D](T,R,this,M,$);X&&typeof X<"u"&&(R=X)}return R},this.listen=function(f,T){return O(f,T),this},this.makeHtml=function(f){if(!f)return f;var T={gHtmlBlocks:[],gHtmlMdBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:a,outputModifiers:c,converter:this,ghCodeBlocks:[],metadata:{parsed:{},raw:"",format:""}};return f=f.replace(/¨/g,"¨T"),f=f.replace(/\$/g,"¨D"),f=f.replace(/\r\n/g,`
`),f=f.replace(/\r/g,`
`),f=f.replace(/\u00A0/g,"&nbsp;"),s.smartIndentationFix&&(f=S(f)),f=`

`+f+`

`,f=n.subParser("detab")(f,s,T),f=f.replace(/^[ \t]+$/mg,""),n.helper.forEach(a,function(R){f=n.subParser("runExtension")(R,f,s,T)}),f=n.subParser("metadata")(f,s,T),f=n.subParser("hashPreCodeTags")(f,s,T),f=n.subParser("githubCodeBlocks")(f,s,T),f=n.subParser("hashHTMLBlocks")(f,s,T),f=n.subParser("hashCodeTags")(f,s,T),f=n.subParser("stripLinkDefinitions")(f,s,T),f=n.subParser("blockGamut")(f,s,T),f=n.subParser("unhashHTMLSpans")(f,s,T),f=n.subParser("unescapeSpecialChars")(f,s,T),f=f.replace(/¨D/g,"$$"),f=f.replace(/¨T/g,"¨"),f=n.subParser("completeHTMLDocument")(f,s,T),n.helper.forEach(c,function(R){f=n.subParser("runExtension")(R,f,s,T)}),h=T.metadata,f},this.makeMarkdown=this.makeMd=function(f,T){if(f=f.replace(/\r\n/g,`
`),f=f.replace(/\r/g,`
`),f=f.replace(/>[ \t]+</,">¨NBSP;<"),!T)if(window&&window.document)T=window.document;else throw new Error("HTMLParser is undefined. If in a webworker or nodejs environment, you need to provide a WHATWG DOM and HTML such as JSDOM");var R=T.createElement("div");R.innerHTML=f;var M={preList:J(R)};Q(R);for(var $=R.childNodes,D="",X=0;X<$.length;X++)D+=n.subParser("makeMarkdown.node")($[X],M);function Q(x){for(var q=0;q<x.childNodes.length;++q){var ee=x.childNodes[q];ee.nodeType===3?!/\S/.test(ee.nodeValue)&&!/^[ ]+$/.test(ee.nodeValue)?(x.removeChild(ee),--q):(ee.nodeValue=ee.nodeValue.split(`
`).join(" "),ee.nodeValue=ee.nodeValue.replace(/(\s)+/g,"$1")):ee.nodeType===1&&Q(ee)}}function J(x){for(var q=x.querySelectorAll("pre"),ee=[],Z=0;Z<q.length;++Z)if(q[Z].childElementCount===1&&q[Z].firstChild.tagName.toLowerCase()==="code"){var Oe=q[Z].firstChild.innerHTML.trim(),pe=q[Z].firstChild.getAttribute("data-language")||"";if(pe==="")for(var Ce=q[Z].firstChild.className.split(" "),Ie=0;Ie<Ce.length;++Ie){var ke=Ce[Ie].match(/^language-(.+)$/);if(ke!==null){pe=ke[1];break}}Oe=n.helper.unescapeHTMLEntities(Oe),ee.push(Oe),q[Z].outerHTML='<precode language="'+pe+'" precodenum="'+Z.toString()+'"></precode>'}else ee.push(q[Z].innerHTML),q[Z].innerHTML="",q[Z].setAttribute("prenum",Z.toString());return ee}return D},this.setOption=function(f,T){s[f]=T},this.getOption=function(f){return s[f]},this.getOptions=function(){return s},this.addExtension=function(f,T){T=T||null,A(f,T)},this.useExtension=function(f){A(f)},this.setFlavor=function(f){if(!_.hasOwnProperty(f))throw Error(f+" flavor was not found");var T=_[f];g=f;for(var R in T)T.hasOwnProperty(R)&&(s[R]=T[R])},this.getFlavor=function(){return g},this.removeExtension=function(f){n.helper.isArray(f)||(f=[f]);for(var T=0;T<f.length;++T){for(var R=f[T],M=0;M<a.length;++M)a[M]===R&&a.splice(M,1);for(var $=0;$<c.length;++$)c[$]===R&&c.splice($,1)}},this.getAllExtensions=function(){return{language:a,output:c}},this.getMetadata=function(f){return f?h.raw:h.parsed},this.getMetadataFormat=function(){return h.format},this._setMetadataPair=function(f,T){h.parsed[f]=T},this._setMetadataFormat=function(f){h.format=f},this._setMetadataRaw=function(f){h.raw=f}},n.subParser("anchors",function(r,s,a){r=a.converter._dispatch("anchors.before",r,s,a);var c=function(m,g,h,y,A,b,O){if(n.helper.isUndefined(O)&&(O=""),h=h.toLowerCase(),m.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)y="";else if(!y)if(h||(h=g.toLowerCase().replace(/ ?\n/g," ")),y="#"+h,!n.helper.isUndefined(a.gUrls[h]))y=a.gUrls[h],n.helper.isUndefined(a.gTitles[h])||(O=a.gTitles[h]);else return m;y=y.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback);var S='<a href="'+y+'"';return O!==""&&O!==null&&(O=O.replace(/"/g,"&quot;"),O=O.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback),S+=' title="'+O+'"'),s.openLinksInNewWindow&&!/^#/.test(y)&&(S+=' rel="noopener noreferrer" target="¨E95Eblank"'),S+=">"+g+"</a>",S};return r=r.replace(/\[((?:\[[^\]]*]|[^\[\]])*)] ?(?:\n *)?\[(.*?)]()()()()/g,c),r=r.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<([^>]*)>(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,c),r=r.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,c),r=r.replace(/\[([^\[\]]+)]()()()()()/g,c),s.ghMentions&&(r=r.replace(/(^|\s)(\\)?(@([a-z\d]+(?:[a-z\d.-]+?[a-z\d]+)*))/gmi,function(m,g,h,y,A){if(h==="\\")return g+y;if(!n.helper.isString(s.ghMentionsLink))throw new Error("ghMentionsLink option must be a string");var b=s.ghMentionsLink.replace(/\{u}/g,A),O="";return s.openLinksInNewWindow&&(O=' rel="noopener noreferrer" target="¨E95Eblank"'),g+'<a href="'+b+'"'+O+">"+y+"</a>"})),r=a.converter._dispatch("anchors.after",r,s,a),r});var C=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+?\.[^'">\s]+?)()(\1)?(?=\s|$)(?!["<>])/gi,B=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+?)([.!?,()\[\]])?(\1)?(?=\s|$)(?!["<>])/gi,N=/()<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)()>()/gi,I=/(^|\s)(?:mailto:)?([A-Za-z0-9!#$%&'*+-/=?^_`{|}~.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?=$|\s)/gmi,P=/<()(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,k=function(r){return function(s,a,c,m,g,h,y){c=c.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback);var A=c,b="",O="",S=a||"",f=y||"";return/^www\./i.test(c)&&(c=c.replace(/^www\./i,"http://www.")),r.excludeTrailingPunctuationFromURLs&&h&&(b=h),r.openLinksInNewWindow&&(O=' rel="noopener noreferrer" target="¨E95Eblank"'),S+'<a href="'+c+'"'+O+">"+A+"</a>"+b+f}},z=function(r,s){return function(a,c,m){var g="mailto:";return c=c||"",m=n.subParser("unescapeSpecialChars")(m,r,s),r.encodeEmails?(g=n.helper.encodeEmailAddress(g+m),m=n.helper.encodeEmailAddress(m)):g=g+m,c+'<a href="'+g+'">'+m+"</a>"}};n.subParser("autoLinks",function(r,s,a){return r=a.converter._dispatch("autoLinks.before",r,s,a),r=r.replace(N,k(s)),r=r.replace(P,z(s,a)),r=a.converter._dispatch("autoLinks.after",r,s,a),r}),n.subParser("simplifiedAutoLinks",function(r,s,a){return s.simplifiedAutoLink&&(r=a.converter._dispatch("simplifiedAutoLinks.before",r,s,a),s.excludeTrailingPunctuationFromURLs?r=r.replace(B,k(s)):r=r.replace(C,k(s)),r=r.replace(I,z(s,a)),r=a.converter._dispatch("simplifiedAutoLinks.after",r,s,a)),r}),n.subParser("blockGamut",function(r,s,a){return r=a.converter._dispatch("blockGamut.before",r,s,a),r=n.subParser("blockQuotes")(r,s,a),r=n.subParser("headers")(r,s,a),r=n.subParser("horizontalRule")(r,s,a),r=n.subParser("lists")(r,s,a),r=n.subParser("codeBlocks")(r,s,a),r=n.subParser("tables")(r,s,a),r=n.subParser("hashHTMLBlocks")(r,s,a),r=n.subParser("paragraphs")(r,s,a),r=a.converter._dispatch("blockGamut.after",r,s,a),r}),n.subParser("blockQuotes",function(r,s,a){r=a.converter._dispatch("blockQuotes.before",r,s,a),r=r+`

`;var c=/(^ {0,3}>[ \t]?.+\n(.+\n)*\n*)+/gm;return s.splitAdjacentBlockquotes&&(c=/^ {0,3}>[\s\S]*?(?:\n\n)/gm),r=r.replace(c,function(m){return m=m.replace(/^[ \t]*>[ \t]?/gm,""),m=m.replace(/¨0/g,""),m=m.replace(/^[ \t]+$/gm,""),m=n.subParser("githubCodeBlocks")(m,s,a),m=n.subParser("blockGamut")(m,s,a),m=m.replace(/(^|\n)/g,"$1  "),m=m.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(g,h){var y=h;return y=y.replace(/^  /mg,"¨0"),y=y.replace(/¨0/g,""),y}),n.subParser("hashBlock")(`<blockquote>
`+m+`
</blockquote>`,s,a)}),r=a.converter._dispatch("blockQuotes.after",r,s,a),r}),n.subParser("codeBlocks",function(r,s,a){r=a.converter._dispatch("codeBlocks.before",r,s,a),r+="¨0";var c=/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=¨0))/g;return r=r.replace(c,function(m,g,h){var y=g,A=h,b=`
`;return y=n.subParser("outdent")(y,s,a),y=n.subParser("encodeCode")(y,s,a),y=n.subParser("detab")(y,s,a),y=y.replace(/^\n+/g,""),y=y.replace(/\n+$/g,""),s.omitExtraWLInCodeBlocks&&(b=""),y="<pre><code>"+y+b+"</code></pre>",n.subParser("hashBlock")(y,s,a)+A}),r=r.replace(/¨0/,""),r=a.converter._dispatch("codeBlocks.after",r,s,a),r}),n.subParser("codeSpans",function(r,s,a){return r=a.converter._dispatch("codeSpans.before",r,s,a),typeof r>"u"&&(r=""),r=r.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(c,m,g,h){var y=h;return y=y.replace(/^([ \t]*)/g,""),y=y.replace(/[ \t]*$/g,""),y=n.subParser("encodeCode")(y,s,a),y=m+"<code>"+y+"</code>",y=n.subParser("hashHTMLSpans")(y,s,a),y}),r=a.converter._dispatch("codeSpans.after",r,s,a),r}),n.subParser("completeHTMLDocument",function(r,s,a){if(!s.completeHTMLDocument)return r;r=a.converter._dispatch("completeHTMLDocument.before",r,s,a);var c="html",m=`<!DOCTYPE HTML>
`,g="",h=`<meta charset="utf-8">
`,y="",A="";typeof a.metadata.parsed.doctype<"u"&&(m="<!DOCTYPE "+a.metadata.parsed.doctype+`>
`,c=a.metadata.parsed.doctype.toString().toLowerCase(),(c==="html"||c==="html5")&&(h='<meta charset="utf-8">'));for(var b in a.metadata.parsed)if(a.metadata.parsed.hasOwnProperty(b))switch(b.toLowerCase()){case"doctype":break;case"title":g="<title>"+a.metadata.parsed.title+`</title>
`;break;case"charset":c==="html"||c==="html5"?h='<meta charset="'+a.metadata.parsed.charset+`">
`:h='<meta name="charset" content="'+a.metadata.parsed.charset+`">
`;break;case"language":case"lang":y=' lang="'+a.metadata.parsed[b]+'"',A+='<meta name="'+b+'" content="'+a.metadata.parsed[b]+`">
`;break;default:A+='<meta name="'+b+'" content="'+a.metadata.parsed[b]+`">
`}return r=m+"<html"+y+`>
<head>
`+g+h+A+`</head>
<body>
`+r.trim()+`
</body>
</html>`,r=a.converter._dispatch("completeHTMLDocument.after",r,s,a),r}),n.subParser("detab",function(r,s,a){return r=a.converter._dispatch("detab.before",r,s,a),r=r.replace(/\t(?=\t)/g,"    "),r=r.replace(/\t/g,"¨A¨B"),r=r.replace(/¨B(.+?)¨A/g,function(c,m){for(var g=m,h=4-g.length%4,y=0;y<h;y++)g+=" ";return g}),r=r.replace(/¨A/g,"    "),r=r.replace(/¨B/g,""),r=a.converter._dispatch("detab.after",r,s,a),r}),n.subParser("ellipsis",function(r,s,a){return s.ellipsis&&(r=a.converter._dispatch("ellipsis.before",r,s,a),r=r.replace(/\.\.\./g,"…"),r=a.converter._dispatch("ellipsis.after",r,s,a)),r}),n.subParser("emoji",function(r,s,a){if(!s.emoji)return r;r=a.converter._dispatch("emoji.before",r,s,a);var c=/:([\S]+?):/g;return r=r.replace(c,function(m,g){return n.helper.emojis.hasOwnProperty(g)?n.helper.emojis[g]:m}),r=a.converter._dispatch("emoji.after",r,s,a),r}),n.subParser("encodeAmpsAndAngles",function(r,s,a){return r=a.converter._dispatch("encodeAmpsAndAngles.before",r,s,a),r=r.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),r=r.replace(/<(?![a-z\/?$!])/gi,"&lt;"),r=r.replace(/</g,"&lt;"),r=r.replace(/>/g,"&gt;"),r=a.converter._dispatch("encodeAmpsAndAngles.after",r,s,a),r}),n.subParser("encodeBackslashEscapes",function(r,s,a){return r=a.converter._dispatch("encodeBackslashEscapes.before",r,s,a),r=r.replace(/\\(\\)/g,n.helper.escapeCharactersCallback),r=r.replace(/\\([`*_{}\[\]()>#+.!~=|:-])/g,n.helper.escapeCharactersCallback),r=a.converter._dispatch("encodeBackslashEscapes.after",r,s,a),r}),n.subParser("encodeCode",function(r,s,a){return r=a.converter._dispatch("encodeCode.before",r,s,a),r=r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/([*_{}\[\]\\=~-])/g,n.helper.escapeCharactersCallback),r=a.converter._dispatch("encodeCode.after",r,s,a),r}),n.subParser("escapeSpecialCharsWithinTagAttributes",function(r,s,a){r=a.converter._dispatch("escapeSpecialCharsWithinTagAttributes.before",r,s,a);var c=/<\/?[a-z\d_:-]+(?:[\s]+[\s\S]+?)?>/gi,m=/<!(--(?:(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>/gi;return r=r.replace(c,function(g){return g.replace(/(.)<\/?code>(?=.)/g,"$1`").replace(/([\\`*_~=|])/g,n.helper.escapeCharactersCallback)}),r=r.replace(m,function(g){return g.replace(/([\\`*_~=|])/g,n.helper.escapeCharactersCallback)}),r=a.converter._dispatch("escapeSpecialCharsWithinTagAttributes.after",r,s,a),r}),n.subParser("githubCodeBlocks",function(r,s,a){return s.ghCodeBlocks?(r=a.converter._dispatch("githubCodeBlocks.before",r,s,a),r+="¨0",r=r.replace(/(?:^|\n)(?: {0,3})(```+|~~~+)(?: *)([^\s`~]*)\n([\s\S]*?)\n(?: {0,3})\1/g,function(c,m,g,h){var y=s.omitExtraWLInCodeBlocks?"":`
`;return h=n.subParser("encodeCode")(h,s,a),h=n.subParser("detab")(h,s,a),h=h.replace(/^\n+/g,""),h=h.replace(/\n+$/g,""),h="<pre><code"+(g?' class="'+g+" language-"+g+'"':"")+">"+h+y+"</code></pre>",h=n.subParser("hashBlock")(h,s,a),`

¨G`+(a.ghCodeBlocks.push({text:c,codeblock:h})-1)+`G

`}),r=r.replace(/¨0/,""),a.converter._dispatch("githubCodeBlocks.after",r,s,a)):r}),n.subParser("hashBlock",function(r,s,a){return r=a.converter._dispatch("hashBlock.before",r,s,a),r=r.replace(/(^\n+|\n+$)/g,""),r=`

¨K`+(a.gHtmlBlocks.push(r)-1)+`K

`,r=a.converter._dispatch("hashBlock.after",r,s,a),r}),n.subParser("hashCodeTags",function(r,s,a){r=a.converter._dispatch("hashCodeTags.before",r,s,a);var c=function(m,g,h,y){var A=h+n.subParser("encodeCode")(g,s,a)+y;return"¨C"+(a.gHtmlSpans.push(A)-1)+"C"};return r=n.helper.replaceRecursiveRegExp(r,c,"<code\\b[^>]*>","</code>","gim"),r=a.converter._dispatch("hashCodeTags.after",r,s,a),r}),n.subParser("hashElement",function(r,s,a){return function(c,m){var g=m;return g=g.replace(/\n\n/g,`
`),g=g.replace(/^\n/,""),g=g.replace(/\n+$/g,""),g=`

¨K`+(a.gHtmlBlocks.push(g)-1)+`K

`,g}}),n.subParser("hashHTMLBlocks",function(r,s,a){r=a.converter._dispatch("hashHTMLBlocks.before",r,s,a);var c=["pre","div","h1","h2","h3","h4","h5","h6","blockquote","table","dl","ol","ul","script","noscript","form","fieldset","iframe","math","style","section","header","footer","nav","article","aside","address","audio","canvas","figure","hgroup","output","video","p"],m=function(f,T,R,M){var $=f;return R.search(/\bmarkdown\b/)!==-1&&($=R+a.converter.makeHtml(T)+M),`

¨K`+(a.gHtmlBlocks.push($)-1)+`K

`};s.backslashEscapesHTMLTags&&(r=r.replace(/\\<(\/?[^>]+?)>/g,function(f,T){return"&lt;"+T+"&gt;"}));for(var g=0;g<c.length;++g)for(var h,y=new RegExp("^ {0,3}(<"+c[g]+"\\b[^>]*>)","im"),A="<"+c[g]+"\\b[^>]*>",b="</"+c[g]+">";(h=n.helper.regexIndexOf(r,y))!==-1;){var O=n.helper.splitAtIndex(r,h),S=n.helper.replaceRecursiveRegExp(O[1],m,A,b,"im");if(S===O[1])break;r=O[0].concat(S)}return r=r.replace(/(\n {0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,n.subParser("hashElement")(r,s,a)),r=n.helper.replaceRecursiveRegExp(r,function(f){return`

¨K`+(a.gHtmlBlocks.push(f)-1)+`K

`},"^ {0,3}<!--","-->","gm"),r=r.replace(/(?:\n\n)( {0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,n.subParser("hashElement")(r,s,a)),r=a.converter._dispatch("hashHTMLBlocks.after",r,s,a),r}),n.subParser("hashHTMLSpans",function(r,s,a){r=a.converter._dispatch("hashHTMLSpans.before",r,s,a);function c(m){return"¨C"+(a.gHtmlSpans.push(m)-1)+"C"}return r=r.replace(/<[^>]+?\/>/gi,function(m){return c(m)}),r=r.replace(/<([^>]+?)>[\s\S]*?<\/\1>/g,function(m){return c(m)}),r=r.replace(/<([^>]+?)\s[^>]+?>[\s\S]*?<\/\1>/g,function(m){return c(m)}),r=r.replace(/<[^>]+?>/gi,function(m){return c(m)}),r=a.converter._dispatch("hashHTMLSpans.after",r,s,a),r}),n.subParser("unhashHTMLSpans",function(r,s,a){r=a.converter._dispatch("unhashHTMLSpans.before",r,s,a);for(var c=0;c<a.gHtmlSpans.length;++c){for(var m=a.gHtmlSpans[c],g=0;/¨C(\d+)C/.test(m);){var h=RegExp.$1;if(m=m.replace("¨C"+h+"C",a.gHtmlSpans[h]),g===10){console.error("maximum nesting of 10 spans reached!!!");break}++g}r=r.replace("¨C"+c+"C",m)}return r=a.converter._dispatch("unhashHTMLSpans.after",r,s,a),r}),n.subParser("hashPreCodeTags",function(r,s,a){r=a.converter._dispatch("hashPreCodeTags.before",r,s,a);var c=function(m,g,h,y){var A=h+n.subParser("encodeCode")(g,s,a)+y;return`

¨G`+(a.ghCodeBlocks.push({text:m,codeblock:A})-1)+`G

`};return r=n.helper.replaceRecursiveRegExp(r,c,"^ {0,3}<pre\\b[^>]*>\\s*<code\\b[^>]*>","^ {0,3}</code>\\s*</pre>","gim"),r=a.converter._dispatch("hashPreCodeTags.after",r,s,a),r}),n.subParser("headers",function(r,s,a){r=a.converter._dispatch("headers.before",r,s,a);var c=isNaN(parseInt(s.headerLevelStart))?1:parseInt(s.headerLevelStart),m=s.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,g=s.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;r=r.replace(m,function(A,b){var O=n.subParser("spanGamut")(b,s,a),S=s.noHeaderId?"":' id="'+y(b)+'"',f=c,T="<h"+f+S+">"+O+"</h"+f+">";return n.subParser("hashBlock")(T,s,a)}),r=r.replace(g,function(A,b){var O=n.subParser("spanGamut")(b,s,a),S=s.noHeaderId?"":' id="'+y(b)+'"',f=c+1,T="<h"+f+S+">"+O+"</h"+f+">";return n.subParser("hashBlock")(T,s,a)});var h=s.requireSpaceBeforeHeadingText?/^(#{1,6})[ \t]+(.+?)[ \t]*#*\n+/gm:/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm;r=r.replace(h,function(A,b,O){var S=O;s.customizedHeaderId&&(S=O.replace(/\s?\{([^{]+?)}\s*$/,""));var f=n.subParser("spanGamut")(S,s,a),T=s.noHeaderId?"":' id="'+y(O)+'"',R=c-1+b.length,M="<h"+R+T+">"+f+"</h"+R+">";return n.subParser("hashBlock")(M,s,a)});function y(A){var b,O;if(s.customizedHeaderId){var S=A.match(/\{([^{]+?)}\s*$/);S&&S[1]&&(A=S[1])}return b=A,n.helper.isString(s.prefixHeaderId)?O=s.prefixHeaderId:s.prefixHeaderId===!0?O="section-":O="",s.rawPrefixHeaderId||(b=O+b),s.ghCompatibleHeaderId?b=b.replace(/ /g,"-").replace(/&amp;/g,"").replace(/¨T/g,"").replace(/¨D/g,"").replace(/[&+$,\/:;=?@"#{}|^¨~\[\]`\\*)(%.!'<>]/g,"").toLowerCase():s.rawHeaderId?b=b.replace(/ /g,"-").replace(/&amp;/g,"&").replace(/¨T/g,"¨").replace(/¨D/g,"$").replace(/["']/g,"-").toLowerCase():b=b.replace(/[^\w]/g,"").toLowerCase(),s.rawPrefixHeaderId&&(b=O+b),a.hashLinkCounts[b]?b=b+"-"+a.hashLinkCounts[b]++:a.hashLinkCounts[b]=1,b}return r=a.converter._dispatch("headers.after",r,s,a),r}),n.subParser("horizontalRule",function(r,s,a){r=a.converter._dispatch("horizontalRule.before",r,s,a);var c=n.subParser("hashBlock")("<hr />",s,a);return r=r.replace(/^ {0,2}( ?-){3,}[ \t]*$/gm,c),r=r.replace(/^ {0,2}( ?\*){3,}[ \t]*$/gm,c),r=r.replace(/^ {0,2}( ?_){3,}[ \t]*$/gm,c),r=a.converter._dispatch("horizontalRule.after",r,s,a),r}),n.subParser("images",function(r,s,a){r=a.converter._dispatch("images.before",r,s,a);var c=/!\[([^\]]*?)][ \t]*()\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,m=/!\[([^\]]*?)][ \t]*()\([ \t]?<([^>]*)>(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(?:(["'])([^"]*?)\6))?[ \t]?\)/g,g=/!\[([^\]]*?)][ \t]*()\([ \t]?<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,h=/!\[([^\]]*?)] ?(?:\n *)?\[([\s\S]*?)]()()()()()/g,y=/!\[([^\[\]]+)]()()()()()/g;function A(O,S,f,T,R,M,$,D){return T=T.replace(/\s/g,""),b(O,S,f,T,R,M,$,D)}function b(O,S,f,T,R,M,$,D){var X=a.gUrls,Q=a.gTitles,J=a.gDimensions;if(f=f.toLowerCase(),D||(D=""),O.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)T="";else if(T===""||T===null)if((f===""||f===null)&&(f=S.toLowerCase().replace(/ ?\n/g," ")),T="#"+f,!n.helper.isUndefined(X[f]))T=X[f],n.helper.isUndefined(Q[f])||(D=Q[f]),n.helper.isUndefined(J[f])||(R=J[f].width,M=J[f].height);else return O;S=S.replace(/"/g,"&quot;").replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback),T=T.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback);var x='<img src="'+T+'" alt="'+S+'"';return D&&n.helper.isString(D)&&(D=D.replace(/"/g,"&quot;").replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback),x+=' title="'+D+'"'),R&&M&&(R=R==="*"?"auto":R,M=M==="*"?"auto":M,x+=' width="'+R+'"',x+=' height="'+M+'"'),x+=" />",x}return r=r.replace(h,b),r=r.replace(g,A),r=r.replace(m,b),r=r.replace(c,b),r=r.replace(y,b),r=a.converter._dispatch("images.after",r,s,a),r}),n.subParser("italicsAndBold",function(r,s,a){r=a.converter._dispatch("italicsAndBold.before",r,s,a);function c(m,g,h){return g+m+h}return s.literalMidWordUnderscores?(r=r.replace(/\b___(\S[\s\S]*?)___\b/g,function(m,g){return c(g,"<strong><em>","</em></strong>")}),r=r.replace(/\b__(\S[\s\S]*?)__\b/g,function(m,g){return c(g,"<strong>","</strong>")}),r=r.replace(/\b_(\S[\s\S]*?)_\b/g,function(m,g){return c(g,"<em>","</em>")})):(r=r.replace(/___(\S[\s\S]*?)___/g,function(m,g){return/\S$/.test(g)?c(g,"<strong><em>","</em></strong>"):m}),r=r.replace(/__(\S[\s\S]*?)__/g,function(m,g){return/\S$/.test(g)?c(g,"<strong>","</strong>"):m}),r=r.replace(/_([^\s_][\s\S]*?)_/g,function(m,g){return/\S$/.test(g)?c(g,"<em>","</em>"):m})),s.literalMidWordAsterisks?(r=r.replace(/([^*]|^)\B\*\*\*(\S[\s\S]*?)\*\*\*\B(?!\*)/g,function(m,g,h){return c(h,g+"<strong><em>","</em></strong>")}),r=r.replace(/([^*]|^)\B\*\*(\S[\s\S]*?)\*\*\B(?!\*)/g,function(m,g,h){return c(h,g+"<strong>","</strong>")}),r=r.replace(/([^*]|^)\B\*(\S[\s\S]*?)\*\B(?!\*)/g,function(m,g,h){return c(h,g+"<em>","</em>")})):(r=r.replace(/\*\*\*(\S[\s\S]*?)\*\*\*/g,function(m,g){return/\S$/.test(g)?c(g,"<strong><em>","</em></strong>"):m}),r=r.replace(/\*\*(\S[\s\S]*?)\*\*/g,function(m,g){return/\S$/.test(g)?c(g,"<strong>","</strong>"):m}),r=r.replace(/\*([^\s*][\s\S]*?)\*/g,function(m,g){return/\S$/.test(g)?c(g,"<em>","</em>"):m})),r=a.converter._dispatch("italicsAndBold.after",r,s,a),r}),n.subParser("lists",function(r,s,a){function c(h,y){a.gListLevel++,h=h.replace(/\n{2,}$/,`
`),h+="¨0";var A=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0| {0,3}([*+-]|\d+[.])[ \t]+))/gm,b=/\n[ \t]*\n(?!¨0)/.test(h);return s.disableForced4SpacesIndentedSublists&&(A=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0|\2([*+-]|\d+[.])[ \t]+))/gm),h=h.replace(A,function(O,S,f,T,R,M,$){$=$&&$.trim()!=="";var D=n.subParser("outdent")(R,s,a),X="";return M&&s.tasklists&&(X=' class="task-list-item" style="list-style-type: none;"',D=D.replace(/^[ \t]*\[(x|X| )?]/m,function(){var Q='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return $&&(Q+=" checked"),Q+=">",Q})),D=D.replace(/^([-*+]|\d\.)[ \t]+[\S\n ]*/g,function(Q){return"¨A"+Q}),S||D.search(/\n{2,}/)>-1?(D=n.subParser("githubCodeBlocks")(D,s,a),D=n.subParser("blockGamut")(D,s,a)):(D=n.subParser("lists")(D,s,a),D=D.replace(/\n$/,""),D=n.subParser("hashHTMLBlocks")(D,s,a),D=D.replace(/\n\n+/g,`

`),b?D=n.subParser("paragraphs")(D,s,a):D=n.subParser("spanGamut")(D,s,a)),D=D.replace("¨A",""),D="<li"+X+">"+D+`</li>
`,D}),h=h.replace(/¨0/g,""),a.gListLevel--,y&&(h=h.replace(/\s+$/,"")),h}function m(h,y){if(y==="ol"){var A=h.match(/^ *(\d+)\./);if(A&&A[1]!=="1")return' start="'+A[1]+'"'}return""}function g(h,y,A){var b=s.disableForced4SpacesIndentedSublists?/^ ?\d+\.[ \t]/gm:/^ {0,3}\d+\.[ \t]/gm,O=s.disableForced4SpacesIndentedSublists?/^ ?[*+-][ \t]/gm:/^ {0,3}[*+-][ \t]/gm,S=y==="ul"?b:O,f="";if(h.search(S)!==-1)(function R(M){var $=M.search(S),D=m(h,y);$!==-1?(f+=`

<`+y+D+`>
`+c(M.slice(0,$),!!A)+"</"+y+`>
`,y=y==="ul"?"ol":"ul",S=y==="ul"?b:O,R(M.slice($))):f+=`

<`+y+D+`>
`+c(M,!!A)+"</"+y+`>
`})(h);else{var T=m(h,y);f=`

<`+y+T+`>
`+c(h,!!A)+"</"+y+`>
`}return f}return r=a.converter._dispatch("lists.before",r,s,a),r+="¨0",a.gListLevel?r=r.replace(/^(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(h,y,A){var b=A.search(/[*+-]/g)>-1?"ul":"ol";return g(y,b,!0)}):r=r.replace(/(\n\n|^\n?)(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(h,y,A,b){var O=b.search(/[*+-]/g)>-1?"ul":"ol";return g(A,O,!1)}),r=r.replace(/¨0/,""),r=a.converter._dispatch("lists.after",r,s,a),r}),n.subParser("metadata",function(r,s,a){if(!s.metadata)return r;r=a.converter._dispatch("metadata.before",r,s,a);function c(m){a.metadata.raw=m,m=m.replace(/&/g,"&amp;").replace(/"/g,"&quot;"),m=m.replace(/\n {4}/g," "),m.replace(/^([\S ]+): +([\s\S]+?)$/gm,function(g,h,y){return a.metadata.parsed[h]=y,""})}return r=r.replace(/^\s*«««+(\S*?)\n([\s\S]+?)\n»»»+\n/,function(m,g,h){return c(h),"¨M"}),r=r.replace(/^\s*---+(\S*?)\n([\s\S]+?)\n---+\n/,function(m,g,h){return g&&(a.metadata.format=g),c(h),"¨M"}),r=r.replace(/¨M/g,""),r=a.converter._dispatch("metadata.after",r,s,a),r}),n.subParser("outdent",function(r,s,a){return r=a.converter._dispatch("outdent.before",r,s,a),r=r.replace(/^(\t|[ ]{1,4})/gm,"¨0"),r=r.replace(/¨0/g,""),r=a.converter._dispatch("outdent.after",r,s,a),r}),n.subParser("paragraphs",function(r,s,a){r=a.converter._dispatch("paragraphs.before",r,s,a),r=r.replace(/^\n+/g,""),r=r.replace(/\n+$/g,"");for(var c=r.split(/\n{2,}/g),m=[],g=c.length,h=0;h<g;h++){var y=c[h];y.search(/¨(K|G)(\d+)\1/g)>=0?m.push(y):y.search(/\S/)>=0&&(y=n.subParser("spanGamut")(y,s,a),y=y.replace(/^([ \t]*)/g,"<p>"),y+="</p>",m.push(y))}for(g=m.length,h=0;h<g;h++){for(var A="",b=m[h],O=!1;/¨(K|G)(\d+)\1/.test(b);){var S=RegExp.$1,f=RegExp.$2;S==="K"?A=a.gHtmlBlocks[f]:O?A=n.subParser("encodeCode")(a.ghCodeBlocks[f].text,s,a):A=a.ghCodeBlocks[f].codeblock,A=A.replace(/\$/g,"$$$$"),b=b.replace(/(\n\n)?¨(K|G)\d+\2(\n\n)?/,A),/^<pre\b[^>]*>\s*<code\b[^>]*>/.test(b)&&(O=!0)}m[h]=b}return r=m.join(`
`),r=r.replace(/^\n+/g,""),r=r.replace(/\n+$/g,""),a.converter._dispatch("paragraphs.after",r,s,a)}),n.subParser("runExtension",function(r,s,a,c){if(r.filter)s=r.filter(s,c.converter,a);else if(r.regex){var m=r.regex;m instanceof RegExp||(m=new RegExp(m,"g")),s=s.replace(m,r.replace)}return s}),n.subParser("spanGamut",function(r,s,a){return r=a.converter._dispatch("spanGamut.before",r,s,a),r=n.subParser("codeSpans")(r,s,a),r=n.subParser("escapeSpecialCharsWithinTagAttributes")(r,s,a),r=n.subParser("encodeBackslashEscapes")(r,s,a),r=n.subParser("images")(r,s,a),r=n.subParser("anchors")(r,s,a),r=n.subParser("autoLinks")(r,s,a),r=n.subParser("simplifiedAutoLinks")(r,s,a),r=n.subParser("emoji")(r,s,a),r=n.subParser("underline")(r,s,a),r=n.subParser("italicsAndBold")(r,s,a),r=n.subParser("strikethrough")(r,s,a),r=n.subParser("ellipsis")(r,s,a),r=n.subParser("hashHTMLSpans")(r,s,a),r=n.subParser("encodeAmpsAndAngles")(r,s,a),s.simpleLineBreaks?/\n\n¨K/.test(r)||(r=r.replace(/\n+/g,`<br />
`)):r=r.replace(/  +\n/g,`<br />
`),r=a.converter._dispatch("spanGamut.after",r,s,a),r}),n.subParser("strikethrough",function(r,s,a){function c(m){return s.simplifiedAutoLink&&(m=n.subParser("simplifiedAutoLinks")(m,s,a)),"<del>"+m+"</del>"}return s.strikethrough&&(r=a.converter._dispatch("strikethrough.before",r,s,a),r=r.replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,function(m,g){return c(g)}),r=a.converter._dispatch("strikethrough.after",r,s,a)),r}),n.subParser("stripLinkDefinitions",function(r,s,a){var c=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?([^>\s]+)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=¨0))/gm,m=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n\n|(?=¨0)|(?=\n\[))/gm;r+="¨0";var g=function(h,y,A,b,O,S,f){return y=y.toLowerCase(),r.toLowerCase().split(y).length-1<2?h:(A.match(/^data:.+?\/.+?;base64,/)?a.gUrls[y]=A.replace(/\s/g,""):a.gUrls[y]=n.subParser("encodeAmpsAndAngles")(A,s,a),S?S+f:(f&&(a.gTitles[y]=f.replace(/"|'/g,"&quot;")),s.parseImgDimensions&&b&&O&&(a.gDimensions[y]={width:b,height:O}),""))};return r=r.replace(m,g),r=r.replace(c,g),r=r.replace(/¨0/,""),r}),n.subParser("tables",function(r,s,a){if(!s.tables)return r;var c=/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|¨0)/gm,m=/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|¨0)/gm;function g(O){return/^:[ \t]*--*$/.test(O)?' style="text-align:left;"':/^--*[ \t]*:[ \t]*$/.test(O)?' style="text-align:right;"':/^:[ \t]*--*[ \t]*:$/.test(O)?' style="text-align:center;"':""}function h(O,S){var f="";return O=O.trim(),(s.tablesHeaderId||s.tableHeaderId)&&(f=' id="'+O.replace(/ /g,"_").toLowerCase()+'"'),O=n.subParser("spanGamut")(O,s,a),"<th"+f+S+">"+O+`</th>
`}function y(O,S){var f=n.subParser("spanGamut")(O,s,a);return"<td"+S+">"+f+`</td>
`}function A(O,S){for(var f=`<table>
<thead>
<tr>
`,T=O.length,R=0;R<T;++R)f+=O[R];for(f+=`</tr>
</thead>
<tbody>
`,R=0;R<S.length;++R){f+=`<tr>
`;for(var M=0;M<T;++M)f+=S[R][M];f+=`</tr>
`}return f+=`</tbody>
</table>
`,f}function b(O){var S,f=O.split(`
`);for(S=0;S<f.length;++S)/^ {0,3}\|/.test(f[S])&&(f[S]=f[S].replace(/^ {0,3}\|/,"")),/\|[ \t]*$/.test(f[S])&&(f[S]=f[S].replace(/\|[ \t]*$/,"")),f[S]=n.subParser("codeSpans")(f[S],s,a);var T=f[0].split("|").map(function(x){return x.trim()}),R=f[1].split("|").map(function(x){return x.trim()}),M=[],$=[],D=[],X=[];for(f.shift(),f.shift(),S=0;S<f.length;++S)f[S].trim()!==""&&M.push(f[S].split("|").map(function(x){return x.trim()}));if(T.length<R.length)return O;for(S=0;S<R.length;++S)D.push(g(R[S]));for(S=0;S<T.length;++S)n.helper.isUndefined(D[S])&&(D[S]=""),$.push(h(T[S],D[S]));for(S=0;S<M.length;++S){for(var Q=[],J=0;J<$.length;++J)n.helper.isUndefined(M[S][J]),Q.push(y(M[S][J],D[J]));X.push(Q)}return A($,X)}return r=a.converter._dispatch("tables.before",r,s,a),r=r.replace(/\\(\|)/g,n.helper.escapeCharactersCallback),r=r.replace(c,b),r=r.replace(m,b),r=a.converter._dispatch("tables.after",r,s,a),r}),n.subParser("underline",function(r,s,a){return s.underline&&(r=a.converter._dispatch("underline.before",r,s,a),s.literalMidWordUnderscores?(r=r.replace(/\b___(\S[\s\S]*?)___\b/g,function(c,m){return"<u>"+m+"</u>"}),r=r.replace(/\b__(\S[\s\S]*?)__\b/g,function(c,m){return"<u>"+m+"</u>"})):(r=r.replace(/___(\S[\s\S]*?)___/g,function(c,m){return/\S$/.test(m)?"<u>"+m+"</u>":c}),r=r.replace(/__(\S[\s\S]*?)__/g,function(c,m){return/\S$/.test(m)?"<u>"+m+"</u>":c})),r=r.replace(/(_)/g,n.helper.escapeCharactersCallback),r=a.converter._dispatch("underline.after",r,s,a)),r}),n.subParser("unescapeSpecialChars",function(r,s,a){return r=a.converter._dispatch("unescapeSpecialChars.before",r,s,a),r=r.replace(/¨E(\d+)E/g,function(c,m){var g=parseInt(m);return String.fromCharCode(g)}),r=a.converter._dispatch("unescapeSpecialChars.after",r,s,a),r}),n.subParser("makeMarkdown.blockquote",function(r,s){var a="";if(r.hasChildNodes())for(var c=r.childNodes,m=c.length,g=0;g<m;++g){var h=n.subParser("makeMarkdown.node")(c[g],s);h!==""&&(a+=h)}return a=a.trim(),a="> "+a.split(`
`).join(`
> `),a}),n.subParser("makeMarkdown.codeBlock",function(r,s){var a=r.getAttribute("language"),c=r.getAttribute("precodenum");return"```"+a+`
`+s.preList[c]+"\n```"}),n.subParser("makeMarkdown.codeSpan",function(r){return"`"+r.innerHTML+"`"}),n.subParser("makeMarkdown.emphasis",function(r,s){var a="";if(r.hasChildNodes()){a+="*";for(var c=r.childNodes,m=c.length,g=0;g<m;++g)a+=n.subParser("makeMarkdown.node")(c[g],s);a+="*"}return a}),n.subParser("makeMarkdown.header",function(r,s,a){var c=new Array(a+1).join("#"),m="";if(r.hasChildNodes()){m=c+" ";for(var g=r.childNodes,h=g.length,y=0;y<h;++y)m+=n.subParser("makeMarkdown.node")(g[y],s)}return m}),n.subParser("makeMarkdown.hr",function(){return"---"}),n.subParser("makeMarkdown.image",function(r){var s="";return r.hasAttribute("src")&&(s+="!["+r.getAttribute("alt")+"](",s+="<"+r.getAttribute("src")+">",r.hasAttribute("width")&&r.hasAttribute("height")&&(s+=" ="+r.getAttribute("width")+"x"+r.getAttribute("height")),r.hasAttribute("title")&&(s+=' "'+r.getAttribute("title")+'"'),s+=")"),s}),n.subParser("makeMarkdown.links",function(r,s){var a="";if(r.hasChildNodes()&&r.hasAttribute("href")){var c=r.childNodes,m=c.length;a="[";for(var g=0;g<m;++g)a+=n.subParser("makeMarkdown.node")(c[g],s);a+="](",a+="<"+r.getAttribute("href")+">",r.hasAttribute("title")&&(a+=' "'+r.getAttribute("title")+'"'),a+=")"}return a}),n.subParser("makeMarkdown.list",function(r,s,a){var c="";if(!r.hasChildNodes())return"";for(var m=r.childNodes,g=m.length,h=r.getAttribute("start")||1,y=0;y<g;++y)if(!(typeof m[y].tagName>"u"||m[y].tagName.toLowerCase()!=="li")){var A="";a==="ol"?A=h.toString()+". ":A="- ",c+=A+n.subParser("makeMarkdown.listItem")(m[y],s),++h}return c+=`
<!-- -->
`,c.trim()}),n.subParser("makeMarkdown.listItem",function(r,s){for(var a="",c=r.childNodes,m=c.length,g=0;g<m;++g)a+=n.subParser("makeMarkdown.node")(c[g],s);return/\n$/.test(a)?a=a.split(`
`).join(`
    `).replace(/^ {4}$/gm,"").replace(/\n\n+/g,`

`):a+=`
`,a}),n.subParser("makeMarkdown.node",function(r,s,a){a=a||!1;var c="";if(r.nodeType===3)return n.subParser("makeMarkdown.txt")(r,s);if(r.nodeType===8)return"<!--"+r.data+`-->

`;if(r.nodeType!==1)return"";var m=r.tagName.toLowerCase();switch(m){case"h1":a||(c=n.subParser("makeMarkdown.header")(r,s,1)+`

`);break;case"h2":a||(c=n.subParser("makeMarkdown.header")(r,s,2)+`

`);break;case"h3":a||(c=n.subParser("makeMarkdown.header")(r,s,3)+`

`);break;case"h4":a||(c=n.subParser("makeMarkdown.header")(r,s,4)+`

`);break;case"h5":a||(c=n.subParser("makeMarkdown.header")(r,s,5)+`

`);break;case"h6":a||(c=n.subParser("makeMarkdown.header")(r,s,6)+`

`);break;case"p":a||(c=n.subParser("makeMarkdown.paragraph")(r,s)+`

`);break;case"blockquote":a||(c=n.subParser("makeMarkdown.blockquote")(r,s)+`

`);break;case"hr":a||(c=n.subParser("makeMarkdown.hr")(r,s)+`

`);break;case"ol":a||(c=n.subParser("makeMarkdown.list")(r,s,"ol")+`

`);break;case"ul":a||(c=n.subParser("makeMarkdown.list")(r,s,"ul")+`

`);break;case"precode":a||(c=n.subParser("makeMarkdown.codeBlock")(r,s)+`

`);break;case"pre":a||(c=n.subParser("makeMarkdown.pre")(r,s)+`

`);break;case"table":a||(c=n.subParser("makeMarkdown.table")(r,s)+`

`);break;case"code":c=n.subParser("makeMarkdown.codeSpan")(r,s);break;case"em":case"i":c=n.subParser("makeMarkdown.emphasis")(r,s);break;case"strong":case"b":c=n.subParser("makeMarkdown.strong")(r,s);break;case"del":c=n.subParser("makeMarkdown.strikethrough")(r,s);break;case"a":c=n.subParser("makeMarkdown.links")(r,s);break;case"img":c=n.subParser("makeMarkdown.image")(r,s);break;default:c=r.outerHTML+`

`}return c}),n.subParser("makeMarkdown.paragraph",function(r,s){var a="";if(r.hasChildNodes())for(var c=r.childNodes,m=c.length,g=0;g<m;++g)a+=n.subParser("makeMarkdown.node")(c[g],s);return a=a.trim(),a}),n.subParser("makeMarkdown.pre",function(r,s){var a=r.getAttribute("prenum");return"<pre>"+s.preList[a]+"</pre>"}),n.subParser("makeMarkdown.strikethrough",function(r,s){var a="";if(r.hasChildNodes()){a+="~~";for(var c=r.childNodes,m=c.length,g=0;g<m;++g)a+=n.subParser("makeMarkdown.node")(c[g],s);a+="~~"}return a}),n.subParser("makeMarkdown.strong",function(r,s){var a="";if(r.hasChildNodes()){a+="**";for(var c=r.childNodes,m=c.length,g=0;g<m;++g)a+=n.subParser("makeMarkdown.node")(c[g],s);a+="**"}return a}),n.subParser("makeMarkdown.table",function(r,s){var a="",c=[[],[]],m=r.querySelectorAll("thead>tr>th"),g=r.querySelectorAll("tbody>tr"),h,y;for(h=0;h<m.length;++h){var A=n.subParser("makeMarkdown.tableCell")(m[h],s),b="---";if(m[h].hasAttribute("style")){var O=m[h].getAttribute("style").toLowerCase().replace(/\s/g,"");switch(O){case"text-align:left;":b=":---";break;case"text-align:right;":b="---:";break;case"text-align:center;":b=":---:";break}}c[0][h]=A.trim(),c[1][h]=b}for(h=0;h<g.length;++h){var S=c.push([])-1,f=g[h].getElementsByTagName("td");for(y=0;y<m.length;++y){var T=" ";typeof f[y]<"u"&&(T=n.subParser("makeMarkdown.tableCell")(f[y],s)),c[S].push(T)}}var R=3;for(h=0;h<c.length;++h)for(y=0;y<c[h].length;++y){var M=c[h][y].length;M>R&&(R=M)}for(h=0;h<c.length;++h){for(y=0;y<c[h].length;++y)h===1?c[h][y].slice(-1)===":"?c[h][y]=n.helper.padEnd(c[h][y].slice(-1),R-1,"-")+":":c[h][y]=n.helper.padEnd(c[h][y],R,"-"):c[h][y]=n.helper.padEnd(c[h][y],R);a+="| "+c[h].join(" | ")+` |
`}return a.trim()}),n.subParser("makeMarkdown.tableCell",function(r,s){var a="";if(!r.hasChildNodes())return"";for(var c=r.childNodes,m=c.length,g=0;g<m;++g)a+=n.subParser("makeMarkdown.node")(c[g],s,!0);return a.trim()}),n.subParser("makeMarkdown.txt",function(r){var s=r.nodeValue;return s=s.replace(/ +/g," "),s=s.replace(/¨NBSP;/g," "),s=n.helper.unescapeHTMLEntities(s),s=s.replace(/([*_~|`])/g,"\\$1"),s=s.replace(/^(\s*)>/g,"\\$1>"),s=s.replace(/^#/gm,"\\#"),s=s.replace(/^(\s*)([-=]{3,})(\s*)$/,"$1\\$2$3"),s=s.replace(/^( {0,3}\d+)\./gm,"$1\\."),s=s.replace(/^( {0,3})([+-])/gm,"$1\\$2"),s=s.replace(/]([\s]*)\(/g,"\\]$1\\("),s=s.replace(/^ {0,3}\[([\S \t]*?)]:/gm,"\\[$1]:"),s});var L=this;t.exports?t.exports=n:L.showdown=n}).call(pi)})(Ur);var za=Ur.exports,ue="top",ve="bottom",we="right",ce="left",kn="auto",Ot=[ue,ve,we,ce],et="start",vt="end",Ua="clippingParents",Gr="viewport",ot="popper",Ga="reference",nr=Ot.reduce(function(t,e){return t.concat([e+"-"+et,e+"-"+vt])},[]),$r=[].concat(Ot,[kn]).reduce(function(t,e){return t.concat([e,e+"-"+et,e+"-"+vt])},[]),$a="beforeRead",Va="read",xa="afterRead",Wa="beforeMain",Fa="main",Ya="afterMain",Xa="beforeWrite",qa="write",Ka="afterWrite",Za=[$a,Va,xa,Wa,Fa,Ya,Xa,qa,Ka];function Se(t){return t?(t.nodeName||"").toLowerCase():null}function he(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function We(t){var e=he(t).Element;return t instanceof e||t instanceof Element}function ye(t){var e=he(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function Mn(t){if(typeof ShadowRoot>"u")return!1;var e=he(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function Qa(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var n=e.styles[i]||{},d=e.attributes[i]||{},o=e.elements[i];!ye(o)||!Se(o)||(Object.assign(o.style,n),Object.keys(d).forEach(function(u){var p=d[u];p===!1?o.removeAttribute(u):o.setAttribute(u,p===!0?"":p)}))})}function Ja(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(n){var d=e.elements[n],o=e.attributes[n]||{},u=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:i[n]),p=u.reduce(function(_,v){return _[v]="",_},{});!ye(d)||!Se(d)||(Object.assign(d.style,p),Object.keys(o).forEach(function(_){d.removeAttribute(_)}))})}}const Vr={name:"applyStyles",enabled:!0,phase:"write",fn:Qa,effect:Ja,requires:["computeStyles"]};function Ae(t){return t.split("-")[0]}var Ue=Math.max,Ft=Math.min,tt=Math.round;function yn(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function xr(){return!/^((?!chrome|android).)*safari/i.test(yn())}function nt(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var n=t.getBoundingClientRect(),d=1,o=1;e&&ye(t)&&(d=t.offsetWidth>0&&tt(n.width)/t.offsetWidth||1,o=t.offsetHeight>0&&tt(n.height)/t.offsetHeight||1);var u=We(t)?he(t):window,p=u.visualViewport,_=!xr()&&i,v=(n.left+(_&&p?p.offsetLeft:0))/d,l=(n.top+(_&&p?p.offsetTop:0))/o,w=n.width/d,C=n.height/o;return{width:w,height:C,top:l,right:v+w,bottom:l+C,left:v,x:v,y:l}}function Nn(t){var e=nt(t),i=t.offsetWidth,n=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:n}}function Wr(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&Mn(i)){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function Be(t){return he(t).getComputedStyle(t)}function es(t){return["table","td","th"].indexOf(Se(t))>=0}function Le(t){return((We(t)?t.ownerDocument:t.document)||window.document).documentElement}function Kt(t){return Se(t)==="html"?t:t.assignedSlot||t.parentNode||(Mn(t)?t.host:null)||Le(t)}function rr(t){return!ye(t)||Be(t).position==="fixed"?null:t.offsetParent}function ts(t){var e=/firefox/i.test(yn()),i=/Trident/i.test(yn());if(i&&ye(t)){var n=Be(t);if(n.position==="fixed")return null}var d=Kt(t);for(Mn(d)&&(d=d.host);ye(d)&&["html","body"].indexOf(Se(d))<0;){var o=Be(d);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||e&&o.willChange==="filter"||e&&o.filter&&o.filter!=="none")return d;d=d.parentNode}return null}function Tt(t){for(var e=he(t),i=rr(t);i&&es(i)&&Be(i).position==="static";)i=rr(i);return i&&(Se(i)==="html"||Se(i)==="body"&&Be(i).position==="static")?e:i||ts(t)||e}function Ln(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function ft(t,e,i){return Ue(t,Ft(e,i))}function ns(t,e,i){var n=ft(t,e,i);return n>i?i:n}function Fr(){return{top:0,right:0,bottom:0,left:0}}function Yr(t){return Object.assign({},Fr(),t)}function Xr(t,e){return e.reduce(function(i,n){return i[n]=t,i},{})}var rs=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,Yr(typeof e!="number"?e:Xr(e,Ot))};function is(t){var e,i=t.state,n=t.name,d=t.options,o=i.elements.arrow,u=i.modifiersData.popperOffsets,p=Ae(i.placement),_=Ln(p),v=[ce,we].indexOf(p)>=0,l=v?"height":"width";if(!(!o||!u)){var w=rs(d.padding,i),C=Nn(o),B=_==="y"?ue:ce,N=_==="y"?ve:we,I=i.rects.reference[l]+i.rects.reference[_]-u[_]-i.rects.popper[l],P=u[_]-i.rects.reference[_],k=Tt(o),z=k?_==="y"?k.clientHeight||0:k.clientWidth||0:0,L=I/2-P/2,r=w[B],s=z-C[l]-w[N],a=z/2-C[l]/2+L,c=ft(r,a,s),m=_;i.modifiersData[n]=(e={},e[m]=c,e.centerOffset=c-a,e)}}function as(t){var e=t.state,i=t.options,n=i.element,d=n===void 0?"[data-popper-arrow]":n;d!=null&&(typeof d=="string"&&(d=e.elements.popper.querySelector(d),!d)||Wr(e.elements.popper,d)&&(e.elements.arrow=d))}const ss={name:"arrow",enabled:!0,phase:"main",fn:is,effect:as,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function rt(t){return t.split("-")[1]}var ds={top:"auto",right:"auto",bottom:"auto",left:"auto"};function os(t,e){var i=t.x,n=t.y,d=e.devicePixelRatio||1;return{x:tt(i*d)/d||0,y:tt(n*d)/d||0}}function ir(t){var e,i=t.popper,n=t.popperRect,d=t.placement,o=t.variation,u=t.offsets,p=t.position,_=t.gpuAcceleration,v=t.adaptive,l=t.roundOffsets,w=t.isFixed,C=u.x,B=C===void 0?0:C,N=u.y,I=N===void 0?0:N,P=typeof l=="function"?l({x:B,y:I}):{x:B,y:I};B=P.x,I=P.y;var k=u.hasOwnProperty("x"),z=u.hasOwnProperty("y"),L=ce,r=ue,s=window;if(v){var a=Tt(i),c="clientHeight",m="clientWidth";if(a===he(i)&&(a=Le(i),Be(a).position!=="static"&&p==="absolute"&&(c="scrollHeight",m="scrollWidth")),a=a,d===ue||(d===ce||d===we)&&o===vt){r=ve;var g=w&&a===s&&s.visualViewport?s.visualViewport.height:a[c];I-=g-n.height,I*=_?1:-1}if(d===ce||(d===ue||d===ve)&&o===vt){L=we;var h=w&&a===s&&s.visualViewport?s.visualViewport.width:a[m];B-=h-n.width,B*=_?1:-1}}var y=Object.assign({position:p},v&&ds),A=l===!0?os({x:B,y:I},he(i)):{x:B,y:I};if(B=A.x,I=A.y,_){var b;return Object.assign({},y,(b={},b[r]=z?"0":"",b[L]=k?"0":"",b.transform=(s.devicePixelRatio||1)<=1?"translate("+B+"px, "+I+"px)":"translate3d("+B+"px, "+I+"px, 0)",b))}return Object.assign({},y,(e={},e[r]=z?I+"px":"",e[L]=k?B+"px":"",e.transform="",e))}function us(t){var e=t.state,i=t.options,n=i.gpuAcceleration,d=n===void 0?!0:n,o=i.adaptive,u=o===void 0?!0:o,p=i.roundOffsets,_=p===void 0?!0:p,v={placement:Ae(e.placement),variation:rt(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:d,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,ir(Object.assign({},v,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:u,roundOffsets:_})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,ir(Object.assign({},v,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:_})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const cs={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:us,data:{}};var Ut={passive:!0};function ls(t){var e=t.state,i=t.instance,n=t.options,d=n.scroll,o=d===void 0?!0:d,u=n.resize,p=u===void 0?!0:u,_=he(e.elements.popper),v=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&v.forEach(function(l){l.addEventListener("scroll",i.update,Ut)}),p&&_.addEventListener("resize",i.update,Ut),function(){o&&v.forEach(function(l){l.removeEventListener("scroll",i.update,Ut)}),p&&_.removeEventListener("resize",i.update,Ut)}}const fs={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:ls,data:{}};var hs={left:"right",right:"left",bottom:"top",top:"bottom"};function Vt(t){return t.replace(/left|right|bottom|top/g,function(e){return hs[e]})}var ps={start:"end",end:"start"};function ar(t){return t.replace(/start|end/g,function(e){return ps[e]})}function Pn(t){var e=he(t),i=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:i,scrollTop:n}}function Dn(t){return nt(Le(t)).left+Pn(t).scrollLeft}function ms(t,e){var i=he(t),n=Le(t),d=i.visualViewport,o=n.clientWidth,u=n.clientHeight,p=0,_=0;if(d){o=d.width,u=d.height;var v=xr();(v||!v&&e==="fixed")&&(p=d.offsetLeft,_=d.offsetTop)}return{width:o,height:u,x:p+Dn(t),y:_}}function _s(t){var e,i=Le(t),n=Pn(t),d=(e=t.ownerDocument)==null?void 0:e.body,o=Ue(i.scrollWidth,i.clientWidth,d?d.scrollWidth:0,d?d.clientWidth:0),u=Ue(i.scrollHeight,i.clientHeight,d?d.scrollHeight:0,d?d.clientHeight:0),p=-n.scrollLeft+Dn(t),_=-n.scrollTop;return Be(d||i).direction==="rtl"&&(p+=Ue(i.clientWidth,d?d.clientWidth:0)-o),{width:o,height:u,x:p,y:_}}function Hn(t){var e=Be(t),i=e.overflow,n=e.overflowX,d=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+d+n)}function qr(t){return["html","body","#document"].indexOf(Se(t))>=0?t.ownerDocument.body:ye(t)&&Hn(t)?t:qr(Kt(t))}function ht(t,e){var i;e===void 0&&(e=[]);var n=qr(t),d=n===((i=t.ownerDocument)==null?void 0:i.body),o=he(n),u=d?[o].concat(o.visualViewport||[],Hn(n)?n:[]):n,p=e.concat(u);return d?p:p.concat(ht(Kt(u)))}function vn(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function gs(t,e){var i=nt(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function sr(t,e,i){return e===Gr?vn(ms(t,i)):We(e)?gs(e,i):vn(_s(Le(t)))}function ys(t){var e=ht(Kt(t)),i=["absolute","fixed"].indexOf(Be(t).position)>=0,n=i&&ye(t)?Tt(t):t;return We(n)?e.filter(function(d){return We(d)&&Wr(d,n)&&Se(d)!=="body"}):[]}function vs(t,e,i,n){var d=e==="clippingParents"?ys(t):[].concat(e),o=[].concat(d,[i]),u=o[0],p=o.reduce(function(_,v){var l=sr(t,v,n);return _.top=Ue(l.top,_.top),_.right=Ft(l.right,_.right),_.bottom=Ft(l.bottom,_.bottom),_.left=Ue(l.left,_.left),_},sr(t,u,n));return p.width=p.right-p.left,p.height=p.bottom-p.top,p.x=p.left,p.y=p.top,p}function Kr(t){var e=t.reference,i=t.element,n=t.placement,d=n?Ae(n):null,o=n?rt(n):null,u=e.x+e.width/2-i.width/2,p=e.y+e.height/2-i.height/2,_;switch(d){case ue:_={x:u,y:e.y-i.height};break;case ve:_={x:u,y:e.y+e.height};break;case we:_={x:e.x+e.width,y:p};break;case ce:_={x:e.x-i.width,y:p};break;default:_={x:e.x,y:e.y}}var v=d?Ln(d):null;if(v!=null){var l=v==="y"?"height":"width";switch(o){case et:_[v]=_[v]-(e[l]/2-i[l]/2);break;case vt:_[v]=_[v]+(e[l]/2-i[l]/2);break}}return _}function wt(t,e){e===void 0&&(e={});var i=e,n=i.placement,d=n===void 0?t.placement:n,o=i.strategy,u=o===void 0?t.strategy:o,p=i.boundary,_=p===void 0?Ua:p,v=i.rootBoundary,l=v===void 0?Gr:v,w=i.elementContext,C=w===void 0?ot:w,B=i.altBoundary,N=B===void 0?!1:B,I=i.padding,P=I===void 0?0:I,k=Yr(typeof P!="number"?P:Xr(P,Ot)),z=C===ot?Ga:ot,L=t.rects.popper,r=t.elements[N?z:C],s=vs(We(r)?r:r.contextElement||Le(t.elements.popper),_,l,u),a=nt(t.elements.reference),c=Kr({reference:a,element:L,strategy:"absolute",placement:d}),m=vn(Object.assign({},L,c)),g=C===ot?m:a,h={top:s.top-g.top+k.top,bottom:g.bottom-s.bottom+k.bottom,left:s.left-g.left+k.left,right:g.right-s.right+k.right},y=t.modifiersData.offset;if(C===ot&&y){var A=y[d];Object.keys(h).forEach(function(b){var O=[we,ve].indexOf(b)>=0?1:-1,S=[ue,ve].indexOf(b)>=0?"y":"x";h[b]+=A[S]*O})}return h}function ws(t,e){e===void 0&&(e={});var i=e,n=i.placement,d=i.boundary,o=i.rootBoundary,u=i.padding,p=i.flipVariations,_=i.allowedAutoPlacements,v=_===void 0?$r:_,l=rt(n),w=l?p?nr:nr.filter(function(N){return rt(N)===l}):Ot,C=w.filter(function(N){return v.indexOf(N)>=0});C.length===0&&(C=w);var B=C.reduce(function(N,I){return N[I]=wt(t,{placement:I,boundary:d,rootBoundary:o,padding:u})[Ae(I)],N},{});return Object.keys(B).sort(function(N,I){return B[N]-B[I]})}function bs(t){if(Ae(t)===kn)return[];var e=Vt(t);return[ar(t),e,ar(e)]}function Es(t){var e=t.state,i=t.options,n=t.name;if(!e.modifiersData[n]._skip){for(var d=i.mainAxis,o=d===void 0?!0:d,u=i.altAxis,p=u===void 0?!0:u,_=i.fallbackPlacements,v=i.padding,l=i.boundary,w=i.rootBoundary,C=i.altBoundary,B=i.flipVariations,N=B===void 0?!0:B,I=i.allowedAutoPlacements,P=e.options.placement,k=Ae(P),z=k===P,L=_||(z||!N?[Vt(P)]:bs(P)),r=[P].concat(L).reduce(function(J,x){return J.concat(Ae(x)===kn?ws(e,{placement:x,boundary:l,rootBoundary:w,padding:v,flipVariations:N,allowedAutoPlacements:I}):x)},[]),s=e.rects.reference,a=e.rects.popper,c=new Map,m=!0,g=r[0],h=0;h<r.length;h++){var y=r[h],A=Ae(y),b=rt(y)===et,O=[ue,ve].indexOf(A)>=0,S=O?"width":"height",f=wt(e,{placement:y,boundary:l,rootBoundary:w,altBoundary:C,padding:v}),T=O?b?we:ce:b?ve:ue;s[S]>a[S]&&(T=Vt(T));var R=Vt(T),M=[];if(o&&M.push(f[A]<=0),p&&M.push(f[T]<=0,f[R]<=0),M.every(function(J){return J})){g=y,m=!1;break}c.set(y,M)}if(m)for(var $=N?3:1,D=function(x){var q=r.find(function(ee){var Z=c.get(ee);if(Z)return Z.slice(0,x).every(function(Oe){return Oe})});if(q)return g=q,"break"},X=$;X>0;X--){var Q=D(X);if(Q==="break")break}e.placement!==g&&(e.modifiersData[n]._skip=!0,e.placement=g,e.reset=!0)}}const Os={name:"flip",enabled:!0,phase:"main",fn:Es,requiresIfExists:["offset"],data:{_skip:!1}};function dr(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function or(t){return[ue,we,ve,ce].some(function(e){return t[e]>=0})}function Ts(t){var e=t.state,i=t.name,n=e.rects.reference,d=e.rects.popper,o=e.modifiersData.preventOverflow,u=wt(e,{elementContext:"reference"}),p=wt(e,{altBoundary:!0}),_=dr(u,n),v=dr(p,d,o),l=or(_),w=or(v);e.modifiersData[i]={referenceClippingOffsets:_,popperEscapeOffsets:v,isReferenceHidden:l,hasPopperEscaped:w},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":l,"data-popper-escaped":w})}const As={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Ts};function Ss(t,e,i){var n=Ae(t),d=[ce,ue].indexOf(n)>=0?-1:1,o=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,u=o[0],p=o[1];return u=u||0,p=(p||0)*d,[ce,we].indexOf(n)>=0?{x:p,y:u}:{x:u,y:p}}function Cs(t){var e=t.state,i=t.options,n=t.name,d=i.offset,o=d===void 0?[0,0]:d,u=$r.reduce(function(l,w){return l[w]=Ss(w,e.rects,o),l},{}),p=u[e.placement],_=p.x,v=p.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=_,e.modifiersData.popperOffsets.y+=v),e.modifiersData[n]=u}const Rs={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Cs};function Bs(t){var e=t.state,i=t.name;e.modifiersData[i]=Kr({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const Is={name:"popperOffsets",enabled:!0,phase:"read",fn:Bs,data:{}};function ks(t){return t==="x"?"y":"x"}function Ms(t){var e=t.state,i=t.options,n=t.name,d=i.mainAxis,o=d===void 0?!0:d,u=i.altAxis,p=u===void 0?!1:u,_=i.boundary,v=i.rootBoundary,l=i.altBoundary,w=i.padding,C=i.tether,B=C===void 0?!0:C,N=i.tetherOffset,I=N===void 0?0:N,P=wt(e,{boundary:_,rootBoundary:v,padding:w,altBoundary:l}),k=Ae(e.placement),z=rt(e.placement),L=!z,r=Ln(k),s=ks(r),a=e.modifiersData.popperOffsets,c=e.rects.reference,m=e.rects.popper,g=typeof I=="function"?I(Object.assign({},e.rects,{placement:e.placement})):I,h=typeof g=="number"?{mainAxis:g,altAxis:g}:Object.assign({mainAxis:0,altAxis:0},g),y=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,A={x:0,y:0};if(a){if(o){var b,O=r==="y"?ue:ce,S=r==="y"?ve:we,f=r==="y"?"height":"width",T=a[r],R=T+P[O],M=T-P[S],$=B?-m[f]/2:0,D=z===et?c[f]:m[f],X=z===et?-m[f]:-c[f],Q=e.elements.arrow,J=B&&Q?Nn(Q):{width:0,height:0},x=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Fr(),q=x[O],ee=x[S],Z=ft(0,c[f],J[f]),Oe=L?c[f]/2-$-Z-q-h.mainAxis:D-Z-q-h.mainAxis,pe=L?-c[f]/2+$+Z+ee+h.mainAxis:X+Z+ee+h.mainAxis,Ce=e.elements.arrow&&Tt(e.elements.arrow),Ie=Ce?r==="y"?Ce.clientTop||0:Ce.clientLeft||0:0,ke=(b=y?.[r])!=null?b:0,St=T+Oe-ke-Ie,Ct=T+pe-ke,it=ft(B?Ft(R,St):R,T,B?Ue(M,Ct):M);a[r]=it,A[r]=it-T}if(p){var at,Rt=r==="x"?ue:ce,Bt=r==="x"?ve:we,Re=a[s],Me=s==="y"?"height":"width",st=Re+P[Rt],Pe=Re-P[Bt],dt=[ue,ce].indexOf(k)!==-1,It=(at=y?.[s])!=null?at:0,kt=dt?st:Re-c[Me]-m[Me]-It+h.altAxis,Mt=dt?Re+c[Me]+m[Me]-It-h.altAxis:Pe,Nt=B&&dt?ns(kt,Re,Mt):ft(B?kt:st,Re,B?Mt:Pe);a[s]=Nt,A[s]=Nt-Re}e.modifiersData[n]=A}}const Ns={name:"preventOverflow",enabled:!0,phase:"main",fn:Ms,requiresIfExists:["offset"]};function Ls(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function Ps(t){return t===he(t)||!ye(t)?Pn(t):Ls(t)}function Ds(t){var e=t.getBoundingClientRect(),i=tt(e.width)/t.offsetWidth||1,n=tt(e.height)/t.offsetHeight||1;return i!==1||n!==1}function Hs(t,e,i){i===void 0&&(i=!1);var n=ye(e),d=ye(e)&&Ds(e),o=Le(e),u=nt(t,d,i),p={scrollLeft:0,scrollTop:0},_={x:0,y:0};return(n||!n&&!i)&&((Se(e)!=="body"||Hn(o))&&(p=Ps(e)),ye(e)?(_=nt(e,!0),_.x+=e.clientLeft,_.y+=e.clientTop):o&&(_.x=Dn(o))),{x:u.left+p.scrollLeft-_.x,y:u.top+p.scrollTop-_.y,width:u.width,height:u.height}}function js(t){var e=new Map,i=new Set,n=[];t.forEach(function(o){e.set(o.name,o)});function d(o){i.add(o.name);var u=[].concat(o.requires||[],o.requiresIfExists||[]);u.forEach(function(p){if(!i.has(p)){var _=e.get(p);_&&d(_)}}),n.push(o)}return t.forEach(function(o){i.has(o.name)||d(o)}),n}function zs(t){var e=js(t);return Za.reduce(function(i,n){return i.concat(e.filter(function(d){return d.phase===n}))},[])}function Us(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function Gs(t){var e=t.reduce(function(i,n){var d=i[n.name];return i[n.name]=d?Object.assign({},d,n,{options:Object.assign({},d.options,n.options),data:Object.assign({},d.data,n.data)}):n,i},{});return Object.keys(e).map(function(i){return e[i]})}var ur={placement:"bottom",modifiers:[],strategy:"absolute"};function cr(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function $s(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,n=i===void 0?[]:i,d=e.defaultOptions,o=d===void 0?ur:d;return function(p,_,v){v===void 0&&(v=o);var l={placement:"bottom",orderedModifiers:[],options:Object.assign({},ur,o),modifiersData:{},elements:{reference:p,popper:_},attributes:{},styles:{}},w=[],C=!1,B={state:l,setOptions:function(k){var z=typeof k=="function"?k(l.options):k;I(),l.options=Object.assign({},o,l.options,z),l.scrollParents={reference:We(p)?ht(p):p.contextElement?ht(p.contextElement):[],popper:ht(_)};var L=zs(Gs([].concat(n,l.options.modifiers)));return l.orderedModifiers=L.filter(function(r){return r.enabled}),N(),B.update()},forceUpdate:function(){if(!C){var k=l.elements,z=k.reference,L=k.popper;if(cr(z,L)){l.rects={reference:Hs(z,Tt(L),l.options.strategy==="fixed"),popper:Nn(L)},l.reset=!1,l.placement=l.options.placement,l.orderedModifiers.forEach(function(h){return l.modifiersData[h.name]=Object.assign({},h.data)});for(var r=0;r<l.orderedModifiers.length;r++){if(l.reset===!0){l.reset=!1,r=-1;continue}var s=l.orderedModifiers[r],a=s.fn,c=s.options,m=c===void 0?{}:c,g=s.name;typeof a=="function"&&(l=a({state:l,options:m,name:g,instance:B})||l)}}}},update:Us(function(){return new Promise(function(P){B.forceUpdate(),P(l)})}),destroy:function(){I(),C=!0}};if(!cr(p,_))return B;B.setOptions(v).then(function(P){!C&&v.onFirstUpdate&&v.onFirstUpdate(P)});function N(){l.orderedModifiers.forEach(function(P){var k=P.name,z=P.options,L=z===void 0?{}:z,r=P.effect;if(typeof r=="function"){var s=r({state:l,name:k,instance:B,options:L}),a=function(){};w.push(s||a)}})}function I(){w.forEach(function(P){return P()}),w=[]}return B}}var Vs=[fs,Is,cs,Vr,Rs,Os,Ns,ss,As],xs=$s({defaultModifiers:Vs}),Ws="tippy-box",Zr="tippy-content",Fs="tippy-backdrop",Qr="tippy-arrow",Jr="tippy-svg-arrow",je={passive:!0,capture:!0},ei=function(){return document.body};function dn(t,e,i){if(Array.isArray(t)){var n=t[e];return n??(Array.isArray(i)?i[e]:i)}return t}function jn(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function ti(t,e){return typeof t=="function"?t.apply(void 0,e):t}function lr(t,e){if(e===0)return t;var i;return function(n){clearTimeout(i),i=setTimeout(function(){t(n)},e)}}function Ys(t){return t.split(/\s+/).filter(Boolean)}function Qe(t){return[].concat(t)}function fr(t,e){t.indexOf(e)===-1&&t.push(e)}function Xs(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function qs(t){return t.split("-")[0]}function Yt(t){return[].slice.call(t)}function hr(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function pt(){return document.createElement("div")}function Zt(t){return["Element","Fragment"].some(function(e){return jn(t,e)})}function Ks(t){return jn(t,"NodeList")}function Zs(t){return jn(t,"MouseEvent")}function Qs(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function Js(t){return Zt(t)?[t]:Ks(t)?Yt(t):Array.isArray(t)?t:Yt(document.querySelectorAll(t))}function on(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function pr(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function ed(t){var e,i=Qe(t),n=i[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function td(t,e){var i=e.clientX,n=e.clientY;return t.every(function(d){var o=d.popperRect,u=d.popperState,p=d.props,_=p.interactiveBorder,v=qs(u.placement),l=u.modifiersData.offset;if(!l)return!0;var w=v==="bottom"?l.top.y:0,C=v==="top"?l.bottom.y:0,B=v==="right"?l.left.x:0,N=v==="left"?l.right.x:0,I=o.top-n+w>_,P=n-o.bottom-C>_,k=o.left-i+B>_,z=i-o.right-N>_;return I||P||k||z})}function un(t,e,i){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(d){t[n](d,i)})}function mr(t,e){for(var i=e;i;){var n;if(t.contains(i))return!0;i=i.getRootNode==null||(n=i.getRootNode())==null?void 0:n.host}return!1}var Te={isTouch:!1},_r=0;function nd(){Te.isTouch||(Te.isTouch=!0,window.performance&&document.addEventListener("mousemove",ni))}function ni(){var t=performance.now();t-_r<20&&(Te.isTouch=!1,document.removeEventListener("mousemove",ni)),_r=t}function rd(){var t=document.activeElement;if(Qs(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function id(){document.addEventListener("touchstart",nd,je),window.addEventListener("blur",rd)}var ad=typeof window<"u"&&typeof document<"u",sd=ad?!!window.msCrypto:!1,dd={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},od={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Ee=Object.assign({appendTo:ei,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},dd,od),ud=Object.keys(Ee),cd=function(e){var i=Object.keys(e);i.forEach(function(n){Ee[n]=e[n]})};function ri(t){var e=t.plugins||[],i=e.reduce(function(n,d){var o=d.name,u=d.defaultValue;if(o){var p;n[o]=t[o]!==void 0?t[o]:(p=Ee[o])!=null?p:u}return n},{});return Object.assign({},t,i)}function ld(t,e){var i=e?Object.keys(ri(Object.assign({},Ee,{plugins:e}))):ud,n=i.reduce(function(d,o){var u=(t.getAttribute("data-tippy-"+o)||"").trim();if(!u)return d;if(o==="content")d[o]=u;else try{d[o]=JSON.parse(u)}catch{d[o]=u}return d},{});return n}function gr(t,e){var i=Object.assign({},e,{content:ti(e.content,[t])},e.ignoreAttributes?{}:ld(t,e.plugins));return i.aria=Object.assign({},Ee.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var fd=function(){return"innerHTML"};function wn(t,e){t[fd()]=e}function yr(t){var e=pt();return t===!0?e.className=Qr:(e.className=Jr,Zt(t)?e.appendChild(t):wn(e,t)),e}function vr(t,e){Zt(e.content)?(wn(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?wn(t,e.content):t.textContent=e.content)}function bn(t){var e=t.firstElementChild,i=Yt(e.children);return{box:e,content:i.find(function(n){return n.classList.contains(Zr)}),arrow:i.find(function(n){return n.classList.contains(Qr)||n.classList.contains(Jr)}),backdrop:i.find(function(n){return n.classList.contains(Fs)})}}function ii(t){var e=pt(),i=pt();i.className=Ws,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var n=pt();n.className=Zr,n.setAttribute("data-state","hidden"),vr(n,t.props),e.appendChild(i),i.appendChild(n),d(t.props,t.props);function d(o,u){var p=bn(e),_=p.box,v=p.content,l=p.arrow;u.theme?_.setAttribute("data-theme",u.theme):_.removeAttribute("data-theme"),typeof u.animation=="string"?_.setAttribute("data-animation",u.animation):_.removeAttribute("data-animation"),u.inertia?_.setAttribute("data-inertia",""):_.removeAttribute("data-inertia"),_.style.maxWidth=typeof u.maxWidth=="number"?u.maxWidth+"px":u.maxWidth,u.role?_.setAttribute("role",u.role):_.removeAttribute("role"),(o.content!==u.content||o.allowHTML!==u.allowHTML)&&vr(v,t.props),u.arrow?l?o.arrow!==u.arrow&&(_.removeChild(l),_.appendChild(yr(u.arrow))):_.appendChild(yr(u.arrow)):l&&_.removeChild(l)}return{popper:e,onUpdate:d}}ii.$$tippy=!0;var hd=1,Gt=[],cn=[];function pd(t,e){var i=gr(t,Object.assign({},Ee,ri(hr(e)))),n,d,o,u=!1,p=!1,_=!1,v=!1,l,w,C,B=[],N=lr(St,i.interactiveDebounce),I,P=hd++,k=null,z=Xs(i.plugins),L={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},r={id:P,reference:t,popper:pt(),popperInstance:k,props:i,state:L,plugins:z,clearDelayTimeouts:kt,setProps:Mt,setContent:Nt,show:ai,hide:si,hideWithInteractivity:di,enable:dt,disable:It,unmount:oi,destroy:ui};if(!i.render)return r;var s=i.render(r),a=s.popper,c=s.onUpdate;a.setAttribute("data-tippy-root",""),a.id="tippy-"+r.id,r.popper=a,t._tippy=r,a._tippy=r;var m=z.map(function(E){return E.fn(r)}),g=t.hasAttribute("aria-expanded");return Ce(),$(),T(),R("onCreate",[r]),i.showOnCreate&&st(),a.addEventListener("mouseenter",function(){r.props.interactive&&r.state.isVisible&&r.clearDelayTimeouts()}),a.addEventListener("mouseleave",function(){r.props.interactive&&r.props.trigger.indexOf("mouseenter")>=0&&O().addEventListener("mousemove",N)}),r;function h(){var E=r.props.touch;return Array.isArray(E)?E:[E,0]}function y(){return h()[0]==="hold"}function A(){var E;return!!((E=r.props.render)!=null&&E.$$tippy)}function b(){return I||t}function O(){var E=b().parentNode;return E?ed(E):document}function S(){return bn(a)}function f(E){return r.state.isMounted&&!r.state.isVisible||Te.isTouch||l&&l.type==="focus"?0:dn(r.props.delay,E?0:1,Ee.delay)}function T(E){E===void 0&&(E=!1),a.style.pointerEvents=r.props.interactive&&!E?"":"none",a.style.zIndex=""+r.props.zIndex}function R(E,H,G){if(G===void 0&&(G=!0),m.forEach(function(V){V[E]&&V[E].apply(V,H)}),G){var W;(W=r.props)[E].apply(W,H)}}function M(){var E=r.props.aria;if(E.content){var H="aria-"+E.content,G=a.id,W=Qe(r.props.triggerTarget||t);W.forEach(function(V){var ae=V.getAttribute(H);if(r.state.isVisible)V.setAttribute(H,ae?ae+" "+G:G);else{var me=ae&&ae.replace(G,"").trim();me?V.setAttribute(H,me):V.removeAttribute(H)}})}}function $(){if(!(g||!r.props.aria.expanded)){var E=Qe(r.props.triggerTarget||t);E.forEach(function(H){r.props.interactive?H.setAttribute("aria-expanded",r.state.isVisible&&H===b()?"true":"false"):H.removeAttribute("aria-expanded")})}}function D(){O().removeEventListener("mousemove",N),Gt=Gt.filter(function(E){return E!==N})}function X(E){if(!(Te.isTouch&&(_||E.type==="mousedown"))){var H=E.composedPath&&E.composedPath()[0]||E.target;if(!(r.props.interactive&&mr(a,H))){if(Qe(r.props.triggerTarget||t).some(function(G){return mr(G,H)})){if(Te.isTouch||r.state.isVisible&&r.props.trigger.indexOf("click")>=0)return}else R("onClickOutside",[r,E]);r.props.hideOnClick===!0&&(r.clearDelayTimeouts(),r.hide(),p=!0,setTimeout(function(){p=!1}),r.state.isMounted||q())}}}function Q(){_=!0}function J(){_=!1}function x(){var E=O();E.addEventListener("mousedown",X,!0),E.addEventListener("touchend",X,je),E.addEventListener("touchstart",J,je),E.addEventListener("touchmove",Q,je)}function q(){var E=O();E.removeEventListener("mousedown",X,!0),E.removeEventListener("touchend",X,je),E.removeEventListener("touchstart",J,je),E.removeEventListener("touchmove",Q,je)}function ee(E,H){Oe(E,function(){!r.state.isVisible&&a.parentNode&&a.parentNode.contains(a)&&H()})}function Z(E,H){Oe(E,H)}function Oe(E,H){var G=S().box;function W(V){V.target===G&&(un(G,"remove",W),H())}if(E===0)return H();un(G,"remove",w),un(G,"add",W),w=W}function pe(E,H,G){G===void 0&&(G=!1);var W=Qe(r.props.triggerTarget||t);W.forEach(function(V){V.addEventListener(E,H,G),B.push({node:V,eventType:E,handler:H,options:G})})}function Ce(){y()&&(pe("touchstart",ke,{passive:!0}),pe("touchend",Ct,{passive:!0})),Ys(r.props.trigger).forEach(function(E){if(E!=="manual")switch(pe(E,ke),E){case"mouseenter":pe("mouseleave",Ct);break;case"focus":pe(sd?"focusout":"blur",it);break;case"focusin":pe("focusout",it);break}})}function Ie(){B.forEach(function(E){var H=E.node,G=E.eventType,W=E.handler,V=E.options;H.removeEventListener(G,W,V)}),B=[]}function ke(E){var H,G=!1;if(!(!r.state.isEnabled||at(E)||p)){var W=((H=l)==null?void 0:H.type)==="focus";l=E,I=E.currentTarget,$(),!r.state.isVisible&&Zs(E)&&Gt.forEach(function(V){return V(E)}),E.type==="click"&&(r.props.trigger.indexOf("mouseenter")<0||u)&&r.props.hideOnClick!==!1&&r.state.isVisible?G=!0:st(E),E.type==="click"&&(u=!G),G&&!W&&Pe(E)}}function St(E){var H=E.target,G=b().contains(H)||a.contains(H);if(!(E.type==="mousemove"&&G)){var W=Me().concat(a).map(function(V){var ae,me=V._tippy,Fe=(ae=me.popperInstance)==null?void 0:ae.state;return Fe?{popperRect:V.getBoundingClientRect(),popperState:Fe,props:i}:null}).filter(Boolean);td(W,E)&&(D(),Pe(E))}}function Ct(E){var H=at(E)||r.props.trigger.indexOf("click")>=0&&u;if(!H){if(r.props.interactive){r.hideWithInteractivity(E);return}Pe(E)}}function it(E){r.props.trigger.indexOf("focusin")<0&&E.target!==b()||r.props.interactive&&E.relatedTarget&&a.contains(E.relatedTarget)||Pe(E)}function at(E){return Te.isTouch?y()!==E.type.indexOf("touch")>=0:!1}function Rt(){Bt();var E=r.props,H=E.popperOptions,G=E.placement,W=E.offset,V=E.getReferenceClientRect,ae=E.moveTransition,me=A()?bn(a).arrow:null,Fe=V?{getBoundingClientRect:V,contextElement:V.contextElement||b()}:t,zn={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Lt){var Ye=Lt.state;if(A()){var ci=S(),Jt=ci.box;["placement","reference-hidden","escaped"].forEach(function(Pt){Pt==="placement"?Jt.setAttribute("data-placement",Ye.placement):Ye.attributes.popper["data-popper-"+Pt]?Jt.setAttribute("data-"+Pt,""):Jt.removeAttribute("data-"+Pt)}),Ye.attributes.popper={}}}},De=[{name:"offset",options:{offset:W}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!ae}},zn];A()&&me&&De.push({name:"arrow",options:{element:me,padding:3}}),De.push.apply(De,H?.modifiers||[]),r.popperInstance=xs(Fe,a,Object.assign({},H,{placement:G,onFirstUpdate:C,modifiers:De}))}function Bt(){r.popperInstance&&(r.popperInstance.destroy(),r.popperInstance=null)}function Re(){var E=r.props.appendTo,H,G=b();r.props.interactive&&E===ei||E==="parent"?H=G.parentNode:H=ti(E,[G]),H.contains(a)||H.appendChild(a),r.state.isMounted=!0,Rt()}function Me(){return Yt(a.querySelectorAll("[data-tippy-root]"))}function st(E){r.clearDelayTimeouts(),E&&R("onTrigger",[r,E]),x();var H=f(!0),G=h(),W=G[0],V=G[1];Te.isTouch&&W==="hold"&&V&&(H=V),H?n=setTimeout(function(){r.show()},H):r.show()}function Pe(E){if(r.clearDelayTimeouts(),R("onUntrigger",[r,E]),!r.state.isVisible){q();return}if(!(r.props.trigger.indexOf("mouseenter")>=0&&r.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(E.type)>=0&&u)){var H=f(!1);H?d=setTimeout(function(){r.state.isVisible&&r.hide()},H):o=requestAnimationFrame(function(){r.hide()})}}function dt(){r.state.isEnabled=!0}function It(){r.hide(),r.state.isEnabled=!1}function kt(){clearTimeout(n),clearTimeout(d),cancelAnimationFrame(o)}function Mt(E){if(!r.state.isDestroyed){R("onBeforeUpdate",[r,E]),Ie();var H=r.props,G=gr(t,Object.assign({},H,hr(E),{ignoreAttributes:!0}));r.props=G,Ce(),H.interactiveDebounce!==G.interactiveDebounce&&(D(),N=lr(St,G.interactiveDebounce)),H.triggerTarget&&!G.triggerTarget?Qe(H.triggerTarget).forEach(function(W){W.removeAttribute("aria-expanded")}):G.triggerTarget&&t.removeAttribute("aria-expanded"),$(),T(),c&&c(H,G),r.popperInstance&&(Rt(),Me().forEach(function(W){requestAnimationFrame(W._tippy.popperInstance.forceUpdate)})),R("onAfterUpdate",[r,E])}}function Nt(E){r.setProps({content:E})}function ai(){var E=r.state.isVisible,H=r.state.isDestroyed,G=!r.state.isEnabled,W=Te.isTouch&&!r.props.touch,V=dn(r.props.duration,0,Ee.duration);if(!(E||H||G||W)&&!b().hasAttribute("disabled")&&(R("onShow",[r],!1),r.props.onShow(r)!==!1)){if(r.state.isVisible=!0,A()&&(a.style.visibility="visible"),T(),x(),r.state.isMounted||(a.style.transition="none"),A()){var ae=S(),me=ae.box,Fe=ae.content;on([me,Fe],0)}C=function(){var De;if(!(!r.state.isVisible||v)){if(v=!0,a.offsetHeight,a.style.transition=r.props.moveTransition,A()&&r.props.animation){var Qt=S(),Lt=Qt.box,Ye=Qt.content;on([Lt,Ye],V),pr([Lt,Ye],"visible")}M(),$(),fr(cn,r),(De=r.popperInstance)==null||De.forceUpdate(),R("onMount",[r]),r.props.animation&&A()&&Z(V,function(){r.state.isShown=!0,R("onShown",[r])})}},Re()}}function si(){var E=!r.state.isVisible,H=r.state.isDestroyed,G=!r.state.isEnabled,W=dn(r.props.duration,1,Ee.duration);if(!(E||H||G)&&(R("onHide",[r],!1),r.props.onHide(r)!==!1)){if(r.state.isVisible=!1,r.state.isShown=!1,v=!1,u=!1,A()&&(a.style.visibility="hidden"),D(),q(),T(!0),A()){var V=S(),ae=V.box,me=V.content;r.props.animation&&(on([ae,me],W),pr([ae,me],"hidden"))}M(),$(),r.props.animation?A()&&ee(W,r.unmount):r.unmount()}}function di(E){O().addEventListener("mousemove",N),fr(Gt,N),N(E)}function oi(){r.state.isVisible&&r.hide(),r.state.isMounted&&(Bt(),Me().forEach(function(E){E._tippy.unmount()}),a.parentNode&&a.parentNode.removeChild(a),cn=cn.filter(function(E){return E!==r}),r.state.isMounted=!1,R("onHidden",[r]))}function ui(){r.state.isDestroyed||(r.clearDelayTimeouts(),r.unmount(),Ie(),delete t._tippy,r.state.isDestroyed=!0,R("onDestroy",[r]))}}function At(t,e){e===void 0&&(e={});var i=Ee.plugins.concat(e.plugins||[]);id();var n=Object.assign({},e,{plugins:i}),d=Js(t),o=d.reduce(function(u,p){var _=p&&pd(p,n);return _&&u.push(_),u},[]);return Zt(t)?o[0]:o}At.defaultProps=Ee;At.setDefaultProps=cd;At.currentInput=Te;Object.assign({},Vr,{effect:function(e){var i=e.state,n={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,n.popper),i.styles=n,i.elements.arrow&&Object.assign(i.elements.arrow.style,n.arrow)}});At.setDefaultProps({render:ii});function md(t,e){const i=document.getElementById(`${t}`);i&&At(i,{content:e,theme:"battlesystem"})}function _d(){const t=new Map;t.set("viewControls","Switch to the main controls panel"),t.set("viewHistory","View message history and previous interactions"),t.set("viewHelp","Access help documentation and usage instructions"),t.set("CharacterSelect","Select which token to send messages from"),t.set("OverrideName","Override the token's display name for this message"),t.set("MessageType","Choose the style of message to display"),t.set("ViewMessage","Automatically view the message window after sending"),t.set("dialogStorage","Access the dialog storage for saved dialogs"),t.set("whisperDistance","Set the range for whisper messages used with Speech Bubbles"),t.set("talkDistance","Set the range for normal talk messages used with Speech Bubbles"),t.set("yellDistance","Set the range for yell messages used with Speech Bubbles"),t.set("PlayerSelect","Choose which player to send the message to"),t.set("closeAllPlayerWindows","Close all open theatre windows for players"),t.forEach((e,i)=>{md(i,e)})}class gd{mainWindow=document.getElementById("app");controlToggle=document.getElementById("viewControls");controlPanel=document.getElementById("controlPanel");historyToggle=document.getElementById("viewHistory");historyPanel=document.getElementById("historyPanel");helpToggle=document.getElementById("viewHelp");helpPanel=document.getElementById("helpPanel");sendButton=document.getElementById("sendMessage");closeAllPlayerWindows=document.getElementById("closeAllPlayerWindows");storageButton=document.getElementById("accessStorage");patreonContainer=document.getElementById("patreonContainer");characterSelectLabel=document.getElementById("characterLabel");characterSelect=document.getElementById("CharacterSelect");playerSelect=document.getElementById("PlayerSelect");playerSelectHolder=document.getElementById("playerSelectHolder");overrideNameInput=document.getElementById("OverrideName");messageTextarea=document.getElementById("MessageTextarea");messageTypeSelect=document.getElementById("MessageType");viewMessageBox=document.getElementById("ViewMessage");whisperDistance=document.getElementById("whisperDistance");talkDistance=document.getElementById("talkDistance");yellDistance=document.getElementById("yellDistance");messageRange=document.getElementById("messageRange");messageRangeHolder=document.getElementById("rangeSelectHolder");localStorageEnabled=!1;broadcaster=new BroadcastChannel(U.SELFCHANNEL);version;constructor(e){this.version=`THEATRE-${e}`,this.localStorageEnabled=Da(),this.localStorageEnabled||(this.storageButton.disabled=!0,this.storageButton.title="Local Storage is not available")}async StartThreatre(){this.patreonContainer?.appendChild(Pa()),this.SetupButtons(),this.SetupHelp(),this.SetupItemSelect(),this.UpdatePlayerSelect(),_d()}SetupHelp(){const i=new za.Converter().makeHtml(U.MARKDOWNHELP),n=document.getElementById("helpMarkdownContainer");n.innerHTML=i}SetupButtons(){this.messageRange.value="talk",this.messageRangeHolder.style.display="none",this.playerSelectHolder.style.display="flex",this.messageTypeSelect.onchange=()=>{this.messageTypeSelect.value==="bubble"?(this.messageRangeHolder.style.display="flex",this.playerSelectHolder.style.display="none"):(this.messageRangeHolder.style.display="none",this.playerSelectHolder.style.display="flex")},this.controlToggle.onclick=e=>{e.preventDefault(),this.controlPanel.style.display="block",this.controlToggle.classList.add("selected"),this.historyPanel.style.display="none",this.historyToggle.classList.remove("selected"),this.helpPanel.style.display="none",this.helpToggle.classList.remove("selected")},this.historyToggle.onclick=e=>{e.preventDefault(),this.controlPanel.style.display="none",this.controlToggle.classList.remove("selected"),this.historyPanel.style.display="block",this.historyToggle.classList.add("selected"),this.helpPanel.style.display="none",this.helpToggle.classList.remove("selected")},this.helpToggle.onclick=e=>{e.preventDefault(),this.controlPanel.style.display="none",this.controlToggle.classList.remove("selected"),this.historyPanel.style.display="none",this.historyToggle.classList.remove("selected"),this.helpPanel.style.display="block",this.helpToggle.classList.add("selected")},this.sendButton.onclick=async e=>{e.preventDefault(),await this.SendMessage()},this.storageButton.onclick=async e=>{e.preventDefault(),this.localStorageEnabled&&await j.modal.open({id:U.STORAGEID,url:"/submenu/storage.html",width:720,height:520,fullScreen:!1,hideBackdrop:!0,hidePaper:!0})},te.playerRole==="GM"?(this.talkDistance.onblur=async()=>{await j.scene.setMetadata({[`${U.EXTENSIONID}/talk`]:this.talkDistance.value})},this.whisperDistance.onblur=async()=>{await j.scene.setMetadata({[`${U.EXTENSIONID}/whisper`]:this.whisperDistance.value})},this.yellDistance.onblur=async()=>{await j.scene.setMetadata({[`${U.EXTENSIONID}/yell`]:this.yellDistance.value})},this.closeAllPlayerWindows.onclick=async()=>{await this.CloseAllPlayerWindows()}):(this.talkDistance.disabled=!0,this.whisperDistance.disabled=!0,this.yellDistance.disabled=!0,this.closeAllPlayerWindows.style.display="none"),this.talkDistance.value=te.sceneMetadata[`${U.EXTENSIONID}/talk`]??"5",this.whisperDistance.value=te.sceneMetadata[`${U.EXTENSIONID}/whisper`]??"1",this.yellDistance.value=te.sceneMetadata[`${U.EXTENSIONID}/yell`]??"10"}async CloseAllPlayerWindows(){if(te.playerRole!=="GM"){await j.notification.show("Only the GM can close all player windows.","ERROR");return}await j.broadcast.sendMessage(U.CLOSECHANNEL,!0),await j.notification.show("All player windows closed.","SUCCESS")}async SendMessage(){const e=this.characterSelect.value===U.SELECTEDTOKENOPTION,i=await j.player.getSelection()??[],n=e?i[0]:this.characterSelect.value;if(!n){console.log("Unable to find selected token.");return}const d=te.sceneItems.find(C=>C.id===n);if(!d||!d.image?.url){console.log("Unable to find image for Message.");return}if(d.createdUserId!==te.playerId&&te.playerRole!=="GM"){await j.notification.show("Cannot send messages for tokens you do not own.","ERROR");return}let o=this.messageTextarea.value.trim();const u=this.messageTypeSelect.value;if(!o)if(u==="story")o=d.image.url;else{console.log("No message has been entered to send.");return}const p=zr(),_=d.text?.plainText||d.name,v=this.overrideNameInput.value||_,l={Id:d.id,SenderId:te.playerId,Name:v,ImageUrl:d.image.url,TargetId:this.playerSelect.value,Type:u,Code:p};let w;if(u==="bubble"){const C={...l,Message:o,Range:this.messageRange.value};w={[`${U.EXTENSIONID}/bubbleBox`]:C}}else{const C={...l,Message:this.getFormattedMessage(o)};w={[`${U.EXTENSIONID}/dialogueBox`]:C,[`${U.EXTENSIONID}/dialogueCode`]:p}}await j.broadcast.sendMessage(U.BROADCASTCHANNEL,w),this.viewMessageBox.checked?this.broadcaster.postMessage(w):(await j.notification.show("Message sent","SUCCESS"),await te.UpdateHistoryLog(w,u==="bubble"))}getFormattedMessage(e){switch(e){case"fresh":return U.FRESHPRINCE;case"test":return U.MULTIPAGE;default:return e}}SetupItemSelect(){const e=document.getElementById("CharacterSelect");e.innerHTML="";const i=document.createElement("option");i.value=U.SELECTEDTOKENOPTION,i.text="Use Selected",e.add(i),te.sceneItems.forEach(n=>{if(n.layer==="CHARACTER"&&(n.createdUserId===te.playerId||te.playerRole==="GM")){const d=n,o=document.createElement("option");o.value=n.id,o.text=d.text?.plainText?d.text.plainText:n.name,e.add(o)}})}UpdatePlayerSelect(){const e=document.getElementById("PlayerSelect");let i=e.value;const n=document.createElement("option");n.setAttribute("value","0000");const d=document.createTextNode("Everyone");if(n.appendChild(d),e.innerHTML="",e.appendChild(n),te.party.forEach(u=>{let p=document.createElement("option");p.setAttribute("value",u.id);let _=document.createTextNode(u.name);p.appendChild(_),e.appendChild(p)}),!te.party.find(u=>u.id===i)&&i&&i!=="0000"){let u=document.createElement("option");u.setAttribute("value",i);let p=document.createTextNode("(Disconnected)");u.appendChild(p),e.appendChild(u),e.value=i,e.classList.add("glowing-text"),e.classList.add("glowing-text"),setTimeout(function(){e.classList.remove("glowing-text"),e.classList.remove("glowing-text")},5e3)}else i&&(e.value=i)}}const ge=new gd("2.21");let ut=0;class wr{static async UpdateLabel(e,i,n,d,o){let u;switch(o){case"whisper":u="blue",d=d.toLowerCase();break;case"talk":u="lightgrey";break;case"yell":u="red",d=d.toUpperCase();break}const p=await j.scene.local.getItemAttachments([e.id]);for(const y of p)y.metadata[`${U.EXTENSIONID}/id`]&&await j.scene.local.deleteItems([y.id]);const _="#242424",v=parseInt(i),l=+n/100,w=400,C=Na().fillColor("white").plainText(d).fillOpacity(1).strokeWidth(1.75).strokeColor("black").strokeOpacity(1).zIndex(ut+3).disableHit(!0).disableAutoZIndex(!0).layer("CONTROL").build(),B=zr(),N={};N[`${U.EXTENSIONID}/id`]=B,C.position={x:e.position.x,y:e.position.y},C.attachedTo=e.id,C.locked=!0,C.disableAttachmentBehavior=["ROTATION","SCALE"],C.type="TEXT",C.metadata=N,C.zIndex=1,C.text.type="PLAIN",C.text.width=w,C.text.style.fontWeight=600,C.text.style.fontSize=v,C.text.style.textAlign="CENTER",C.text.style.fontFamily="Roboto",await j.scene.local.addItems([C]);const I={x:e.grid.offset.x*e.scale.x,y:e.grid.offset.y*e.scale.y},P=await j.scene.local.getItems(y=>y.metadata[`${U.EXTENSIONID}/id`]===B),k=await j.scene.local.getItemBounds(P.map(y=>y.id)),z=e.position.y-I.y,L=I.x>k.width,r={min:e.position.x+I.x-k.width,max:e.position.x+I.x},s={min:{x:L?r.min:e.position.x,y:z-k.height},max:{x:L?r.max:e.position.x+k.width,y:z},center:{x:k.center.x,y:k.center.y-(k.height+50)},width:k.width,height:k.height},a=[],c=h(s),m=Jn().commands(c).strokeOpacity(1).strokeColor(u).fillOpacity(l).fillColor(_).zIndex(ut+1).disableAutoZIndex(!0).layer("CONTROL").disableHit(!0).disableAttachmentBehavior(["ROTATION","SCALE"]).attachedTo(P[0].id).build(),g=Jn().locked(!1).commands(U.CLOSEBUTTON).scale({x:.4,y:.4}).locked(!0).name("Close Button").metadata({[`${U.EXTENSIONID}/closeId`]:P[0].id}).position({x:s.min.x-15,y:s.min.y-15}).strokeColor("white").fillColor("#AA82E6").zIndex(ut+2).disableAutoZIndex(!0).attachedTo(P[0].id).layer("CONTROL").build();a.push(m),a.push(g),await j.scene.local.updateItems(y=>y.id===P[0].id,y=>{for(const A of y)A.position.y=s.min.y,A.position.x=s.min.x,A.zIndex=ut+3}),await j.scene.local.addItems(a),ut+=3,setTimeout(async()=>{await j.scene.local.deleteItems(P.map(y=>y.id))},6e4);function h(y){const A=y.min.x-20,b=y.max.x+20,O=y.min.y-20,S=y.max.y+20,f=Math.abs(b-A),T=f/4,R=20;return[[K.MOVE,A+R,O],[K.QUAD,A,O,A,O+R],[K.LINE,A,S-R],[K.QUAD,A,S,A+R,S],[K.LINE,A+(f/2-T),S],[K.LINE,e.position.x+I.x-I.x/2,e.position.y-I.y+I.y/4+20],[K.LINE,b-f/2,S],[K.LINE,b-R,S],[K.QUAD,b,S,b,S-R],[K.LINE,b,O+R],[K.QUAD,b,O,b-R,O],[K.LINE,A+R,O],[K.CLOSE]]}}}class F{static PLAYER="PLAYER";static PARTY="PARTY";static LOCALITEMS="LOCALITEMS";static SCENEITEMS="SCENEITEMS";static SCENEMETA="SCENEMETADATA";static SCENEGRID="SCENEGRID";static ROOMMETA="ROOMMETADATA";debouncedOnSceneItemsChange;debouncedOnLocalItemsChange;debouncedOnSceneMetadataChange;playerId;playerConnection;playerColor;playerName;playerMetadata;playerRole;party;lastParty;gridDpi;gridScale;localItems;oldSceneItems;sceneItems;sceneSelected;sceneMetadata;sceneReady;roomMetadata;theme;caches;USER_REGISTERED;historyLog;sceneMetadataHandler;localItemsHandler;sceneItemsHandler;sceneGridHandler;sceneReadyHandler;playerHandler;partyHandler;themeHandler;roomHandler;constructor(e){this.playerId="",this.playerConnection="",this.playerName="",this.playerColor="",this.playerMetadata={},this.playerRole="PLAYER",this.party=[],this.lastParty=[],this.sceneItems=[],this.oldSceneItems=[],this.sceneSelected=[],this.sceneMetadata={},this.gridDpi=0,this.gridScale=5,this.sceneReady=!1,this.theme="DARK",this.roomMetadata={},this.USER_REGISTERED=!1,this.caches=e,this.historyLog={},this.debouncedOnSceneItemsChange=sn(this.OnSceneItemsChange.bind(this),100),this.debouncedOnSceneMetadataChange=sn(this.OnSceneMetadataChanges.bind(this),100),this.debouncedOnLocalItemsChange=sn(this.OnLocalItemsChange.bind(this),100)}async InitializeCache(){this.sceneReady=await j.scene.isReady(),this.theme=await j.theme.getTheme(),tr(this.theme,document),this.caches.includes(F.PLAYER)&&(this.playerId=await j.player.getId(),this.playerConnection=await j.player.getConnectionId(),this.playerName=await j.player.getName(),this.playerColor=await j.player.getColor(),this.playerMetadata=await j.player.getMetadata(),this.playerRole=await j.player.getRole()),this.caches.includes(F.PARTY)&&(this.party=await j.party.getPlayers()),this.caches.includes(F.LOCALITEMS)&&this.sceneReady&&(this.localItems=await j.scene.local.getItems()),this.caches.includes(F.SCENEITEMS)&&this.sceneReady&&(this.sceneItems=await j.scene.items.getItems()),this.caches.includes(F.SCENEMETA)&&this.sceneReady&&(this.sceneMetadata=await j.scene.getMetadata()),this.caches.includes(F.SCENEGRID)&&this.sceneReady&&(this.gridDpi=await j.scene.grid.getDpi(),this.gridScale=(await j.scene.grid.getScale()).parsed?.multiplier??5),this.caches.includes(F.ROOMMETA)&&(this.roomMetadata=await j.room.getMetadata()),await this.CheckRegistration()}async HandleMessage(e){const i=e[`${U.EXTENSIONID}/dialogueCode`],n=e[`${U.EXTENSIONID}/dialogueBox`],d=e[`${U.EXTENSIONID}/bubbleBox`],o=n?.Type=="dialogue";if(d){const u=this.sceneItems.find(v=>v.id===d.Id),p={x:u.position.x/this.gridDpi,y:u.position.y/this.gridDpi};let _;switch(d.Range){case"whisper":_=this.sceneMetadata[`${U.EXTENSIONID}/whisper`]??1;break;case"talk":_=this.sceneMetadata[`${U.EXTENSIONID}/talk`]??5;break;case"yell":_=this.sceneMetadata[`${U.EXTENSIONID}/yell`]??10;break}if(u.createdUserId===this.playerId||this.playerRole==="GM")await wr.UpdateLabel(u,"36","80",d.Message,d.Range),await this.UpdateHistoryLog(e,!0);else{let v=!1;const l=this.sceneItems.filter(w=>w.createdUserId===this.playerId);for(const w of l){const C={x:w.position.x/this.gridDpi,y:w.position.y/this.gridDpi};ja(p,C,_)&&(v=!0)}v&&(await wr.UpdateLabel(u,"36","90",d.Message,d.Range),await this.UpdateHistoryLog(e,!0))}}else if(n){if(n.TargetId!=="0000"&&n.TargetId!==this.playerId)return;await j.popover.close(U.EXTENSIONID);const u=await j.viewport.getWidth(),p=await j.viewport.getHeight();await j.player.setMetadata(e),o?await j.popover.open({id:U.EXTENSIONID,url:`/submenu/subindex.html?code=${i}`,height:200,width:u-100,hidePaper:!0,disableClickAway:!0,anchorPosition:{top:p-250,left:50},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"LEFT"},transformOrigin:{vertical:"CENTER",horizontal:"LEFT"}}):await j.popover.open({id:U.EXTENSIONID,url:`/submenu/subindex.html?code=${i}`,height:p/2,width:u/2,hidePaper:!0,disableClickAway:!0,anchorPosition:{top:p/4,left:u/4},transformOrigin:{vertical:"TOP",horizontal:"LEFT"},anchorReference:"POSITION",anchorOrigin:{vertical:"TOP",horizontal:"LEFT"}}),await this.UpdateHistoryLog(e,!1)}}async UpdateRumbleLog(e){setTimeout(async function(){const i={Author:e.Name,SenderId:e.SenderId,Message:e.Message,Volume:"said..."};await j.broadcast.sendMessage(U.RUMBLECHANNEL,i,{destination:"LOCAL"})},1e3)}async UpdateRumbleLogForBubble(e){let i="said...";e.Range==="yell"&&(i="yells..."),e.Range==="whisper"&&(i="whispers...");const n={Author:e.Name,SenderId:e.SenderId,Message:e.Message,Volume:i};await j.broadcast.sendMessage(U.RUMBLECHANNEL,n,{destination:"LOCAL"})}async UpdateHistoryLog(e,i){const n=document.querySelector("#dialogLog");if(i){if(e[`${U.EXTENSIONID}/bubbleBox`]!==void 0){const d=e[`${U.EXTENSIONID}/bubbleBox`],o=document.createElement("li");o.innerHTML=`<div class="author">${d.Name}:</div>➤ ${d.Message.trim()}`,n.append(o);const u=e[`${U.EXTENSIONID}/bubbleBox`];await this.UpdateRumbleLogForBubble(u)}}else if(e[`${U.EXTENSIONID}/dialogueBox`]!==void 0){let d=function(p){return p.replace(/\\n/g,"<br>").replace(/\\t/g,"&emsp;&emsp;").replace(/\\T/g,"&emsp;&emsp;&emsp;&emsp;").replace(/\\'/g,"'").replace(/\\"/g,'"').replace(/\\\\/g,"\\")};const o=e[`${U.EXTENSIONID}/dialogueBox`],u=o.Message.split("::").map(d);for(let p of u){o.Type==="story"&&await La(p)&&(p=`<img class="story-image" src="${p}" onerror="this.onerror=null;this.src='/failload.png';" width="auto" height="auto">`);const _=document.createElement("li");_.innerHTML=`<div class="author">${o.Name}:</div><div class="log-message">➤ ${p}<div>`,n.append(_),await this.UpdateRumbleLog(o)}}}OpenBroadcast(){const e=new BroadcastChannel(U.SELFCHANNEL);e.onmessage=async i=>{await this.HandleMessage(i.data)},j.broadcast.onMessage(U.BROADCASTCHANNEL,async i=>{await this.HandleMessage(i.data)}),j.broadcast.onMessage(U.STORAGECHANNEL,async i=>{const n=i.data;if(n.text&&(ge.messageTextarea.value=n.text),n.overrideName&&(ge.overrideNameInput.value=n.overrideName),n.tokenId){const d=te.sceneItems.find(o=>o.id===n.tokenId);d&&(ge.characterSelect.value=d.id)}})}KillHandlers(){this.caches.includes(F.SCENEMETA)&&this.sceneMetadataHandler!==void 0&&this.sceneMetadataHandler(),this.caches.includes(F.SCENEITEMS)&&this.sceneItemsHandler!==void 0&&this.sceneItemsHandler(),this.caches.includes(F.SCENEITEMS)&&this.localItemsHandler!==void 0&&this.localItemsHandler(),this.caches.includes(F.SCENEGRID)&&this.sceneGridHandler!==void 0&&this.sceneGridHandler(),this.caches.includes(F.PLAYER)&&this.playerHandler!==void 0&&this.playerHandler(),this.caches.includes(F.PARTY)&&this.partyHandler!==void 0&&this.partyHandler(),this.caches.includes(F.ROOMMETA)&&this.roomHandler!==void 0&&this.roomHandler(),this.themeHandler!==void 0&&this.themeHandler()}SetupHandlers(){(this.sceneMetadataHandler===void 0||this.sceneMetadataHandler.length===0)&&this.caches.includes(F.SCENEMETA)&&(this.sceneMetadataHandler=j.scene.onMetadataChange(async e=>{this.sceneMetadata=e,this.debouncedOnSceneMetadataChange(e)})),(this.localItemsHandler===void 0||this.sceneItemsHandler.length===0)&&this.caches.includes(F.LOCALITEMS)&&(this.localItemsHandler=j.scene.local.onChange(async e=>{this.localItems=e,this.debouncedOnLocalItemsChange(e)})),(this.sceneItemsHandler===void 0||this.sceneItemsHandler.length===0)&&this.caches.includes(F.SCENEITEMS)&&(this.sceneItemsHandler=j.scene.items.onChange(async e=>{const i=e.filter(n=>Qn(n));this.sceneItems=i,this.debouncedOnSceneItemsChange(i)})),(this.sceneGridHandler===void 0||this.sceneGridHandler.length===0)&&this.caches.includes(F.SCENEGRID)&&(this.sceneGridHandler=j.scene.grid.onChange(async e=>{this.gridDpi=e.dpi,this.gridScale=parseInt(e.scale),await this.OnSceneGridChange(e)})),(this.playerHandler===void 0||this.playerHandler.length===0)&&this.caches.includes(F.PLAYER)&&(this.playerHandler=j.player.onChange(async e=>{this.playerName=e.name,this.playerColor=e.color,this.playerId=e.id,this.playerConnection=e.connectionId,this.playerRole=e.role,this.playerMetadata=e.metadata,await this.OnPlayerChange(e)})),(this.partyHandler===void 0||this.partyHandler.length===0)&&this.caches.includes(F.PARTY)&&(this.partyHandler=j.party.onChange(async e=>{this.party=e.filter(i=>i.id!==""),await this.OnPartyChange(e)})),(this.roomHandler===void 0||this.roomHandler.length===0)&&this.caches.includes(F.ROOMMETA)&&(this.roomHandler=j.room.onMetadataChange(async e=>{this.roomMetadata=e,await this.OnRoomMetadataChange(e)})),this.themeHandler===void 0&&(this.themeHandler=j.theme.onChange(async e=>{this.theme=e.mode,await this.OnThemeChange(e)})),this.sceneReadyHandler===void 0&&(this.sceneReadyHandler=j.scene.onReadyChange(async e=>{this.sceneReady=e,e&&(this.sceneItems=await j.scene.items.getItems(Qn),this.sceneMetadata=await j.scene.getMetadata(),this.gridDpi=await j.scene.grid.getDpi(),this.gridScale=(await j.scene.grid.getScale()).parsed?.multiplier??5),await this.OnSceneReadyChange(e)}))}async OnSceneMetadataChanges(e){if(this.playerRole!=="GM"){const i=this.sceneMetadata[`${U.EXTENSIONID}/talk`],n=this.sceneMetadata[`${U.EXTENSIONID}/whisper`],d=this.sceneMetadata[`${U.EXTENSIONID}/yell`];i&&(ge.talkDistance.value=i),n&&(ge.whisperDistance.value=n),d&&(ge.yellDistance.value=d)}}async OnLocalItemsChange(e){}async OnSceneItemsChange(e){if(this.sceneReady){const i=this.sceneItems.map(u=>u.id),n=this.oldSceneItems.map(u=>u.id),d=this.sceneItems.map(u=>u.text.plainText?u.text.plainText:u.name),o=this.oldSceneItems.map(u=>u.text.plainText?u.text.plainText:u.name);if(er(i,n)&&er(d,o))return;ge.SetupItemSelect(),this.oldSceneItems=this.sceneItems,ge.characterSelectLabel.classList.add("glowing-text"),ge.characterSelect.classList.add("glowing-text"),setTimeout(function(){ge.characterSelectLabel.classList.remove("glowing-text"),ge.characterSelect.classList.remove("glowing-text")},5e3)}}async OnSceneGridChange(e){}async OnSceneReadyChange(e){}async OnPlayerChange(e){if(e.selection?.length===1){const i=e.selection[0],n=this.localItems.find(d=>d.id===i&&d.metadata[`${U.EXTENSIONID}/closeId`]);n&&await j.scene.local.deleteItems([n.attachedTo])}}async OnPartyChange(e){ge.UpdatePlayerSelect()}async OnRoomMetadataChange(e){}async OnThemeChange(e){tr(e,document)}async CheckRegistration(){try{const e=window.location.origin.includes("localhost")?"eternaldream":"",i={owlbearid:te.playerId},n={method:"POST",headers:new Headers({"Content-Type":"application/json",Authorization:U.ANONAUTH,"x-manuel":e}),body:JSON.stringify(i)},d=await fetch(U.CHECKREGISTRATION,n);if(!d.ok){const u=await d.json();console.error("Error:",u);return}(await d.json()).Data==="OK"?(this.USER_REGISTERED=!0,console.log("Connected")):console.log("Not Registered")}catch(e){console.error("Error:",e)}}}const te=new F([F.PLAYER,F.PARTY,F.SCENEITEMS,F.SCENEMETA,F.LOCALITEMS,F.SCENEGRID]);export{te as B,U as C,j as O,tr as S,ge as T,La as a};
