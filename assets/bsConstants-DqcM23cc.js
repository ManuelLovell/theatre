(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();var v=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};class ut{constructor(e){this.messageBus=e}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return v(this,void 0,void 0,function*(){const{selection:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return e})}select(e,t){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:e,replace:t})})}deselect(e){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:e})})}getName(){return v(this,void 0,void 0,function*(){const{name:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return e})}setName(e){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:e})})}getColor(){return v(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return e})}setColor(e){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:e})})}getSyncView(){return v(this,void 0,void 0,function*(){const{syncView:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return e})}setSyncView(e){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:e})})}getId(){return v(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return e})}getRole(){return v(this,void 0,void 0,function*(){const{role:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return e})}getMetadata(){return v(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return e})}setMetadata(e){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:e})})}hasPermission(e){return v(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:s}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return s.indexOf(e)>-1})}getConnectionId(){return v(this,void 0,void 0,function*(){const{connectionId:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return e})}onChange(e){const t=s=>{e(s.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",t)}}}var I=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};class ct{constructor(e){this.messageBus=e}reset(){return I(this,void 0,void 0,function*(){const{transform:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return e})}animateTo(e){return I(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:e})})}animateToBounds(e){return I(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:e})})}getPosition(){return I(this,void 0,void 0,function*(){const{position:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return e})}setPosition(e){return I(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:e})})}getScale(){return I(this,void 0,void 0,function*(){const{scale:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return e})}setScale(e){return I(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:e})})}getWidth(){return I(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return e})}getHeight(){return I(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return e})}transformPoint(e){return I(this,void 0,void 0,function*(){const{point:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:e});return t})}inverseTransformPoint(e){return I(this,void 0,void 0,function*(){const{point:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:e});return t})}}function dt(n){return typeof n.id=="string"}var Oe={exports:{}},W=typeof Reflect=="object"?Reflect:null,Me=W&&typeof W.apply=="function"?W.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)},Q;W&&typeof W.ownKeys=="function"?Q=W.ownKeys:Object.getOwnPropertySymbols?Q=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Q=function(e){return Object.getOwnPropertyNames(e)};function lt(n){console&&console.warn&&console.warn(n)}var Ke=Number.isNaN||function(e){return e!==e};function _(){_.init.call(this)}Oe.exports=_;Oe.exports.once=yt;_.EventEmitter=_;_.prototype._events=void 0;_.prototype._eventsCount=0;_.prototype._maxListeners=void 0;var Le=10;function ie(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(_,"defaultMaxListeners",{enumerable:!0,get:function(){return Le},set:function(n){if(typeof n!="number"||n<0||Ke(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");Le=n}});_.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};_.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Ke(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function ze(n){return n._maxListeners===void 0?_.defaultMaxListeners:n._maxListeners}_.prototype.getMaxListeners=function(){return ze(this)};_.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var d=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw d.context=a,d}var l=o[e];if(l===void 0)return!1;if(typeof l=="function")Me(l,this,t);else for(var u=l.length,r=Qe(l,u),s=0;s<u;++s)Me(r[s],this,t);return!0};function Xe(n,e,t,s){var i,o,a;if(ie(t),o=n._events,o===void 0?(o=n._events=Object.create(null),n._eventsCount=0):(o.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),o=n._events),a=o[e]),a===void 0)a=o[e]=t,++n._eventsCount;else if(typeof a=="function"?a=o[e]=s?[t,a]:[a,t]:s?a.unshift(t):a.push(t),i=ze(n),i>0&&a.length>i&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=n,d.type=e,d.count=a.length,lt(d)}return n}_.prototype.addListener=function(e,t){return Xe(this,e,t,!1)};_.prototype.on=_.prototype.addListener;_.prototype.prependListener=function(e,t){return Xe(this,e,t,!0)};function ht(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ze(n,e,t){var s={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},i=ht.bind(s);return i.listener=t,s.wrapFn=i,i}_.prototype.once=function(e,t){return ie(t),this.on(e,Ze(this,e,t)),this};_.prototype.prependOnceListener=function(e,t){return ie(t),this.prependListener(e,Ze(this,e,t)),this};_.prototype.removeListener=function(e,t){var s,i,o,a,d;if(ie(t),i=this._events,i===void 0)return this;if(s=i[e],s===void 0)return this;if(s===t||s.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,s.listener||t));else if(typeof s!="function"){for(o=-1,a=s.length-1;a>=0;a--)if(s[a]===t||s[a].listener===t){d=s[a].listener,o=a;break}if(o<0)return this;o===0?s.shift():ft(s,o),s.length===1&&(i[e]=s[0]),i.removeListener!==void 0&&this.emit("removeListener",e,d||t)}return this};_.prototype.off=_.prototype.removeListener;_.prototype.removeAllListeners=function(e){var t,s,i;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var o=Object.keys(s),a;for(i=0;i<o.length;++i)a=o[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=s[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function Je(n,e,t){var s=n._events;if(s===void 0)return[];var i=s[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?_t(i):Qe(i,i.length)}_.prototype.listeners=function(e){return Je(this,e,!0)};_.prototype.rawListeners=function(e){return Je(this,e,!1)};_.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):qe.call(n,e)};_.prototype.listenerCount=qe;function qe(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}_.prototype.eventNames=function(){return this._eventsCount>0?Q(this._events):[]};function Qe(n,e){for(var t=new Array(e),s=0;s<e;++s)t[s]=n[s];return t}function ft(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function _t(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function yt(n,e){return new Promise(function(t,s){function i(a){n.removeListener(e,o),s(a)}function o(){typeof n.removeListener=="function"&&n.removeListener("error",i),t([].slice.call(arguments))}et(n,e,o,{once:!0}),e!=="error"&&Et(n,i,{once:!0})})}function Et(n,e,t){typeof n.on=="function"&&et(n,"error",e,t)}function et(n,e,t,s){if(typeof n.on=="function")s.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function i(o){s.once&&n.removeEventListener(e,i),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var pt=Oe.exports;let X;const mt=new Uint8Array(16);function Ot(){if(!X&&(X=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!X))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return X(mt)}const m=[];for(let n=0;n<256;++n)m.push((n+256).toString(16).slice(1));function vt(n,e=0){return m[n[e+0]]+m[n[e+1]]+m[n[e+2]]+m[n[e+3]]+"-"+m[n[e+4]]+m[n[e+5]]+"-"+m[n[e+6]]+m[n[e+7]]+"-"+m[n[e+8]]+m[n[e+9]]+"-"+m[n[e+10]]+m[n[e+11]]+m[n[e+12]]+m[n[e+13]]+m[n[e+14]]+m[n[e+15]]}const gt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),xe={randomUUID:gt};function tt(n,e,t){if(xe.randomUUID&&!e&&!n)return xe.randomUUID();n=n||{};const s=n.random||(n.rng||Ot)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=s[i];return e}return vt(s)}class Tt extends pt.EventEmitter{constructor(e,t){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=s=>{const i=s.data;if(s.origin===this.targetOrigin&&dt(i)){if(i.id==="OBR_READY"){this.ready=!0;const o=i.data;this.ref=o.ref,this.userId=o.userId}this.emit(i.id,i.data)}},this.send=(s,i,o)=>{var a;if(!this.ref)throw Error("Unable to send message: not ready");(a=window.parent)===null||a===void 0||a.postMessage({id:s,data:i,ref:this.ref,nonce:o},this.targetOrigin)},this.sendAsync=(s,i,o=5e3)=>{const a=`_${tt()}`;return this.send(s,i,a),Promise.race([new Promise((d,l)=>{const u=this;function r(f){u.off(`${s}_RESPONSE${a}`,r),u.off(`${s}_ERROR${a}`,c),d(f)}function c(f){u.off(`${s}_RESPONSE${a}`,r),u.off(`${s}_ERROR${a}`,c),l(f)}this.on(`${s}_RESPONSE${a}`,r),this.on(`${s}_ERROR${a}`,c)}),...o>0?[new Promise((d,l)=>window.setTimeout(()=>l(new Error(`Message ${s} took longer than ${o}ms to get a result`)),o))]:[]])},this.roomId=t,this.targetOrigin=e,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var De=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};class At{constructor(e){this.messageBus=e}show(e,t){return De(this,void 0,void 0,function*(){const{id:s}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:e,variant:t});return s})}close(e){return De(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:e})})}}var U=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};class Bt{constructor(e){this.messageBus=e}getColor(){return U(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return e})}setColor(e){return U(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:e})})}getStrokeWidth(){return U(this,void 0,void 0,function*(){const{strokeWidth:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return e})}setStrokeWidth(e){return U(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:e})})}getFilled(){return U(this,void 0,void 0,function*(){const{filled:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return e})}setFilled(e){return U(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:e})})}onChange(e){const t=s=>{e(s.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",t)}}}var g=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};class Rt{constructor(e){this.messageBus=e}getDpi(){return g(this,void 0,void 0,function*(){const{dpi:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return e})}getScale(){return g(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(e){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:e})})}getColor(){return g(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return e})}setColor(e){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:e})})}getOpacity(){return g(this,void 0,void 0,function*(){const{opacity:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return e})}setOpacity(e){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:e})})}getType(){return g(this,void 0,void 0,function*(){const{type:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return e})}setType(e){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:e})})}getLineType(){return g(this,void 0,void 0,function*(){const{lineType:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return e})}setLineType(e){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:e})})}getMeasurement(){return g(this,void 0,void 0,function*(){const{measurement:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return e})}setMeasurement(e){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:e})})}snapPosition(e,t,s,i){return g(this,void 0,void 0,function*(){const{position:o}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:e,snappingSensitivity:t,useCorners:s,useCenter:i});return o})}getDistance(e,t){return g(this,void 0,void 0,function*(){const{distance:s}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:e,to:t});return s})}onChange(e){const t=s=>{e(s.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",t)}}}var Z=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};class St{constructor(e){this.messageBus=e}undo(){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return Z(this,void 0,void 0,function*(){const{canUndo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return e})}canRedo(){return Z(this,void 0,void 0,function*(){const{canRedo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return e})}}function O(n){for(var e=arguments.length,t=Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];throw Error("[Immer] minified error nr: "+n+(t.length?" "+t.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function P(n){return!!n&&!!n[S]}function M(n){var e;return!!n&&(function(t){if(!t||typeof t!="object")return!1;var s=Object.getPrototypeOf(t);if(s===null)return!0;var i=Object.hasOwnProperty.call(s,"constructor")&&s.constructor;return i===Object||typeof i=="function"&&Function.toString.call(i)===xt}(n)||Array.isArray(n)||!!n[F]||!!(!((e=n.constructor)===null||e===void 0)&&e[F])||oe(n)||re(n))}function j(n,e,t){t===void 0&&(t=!1),L(n)===0?(t?Object.keys:Se)(n).forEach(function(s){t&&typeof s=="symbol"||e(s,n[s],n)}):n.forEach(function(s,i){return e(i,s,n)})}function L(n){var e=n[S];return e?e.i>3?e.i-4:e.i:Array.isArray(n)?1:oe(n)?2:re(n)?3:0}function K(n,e){return L(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function ee(n,e){return L(n)===2?n.get(e):n[e]}function nt(n,e,t){var s=L(n);s===2?n.set(e,t):s===3?n.add(t):n[e]=t}function wt(n,e){return n===e?n!==0||1/n==1/e:n!=n&&e!=e}function oe(n){return Mt&&n instanceof Map}function re(n){return Lt&&n instanceof Set}function x(n){return n.o||n.t}function ve(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var e=Dt(n);delete e[S];for(var t=Se(e),s=0;s<t.length;s++){var i=t[s],o=e[i];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(e[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:n[i]})}return Object.create(Object.getPrototypeOf(n),e)}function ge(n,e){return e===void 0&&(e=!1),Te(n)||P(n)||!M(n)||(L(n)>1&&(n.set=n.add=n.clear=n.delete=Ct),Object.freeze(n),e&&j(n,function(t,s){return ge(s,!0)},!0)),n}function Ct(){O(2)}function Te(n){return n==null||typeof n!="object"||Object.isFrozen(n)}function b(n){var e=Ee[n];return e||O(18,n),e}function It(n,e){Ee[n]||(Ee[n]=e)}function Pe(){return z}function ae(n,e){e&&(b("Patches"),n.u=[],n.s=[],n.v=e)}function te(n){fe(n),n.p.forEach(Nt),n.p=null}function fe(n){n===z&&(z=n.l)}function Ge(n){return z={p:[],l:z,h:n,m:!0,_:0}}function Nt(n){var e=n[S];e.i===0||e.i===1?e.j():e.g=!0}function ue(n,e){e._=e.p.length;var t=e.p[0],s=n!==void 0&&n!==t;return e.h.O||b("ES5").S(e,n,s),s?(t[S].P&&(te(e),O(4)),M(n)&&(n=ne(e,n),e.l||se(e,n)),e.u&&b("Patches").M(t[S].t,n,e.u,e.s)):n=ne(e,t,[]),te(e),e.u&&e.v(e.u,e.s),n!==Re?n:void 0}function ne(n,e,t){if(Te(e))return e;var s=e[S];if(!s)return j(e,function(d,l){return Ue(n,s,e,d,l,t)},!0),e;if(s.A!==n)return e;if(!s.P)return se(n,s.t,!0),s.t;if(!s.I){s.I=!0,s.A._--;var i=s.i===4||s.i===5?s.o=ve(s.k):s.o,o=i,a=!1;s.i===3&&(o=new Set(i),i.clear(),a=!0),j(o,function(d,l){return Ue(n,s,i,d,l,t,a)}),se(n,i,!1),t&&n.u&&b("Patches").N(s,t,n.u,n.s)}return s.o}function Ue(n,e,t,s,i,o,a){if(P(i)){var d=ne(n,i,o&&e&&e.i!==3&&!K(e.R,s)?o.concat(s):void 0);if(nt(t,s,d),!P(d))return;n.m=!1}else a&&t.add(i);if(M(i)&&!Te(i)){if(!n.h.D&&n._<1)return;ne(n,i),e&&e.A.l||se(n,i)}}function se(n,e,t){t===void 0&&(t=!1),!n.l&&n.h.D&&n.m&&ge(e,t)}function ce(n,e){var t=n[S];return(t?x(t):n)[e]}function ke(n,e){if(e in n)for(var t=Object.getPrototypeOf(n);t;){var s=Object.getOwnPropertyDescriptor(t,e);if(s)return s;t=Object.getPrototypeOf(t)}}function _e(n){n.P||(n.P=!0,n.l&&_e(n.l))}function de(n){n.o||(n.o=ve(n.t))}function ye(n,e,t){var s=oe(e)?b("MapSet").F(e,t):re(e)?b("MapSet").T(e,t):n.O?function(i,o){var a=Array.isArray(i),d={i:a?1:0,A:o?o.A:Pe(),P:!1,I:!1,R:{},l:o,t:i,k:null,o:null,j:null,C:!1},l=d,u=pe;a&&(l=[d],u=Y);var r=Proxy.revocable(l,u),c=r.revoke,f=r.proxy;return d.k=f,d.j=c,f}(e,t):b("ES5").J(e,t);return(t?t.A:Pe()).p.push(s),s}function bt(n){return P(n)||O(22,n),function e(t){if(!M(t))return t;var s,i=t[S],o=L(t);if(i){if(!i.P&&(i.i<4||!b("ES5").K(i)))return i.t;i.I=!0,s=Ve(t,o),i.I=!1}else s=Ve(t,o);return j(s,function(a,d){i&&ee(i.t,a)===d||nt(s,a,e(d))}),o===3?new Set(s):s}(n)}function Ve(n,e){switch(e){case 2:return new Map(n);case 3:return Array.from(n)}return ve(n)}function Ae(){function n(s){if(!M(s))return s;if(Array.isArray(s))return s.map(n);if(oe(s))return new Map(Array.from(s.entries()).map(function(a){return[a[0],n(a[1])]}));if(re(s))return new Set(Array.from(s).map(n));var i=Object.create(Object.getPrototypeOf(s));for(var o in s)i[o]=n(s[o]);return K(s,F)&&(i[F]=s[F]),i}function e(s){return P(s)?n(s):s}var t="add";It("Patches",{$:function(s,i){return i.forEach(function(o){for(var a=o.path,d=o.op,l=s,u=0;u<a.length-1;u++){var r=L(l),c=a[u];typeof c!="string"&&typeof c!="number"&&(c=""+c),r!==0&&r!==1||c!=="__proto__"&&c!=="constructor"||O(24),typeof l=="function"&&c==="prototype"&&O(24),typeof(l=ee(l,c))!="object"&&O(15,a.join("/"))}var f=L(l),h=n(o.value),y=a[a.length-1];switch(d){case"replace":switch(f){case 2:return l.set(y,h);case 3:O(16);default:return l[y]=h}case t:switch(f){case 1:return y==="-"?l.push(h):l.splice(y,0,h);case 2:return l.set(y,h);case 3:return l.add(h);default:return l[y]=h}case"remove":switch(f){case 1:return l.splice(y,1);case 2:return l.delete(y);case 3:return l.delete(o.value);default:return delete l[y]}default:O(17,d)}}),s},N:function(s,i,o,a){switch(s.i){case 0:case 4:case 2:return function(d,l,u,r){var c=d.t,f=d.o;j(d.R,function(h,y){var E=ee(c,h),A=ee(f,h),B=y?K(c,h)?"replace":t:"remove";if(E!==A||B!=="replace"){var R=l.concat(h);u.push(B==="remove"?{op:B,path:R}:{op:B,path:R,value:A}),r.push(B===t?{op:"remove",path:R}:B==="remove"?{op:t,path:R,value:e(E)}:{op:"replace",path:R,value:e(E)})}})}(s,i,o,a);case 5:case 1:return function(d,l,u,r){var c=d.t,f=d.R,h=d.o;if(h.length<c.length){var y=[h,c];c=y[0],h=y[1];var E=[r,u];u=E[0],r=E[1]}for(var A=0;A<c.length;A++)if(f[A]&&h[A]!==c[A]){var B=l.concat([A]);u.push({op:"replace",path:B,value:e(h[A])}),r.push({op:"replace",path:B,value:e(c[A])})}for(var R=c.length;R<h.length;R++){var G=l.concat([R]);u.push({op:t,path:G,value:e(h[R])})}c.length<h.length&&r.push({op:"replace",path:l.concat(["length"]),value:c.length})}(s,i,o,a);case 3:return function(d,l,u,r){var c=d.t,f=d.o,h=0;c.forEach(function(y){if(!f.has(y)){var E=l.concat([h]);u.push({op:"remove",path:E,value:y}),r.unshift({op:t,path:E,value:y})}h++}),h=0,f.forEach(function(y){if(!c.has(y)){var E=l.concat([h]);u.push({op:t,path:E,value:y}),r.unshift({op:"remove",path:E,value:y})}h++})}(s,i,o,a)}},M:function(s,i,o,a){o.push({op:"replace",path:[],value:i===Re?void 0:i}),a.push({op:"replace",path:[],value:s})}})}var He,z,Be=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Mt=typeof Map<"u",Lt=typeof Set<"u",We=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Re=Be?Symbol.for("immer-nothing"):((He={})["immer-nothing"]=!0,He),F=Be?Symbol.for("immer-draftable"):"__$immer_draftable",S=Be?Symbol.for("immer-state"):"__$immer_state",xt=""+Object.prototype.constructor,Se=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,Dt=Object.getOwnPropertyDescriptors||function(n){var e={};return Se(n).forEach(function(t){e[t]=Object.getOwnPropertyDescriptor(n,t)}),e},Ee={},pe={get:function(n,e){if(e===S)return n;var t=x(n);if(!K(t,e))return function(i,o,a){var d,l=ke(o,a);return l?"value"in l?l.value:(d=l.get)===null||d===void 0?void 0:d.call(i.k):void 0}(n,t,e);var s=t[e];return n.I||!M(s)?s:s===ce(n.t,e)?(de(n),n.o[e]=ye(n.A.h,s,n)):s},has:function(n,e){return e in x(n)},ownKeys:function(n){return Reflect.ownKeys(x(n))},set:function(n,e,t){var s=ke(x(n),e);if(s?.set)return s.set.call(n.k,t),!0;if(!n.P){var i=ce(x(n),e),o=i?.[S];if(o&&o.t===t)return n.o[e]=t,n.R[e]=!1,!0;if(wt(t,i)&&(t!==void 0||K(n.t,e)))return!0;de(n),_e(n)}return n.o[e]===t&&(t!==void 0||e in n.o)||Number.isNaN(t)&&Number.isNaN(n.o[e])||(n.o[e]=t,n.R[e]=!0),!0},deleteProperty:function(n,e){return ce(n.t,e)!==void 0||e in n.t?(n.R[e]=!1,de(n),_e(n)):delete n.R[e],n.o&&delete n.o[e],!0},getOwnPropertyDescriptor:function(n,e){var t=x(n),s=Reflect.getOwnPropertyDescriptor(t,e);return s&&{writable:!0,configurable:n.i!==1||e!=="length",enumerable:s.enumerable,value:t[e]}},defineProperty:function(){O(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){O(12)}},Y={};j(pe,function(n,e){Y[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),Y.deleteProperty=function(n,e){return Y.set.call(this,n,e,void 0)},Y.set=function(n,e,t){return pe.set.call(this,n[0],e,t,n[0])};var Pt=function(){function n(t){var s=this;this.O=We,this.D=!0,this.produce=function(i,o,a){if(typeof i=="function"&&typeof o!="function"){var d=o;o=i;var l=s;return function(E){var A=this;E===void 0&&(E=d);for(var B=arguments.length,R=Array(B>1?B-1:0),G=1;G<B;G++)R[G-1]=arguments[G];return l.produce(E,function(at){var be;return(be=o).call.apply(be,[A,at].concat(R))})}}var u;if(typeof o!="function"&&O(6),a!==void 0&&typeof a!="function"&&O(7),M(i)){var r=Ge(s),c=ye(s,i,void 0),f=!0;try{u=o(c),f=!1}finally{f?te(r):fe(r)}return typeof Promise<"u"&&u instanceof Promise?u.then(function(E){return ae(r,a),ue(E,r)},function(E){throw te(r),E}):(ae(r,a),ue(u,r))}if(!i||typeof i!="object"){if((u=o(i))===void 0&&(u=i),u===Re&&(u=void 0),s.D&&ge(u,!0),a){var h=[],y=[];b("Patches").M(i,u,h,y),a(h,y)}return u}O(21,i)},this.produceWithPatches=function(i,o){if(typeof i=="function")return function(u){for(var r=arguments.length,c=Array(r>1?r-1:0),f=1;f<r;f++)c[f-1]=arguments[f];return s.produceWithPatches(u,function(h){return i.apply(void 0,[h].concat(c))})};var a,d,l=s.produce(i,o,function(u,r){a=u,d=r});return typeof Promise<"u"&&l instanceof Promise?l.then(function(u){return[u,a,d]}):[l,a,d]},typeof t?.useProxies=="boolean"&&this.setUseProxies(t.useProxies),typeof t?.autoFreeze=="boolean"&&this.setAutoFreeze(t.autoFreeze)}var e=n.prototype;return e.createDraft=function(t){M(t)||O(8),P(t)&&(t=bt(t));var s=Ge(this),i=ye(this,t,void 0);return i[S].C=!0,fe(s),i},e.finishDraft=function(t,s){var i=t&&t[S],o=i.A;return ae(o,s),ue(void 0,o)},e.setAutoFreeze=function(t){this.D=t},e.setUseProxies=function(t){t&&!We&&O(20),this.O=t},e.applyPatches=function(t,s){var i;for(i=s.length-1;i>=0;i--){var o=s[i];if(o.path.length===0&&o.op==="replace"){t=o.value;break}}i>-1&&(s=s.slice(i+1));var a=b("Patches").$;return P(t)?a(t,s):this.produce(t,function(d){return a(d,s)})},n}(),w=new Pt;w.produce;var we=w.produceWithPatches.bind(w);w.setAutoFreeze.bind(w);w.setUseProxies.bind(w);w.applyPatches.bind(w);w.createDraft.bind(w);w.finishDraft.bind(w);var k=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};Ae();class Gt{constructor(e){this.messageBus=e}getItems(e){return k(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:e});return t}else if(e){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return t.filter(e)}else{const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return t}})}isItemArray(e){return Array.isArray(e)&&e.every(t=>typeof t!="string")}updateItems(e,t,s=!0){return k(this,void 0,void 0,function*(){let i;this.isItemArray(e)?i=e:i=yield this.getItems(e);const[o,a]=we(i,t),d=o.map(u=>({id:u.id,type:u.type}));for(const u of a){const[r,c]=u.path;typeof r=="number"&&typeof c=="string"&&(d[r][c]=o[r][c])}const l=d.filter(u=>Object.keys(u).length>2);l.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:l,updateAttachments:s}))})}addItems(e){return k(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:e})})}deleteItems(e){return k(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return k(this,void 0,void 0,function*(){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:e});return t})}getItemBounds(e){return k(this,void 0,void 0,function*(){const{bounds:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:e});return t})}onChange(e){const t=s=>{e(s.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",t)}}}var V=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};Ae();class Ut{constructor(e){this.messageBus=e}getItems(e){return V(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:e});return t}else if(e){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return t.filter(e)}else{const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return t}})}updateItems(e,t,s,i=!0){return V(this,void 0,void 0,function*(){const o=yield this.getItems(e),[a,d]=we(o,t),l=a.map(r=>({id:r.id,type:r.type}));for(const r of d){const[c,f]=r.path;typeof c=="number"&&typeof f=="string"&&(l[c][f]=a[c][f])}const u=l.filter(r=>Object.keys(r).length>2);u.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:u,fastUpdate:s,updateAttachments:i}))})}addItems(e){return V(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:e})})}deleteItems(e){return V(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return V(this,void 0,void 0,function*(){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:e});return t})}getItemBounds(e){return V(this,void 0,void 0,function*(){const{bounds:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:e});return t})}onChange(e){const t=s=>{e(s.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",t)}}}var le=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};class kt{constructor(e){this.messageBus=e,this.grid=new Rt(e),this.fog=new Bt(e),this.history=new St(e),this.items=new Gt(e),this.local=new Ut(e)}isReady(){return le(this,void 0,void 0,function*(){const{ready:e}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return e})}onReadyChange(e){const t=s=>{e(s.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",t)}}getMetadata(){return le(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return e})}setMetadata(e){return le(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:e})})}onMetadataChange(e){const t=s=>{e(s.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",t)}}}function st(n){return n.startsWith("http")?n:`${window.location.origin}${n}`}function $(n){return n.map(e=>Object.assign(Object.assign({},e),{icon:st(e.icon)}))}function Ce(n){return Object.assign(Object.assign({},n),{url:st(n.url)})}var je=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};class Vt{constructor(e){this.contextMenus={},this.handleClick=t=>{var s;const i=this.contextMenus[t.id];i&&((s=i.onClick)===null||s===void 0||s.call(i,t.context,t.elementId))},this.messageBus=e,e.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(e){return je(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:e.id,shortcut:e.shortcut,icons:$(e.icons),embed:e.embed&&Ce(e.embed)}),this.contextMenus[e.id]=e})}remove(e){return je(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:e}),delete this.contextMenus[e]})}}var N=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};class Ht{constructor(e){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=t=>{const s=this.tools[t.id];if(s)if(s.onClick){const i=s.onClick(t.context,t.elementId);Promise.resolve(i).then(o=>{o&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:t.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:t.id})},this.handleToolActionClick=t=>{var s;const i=this.toolActions[t.id];i&&((s=i.onClick)===null||s===void 0||s.call(i,t.context,t.elementId))},this.handleToolModeClick=t=>{const s=this.toolModes[t.id];if(s)if(s.onClick){const i=s.onClick(t.context,t.elementId);Promise.resolve(i).then(o=>{o&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:t.context.activeTool,modeId:t.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:t.context.activeTool,modeId:t.id})},this.handleToolModeToolClick=t=>{const s=this.toolModes[t.id];if(s)if(s.onToolClick){const i=s.onToolClick(t.context,t.event);Promise.resolve(i).then(o=>{o&&t.event.target&&!t.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})})}else t.event.target&&!t.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})},this.handleToolModeToolDoubleClick=t=>{const s=this.toolModes[t.id];if(s)if(s.onToolDoubleClick){const i=s.onToolDoubleClick(t.context,t.event);Promise.resolve(i).then(o=>{o&&t.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})})}else t.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})},this.handleToolModeToolDown=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onToolDown)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeToolMove=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onToolMove)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeToolUp=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onToolUp)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeToolDragStart=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onToolDragStart)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeToolDragMove=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onToolDragMove)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeToolDragEnd=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onToolDragEnd)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeToolDragCancel=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onToolDragCancel)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeKeyDown=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onKeyDown)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeKeyUp=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onKeyUp)===null||s===void 0||s.call(i,t.context,t.event))},this.handleToolModeActivate=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onActivate)===null||s===void 0||s.call(i,t.context))},this.handleToolModeDeactivate=t=>{var s;const i=this.toolModes[t.id];i&&((s=i.onDeactivate)===null||s===void 0||s.call(i,t.context))},this.messageBus=e,e.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),e.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),e.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),e.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),e.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),e.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),e.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),e.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(e){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:e.id,shortcut:e.shortcut,defaultMode:e.defaultMode,defaultMetadata:e.defaultMetadata,icons:$(e.icons),disabled:e.disabled}),this.tools[e.id]=e})}remove(e){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:e}),delete this.tools[e]})}activateTool(e){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:e})})}getMetadata(e){return N(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:e});return t})}setMetadata(e,t){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:e,update:t})})}createAction(e){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:e.id,shortcut:e.shortcut,icons:$(e.icons),disabled:e.disabled}),this.toolActions[e.id]=e})}removeAction(e){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:e}),delete this.tools[e]})}createMode(e){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:e.id,shortcut:e.shortcut,icons:$(e.icons),preventDrag:e.preventDrag,disabled:e.disabled,cursors:e.cursors}),this.toolModes[e.id]=e})}removeMode(e){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:e}),delete this.tools[e]})}activateMode(e,t){return N(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:e,modeId:t})})}}var H=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};class Wt{constructor(e){this.messageBus=e}open(e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},Ce(e)))})}close(e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:e})})}getWidth(e){return H(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:e});return t})}setWidth(e,t){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:e,width:t})})}getHeight(e){return H(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:e});return t})}setHeight(e,t){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:e,height:t})})}}var Ye=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};class jt{constructor(e){this.messageBus=e}open(e){return Ye(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},Ce(e)))})}close(e){return Ye(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:e})})}}var T=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};class Yt{constructor(e){this.messageBus=e}getWidth(){return T(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return e})}setWidth(e){return T(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:e})})}getHeight(){return T(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return e})}setHeight(e){return T(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:e})})}getBadgeText(){return T(this,void 0,void 0,function*(){const{badgeText:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return e})}setBadgeText(e){return T(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:e})})}getBadgeBackgroundColor(){return T(this,void 0,void 0,function*(){const{badgeBackgroundColor:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return e})}setBadgeBackgroundColor(e){return T(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:e})})}getIcon(){return T(this,void 0,void 0,function*(){const{icon:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return e})}setIcon(e){return T(this,void 0,void 0,function*(){const t=$([{icon:e}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:t[0].icon})})}getTitle(){return T(this,void 0,void 0,function*(){const{title:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return e})}setTitle(e){return T(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:e})})}isOpen(){return T(this,void 0,void 0,function*(){const{isOpen:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return e})}open(){return T(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return T(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(e){const t=s=>{e(s.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",t)}}}var Ft=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};Ae();class $t{constructor(e){this.messageBus=e}startItemInteraction(e,t=!0){return Ft(this,void 0,void 0,function*(){const{id:s}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:e,updateAttachments:t});let i=e;return[d=>{const[l,u]=we(i,d);return i=l,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:s,patches:u}),l},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:s})}]})}}var Kt=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};class zt{constructor(e){this.messageBus=e}getPlayers(){return Kt(this,void 0,void 0,function*(){const{players:e}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return e})}onChange(e){const t=s=>{e(s.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",t)}}}var he=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};class Xt{constructor(e){this.messageBus=e}get id(){return this.messageBus.roomId}getPermissions(){return he(this,void 0,void 0,function*(){const{permissions:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return e})}getMetadata(){return he(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return e})}setMetadata(e){return he(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:e})})}onMetadataChange(e){const t=s=>{e(s.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",t)}}onPermissionsChange(e){const t=s=>{e(s.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",t)}}}var Zt=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};class Jt{constructor(e){this.messageBus=e}getTheme(){return Zt(this,void 0,void 0,function*(){const{theme:e}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return e})}onChange(e){const t=s=>{e(s.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",t)}}}var J=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};class qt{constructor(e){this.messageBus=e}uploadImages(e,t){return J(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_IMAGES",{images:e,typeHint:t})})}uploadScenes(e,t){return J(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_SCENES",{scenes:e,disableShowScenes:t})})}downloadImages(e,t,s){return J(this,void 0,void 0,function*(){const{images:i}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_IMAGES",{multiple:e,defaultSearch:t,typeHint:s},-1);return i})}downloadScenes(e,t){return J(this,void 0,void 0,function*(){const{scenes:s}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_SCENES",{multiple:e,defaultSearch:t},-1);return s})}}var Qt=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function d(r){try{u(s.next(r))}catch(c){a(c)}}function l(r){try{u(s.throw(r))}catch(c){a(c)}}function u(r){r.done?o(r.value):i(r.value).then(d,l)}u((s=s.apply(n,e||[])).next())})};class en{constructor(e){this.messageBus=e}sendMessage(e,t){return Qt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_BROADCAST_SEND_MESSAGE",{channel:e,data:t})})}onMessage(e,t){return this.messageBus.send("OBR_BROADCAST_SUBSCRIBE",{channel:e}),this.messageBus.on(`OBR_BROADCAST_MESSAGE_${e}`,t),()=>{this.messageBus.send("OBR_BROADCAST_UNSUBSCRIBE",{channel:e}),this.messageBus.off(`OBR_BROADCAST_MESSAGE_${e}`,t)}}}class it{constructor(e){this._item={createdUserId:e.id,id:tt(),name:"Item",zIndex:Date.now(),lastModified:new Date().toISOString(),lastModifiedUserId:e.id,locked:!1,metadata:{},position:{x:0,y:0},rotation:0,scale:{x:1,y:1},type:"ITEM",visible:!0,layer:"POPOVER"}}createdUserId(e){return this._item.createdUserId=e,this.self()}id(e){return this._item.id=e,this.self()}name(e){return this._item.name=e,this.self()}description(e){return this._item.description=e,this.self()}lastModified(e){return this._item.lastModified=e,this.self()}zIndex(e){return this._item.zIndex=e,this.self()}lastModifiedUserId(e){return this._item.lastModifiedUserId=e,this.self()}locked(e){return this._item.locked=e,this.self()}metadata(e){return this._item.metadata=e,this.self()}position(e){return this._item.position=e,this.self()}rotation(e){return this._item.rotation=e,this.self()}scale(e){return this._item.scale=e,this.self()}visible(e){return this._item.visible=e,this.self()}attachedTo(e){return this._item.attachedTo=e,this.self()}layer(e){return this._item.layer=e,this.self()}disableHit(e){return this._item.disableHit=e,this.self()}disableAutoZIndex(e){return this._item.disableAutoZIndex=e,this.self()}disableAttachmentBehavior(e){return this._item.disableAttachmentBehavior=e,this.self()}self(){return this}}class tn extends it{constructor(e){super(e),this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:0,fontFamily:"Roboto",fontSize:16,fontWeight:400,textAlign:"LEFT",textAlignVertical:"TOP",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"RICH",width:"AUTO",height:"AUTO"},this._item.layer="TEXT",this._item.name="Text"}text(e){return this._text=e,this.self()}width(e){return this._text.width=e,this.self()}height(e){return this._text.height=e,this.self()}richText(e){return this._text.richText=e,this.self()}plainText(e){return this._text.plainText=e,this.self()}textType(e){return this._text.type=e,this.self()}padding(e){return this._text.style.padding=e,this.self()}fontFamily(e){return this._text.style.fontFamily=e,this.self()}fontSize(e){return this._text.style.fontSize=e,this.self()}fontWeight(e){return this._text.style.fontWeight=e,this.self()}textAlign(e){return this._text.style.textAlign=e,this.self()}textAlignVertical(e){return this._text.style.textAlignVertical=e,this.self()}fillColor(e){return this._text.style.fillColor=e,this.self()}fillOpacity(e){return this._text.style.fillOpacity=e,this.self()}strokeColor(e){return this._text.style.strokeColor=e,this.self()}strokeOpacity(e){return this._text.style.strokeOpacity=e,this.self()}strokeWidth(e){return this._text.style.strokeWidth=e,this.self()}lineHeight(e){return this._text.style.lineHeight=e,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"TEXT",text:this._text})}}class nn extends it{constructor(e){super(e),this._commands=[],this._fillRule="nonzero",this._style={fillColor:"black",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:5,strokeDash:[]},this._item.name="Path",this._item.layer="DRAWING"}commands(e){return this._commands=e,this.self()}fillRule(e){return this._fillRule=e,this.self()}style(e){return this._style=e,this.self()}fillColor(e){return this._style.fillColor=e,this.self()}fillOpacity(e){return this._style.fillOpacity=e,this.self()}strokeColor(e){return this._style.strokeColor=e,this.self()}strokeOpacity(e){return this._style.strokeOpacity=e,this.self()}strokeWidth(e){return this._style.strokeWidth=e,this.self()}strokeDash(e){return this._style.strokeDash=e,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"PATH",commands:this._commands,fillRule:this._fillRule,style:this._style})}}const sn=typeof atob=="function",Ie=typeof Buffer=="function",Fe=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const on="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",rn=Array.prototype.slice.call(on),q=(n=>{let e={};return n.forEach((t,s)=>e[t]=s),e})(rn),an=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,D=String.fromCharCode.bind(String),$e=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):n=>new Uint8Array(Array.prototype.slice.call(n,0)),ot=n=>n.replace(/[^A-Za-z0-9\+\/]/g,""),un=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,cn=n=>{switch(n.length){case 4:var e=(7&n.charCodeAt(0))<<18|(63&n.charCodeAt(1))<<12|(63&n.charCodeAt(2))<<6|63&n.charCodeAt(3),t=e-65536;return D((t>>>10)+55296)+D((t&1023)+56320);case 3:return D((15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2));default:return D((31&n.charCodeAt(0))<<6|63&n.charCodeAt(1))}},dn=n=>n.replace(un,cn),ln=n=>{if(n=n.replace(/\s+/g,""),!an.test(n))throw new TypeError("malformed base64.");n+="==".slice(2-(n.length&3));let e,t="",s,i;for(let o=0;o<n.length;)e=q[n.charAt(o++)]<<18|q[n.charAt(o++)]<<12|(s=q[n.charAt(o++)])<<6|(i=q[n.charAt(o++)]),t+=s===64?D(e>>16&255):i===64?D(e>>16&255,e>>8&255):D(e>>16&255,e>>8&255,e&255);return t},rt=sn?n=>atob(ot(n)):Ie?n=>Buffer.from(n,"base64").toString("binary"):ln,hn=Ie?n=>$e(Buffer.from(n,"base64")):n=>$e(rt(n).split("").map(e=>e.charCodeAt(0))),fn=Ie?n=>Buffer.from(n,"base64").toString("utf8"):Fe?n=>Fe.decode(hn(n)):n=>dn(rt(n)),_n=n=>ot(n.replace(/[-_]/g,e=>e=="-"?"+":"/")),yn=n=>fn(_n(n));function En(){const e=new URLSearchParams(window.location.search).get("obrref");let t="",s="";if(e){const o=yn(e).split(" ");o.length===2&&(t=o[0],s=o[1])}return{origin:t,roomId:s}}var C;(function(n){n[n.MOVE=0]="MOVE",n[n.LINE=1]="LINE",n[n.QUAD=2]="QUAD",n[n.CONIC=3]="CONIC",n[n.CUBIC=4]="CUBIC",n[n.CLOSE=5]="CLOSE"})(C||(C={}));const me=En(),p=new Tt(me.origin,me.roomId),pn=new ct(p),Ne=new ut(p),mn=new zt(p),On=new At(p),vn=new kt(p),gn=new Vt(p),Tn=new Ht(p),An=new Wt(p),Bn=new jt(p),Rn=new Yt(p),Sn=new $t(p),wn=new Xt(p),Cn=new Jt(p),In=new qt(p),Nn=new en(p),bn={onReady:n=>{p.ready?n():p.once("OBR_READY",()=>n())},get isReady(){return p.ready},viewport:pn,player:Ne,party:mn,notification:On,scene:vn,contextMenu:gn,tool:Tn,popover:An,modal:Bn,action:Rn,interaction:Sn,room:wn,theme:Cn,assets:In,broadcast:Nn,isAvailable:!!me.origin};function Mn(){return new tn(Ne)}function Ln(){return new nn(Ne)}class xn{static EXTENSIONID="com.battle-system.theatre";static EXTENSIONWHATSNEW="com.battle-system.theatre-whatsnew";static BROADCASTCHANNEL="com.battle-system.theatre-broadcast";static SELFCHANNEL="com.battle-system.threatre-self";static ANONAUTH="Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0";static CLOSEBUTTON=[[C.MOVE,0,-50],[C.QUAD,50,-50,50,0],[C.QUAD,50,50,0,50],[C.QUAD,-50,50,-50,0],[C.QUAD,-50,-50,0,-50],[C.MOVE,-35,-35],[C.LINE,35,35],[C.MOVE,-35,35],[C.LINE,35,-35],[C.CLOSE]];static MULTIPAGE=`What is Lorem Ipsum?
        Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged.
        ::
        Why are you doing this?
        Because I hate writing filler text.
        `;static LOGHTML=`<b>LOG HISTORY</b><div class="full-container">
        <ul id="dialogLog">
        </ul>
        </div>`;static FRESHPRINCE=`Now, this is a story all about how
        My life got flipped-turned upside down
        And I'd like to take a minute
        Just sit right there
        I'll tell you how I became the prince of a town called Bel-Air
        In West Philadelphia born and raised
        On the playground was where I spent most of my days
        Chillin' out, maxin', relaxin', all cool
        And all shootin' some b-ball outside of the school
        When a couple of guys who were up to no good
        Started making trouble in my neighborhood
        I got in one little fight and my mom got scared
        She said, "You're movin' with your auntie and uncle in Bel-Air"
        I begged and pleaded with her day after day
        But she packed my suitcase and sent me on my way
        She gave me a kiss and then she gave me my ticket
        I put my Walkman on and said, "I might as well kick it"
        First class, yo this is bad`;static MARKDOWNHELP=`
<a id="theatre" name="theatre"></a>
<!-- TABLE OF CONTENTS -->
<details open>
<summary>Table of Contents</summary>
<ol>
<li><a href="#getting-started">Getting Started</a>
<li><a href="#theatre-ui">Theatre UI</a>
<ul>
<li><a href="#ui-token">Token Selector</a></li>
<li><a href="#ui-override">Override Input</a></li>
<li><a href="#ui-style">Style Selector</a></li>
<li><a href="#ui-speech">Speech Range Inputs (Whisper/Talk/Yell)</a></li>
<li><a href="#ui-message">Message Box</a></li>
<li><a href="#ui-range">Target/Range Selector</a></li>
</ul></li>
<li><a href="#dialogue-styles">Dialogue Styles</a>
<ul>
<li><a href="#style-dialogue">Dialogue</a></li>
<li><a href="#style-bubble">Speech Bubble</a></li>
<li><a href="#style-notification">Notification</a></li>
</ul>
<li><a href="#support">Support</a></li>
</ol>
</details>

<p align="right">(<a href="#theatre">back to top</a>)</p>


## <a id="getting-started" name="getting-started"></a>Getting Started
Theatre! operates on two wave-lengths.
1. Message-Box style dialogue delivery, which comes across in a 'type-writer' style of one character at a time.  You can queue up several 'pages' at once and it will be sent to all players, displayed with the image of the token that is currently selected.
2. Speech Bubble style dialogue delivery, which let's you choose a token and select 'How Loud' they are saying their message.  It will then be drawn on the map via a text bubble, and only players who have a token in range will be able to hear (see) it.
<p align="right">(<a href="#theatre">back to top</a>)</p>

## <a id="theatre-ui" name="theatre-ui">Theatre UI
<i>Note: All players have access to the Theatre UI, but only the GM can change the speech bubble ranges.</i>
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-ui.png)

#### <a id="ui-token"></a>1. Token Selector
The Token Selector compiles a list of all tokens the user has access to, using the label name - or the default token name if no label name is available.
When used with Dialogue-Style/Notification-Style, this controls which image/name is used for the dialogue window.
When used with Bubble-Style, this controls where the speech bubble will appear from and where the range is based on.
<i>Note: The input will pulse red briefly if there is a change on the map that would've resulted in a change in the list, to let you know the selection may have changed.</i>

#### <a id="ui-override"></a>2. Override Input
The Override input is to 'override' the token name that is displayed with the displayed text.
Useful if you want to obscure something's 'true name' but still use the image.

#### <a id="ui-style"></a>3. Style Selector
There are three different chat styles to choose from.  Dialogue, Speech Bubble and Notification.  While Dialogue and Notification differ mostly in orientation (dialogue is a long narrow window, while notification is more of a poster) - speech bubble is completely different.
1. Dialogue Style
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-style1.png)

2. Notification Style 
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-style3.png)
3. Speech Bubble Style
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-style2.png)
<i>Note: Only players who own a token in the range of the token speaking via Speech Bubble will be able to see it. Please make sure your players are properly owning tokens!</i>

#### <a id="ui-speech"></a>4. Speech Range Inputs
These inputs only have an effect when using Speech Bubbles, as they discern the 'hearable' range for the text.  This number represents how many units away a token can be to hear/see the message.

#### <a id="ui-message"></a>5. Message Box
This is where you will type the message that appears in the dialogue window or speech bubble. 
When using the Dialogue/Notification window, you can use '::' to separate the pages for that message. For example;
"Hello, friend!::How are you?"
<i>Note: Paging is not available with Speech Bubbles.</i>
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-pages.webp)

#### <a id="ui-range"></a>6. Target/Range Selector
When on the Dialogue or Notification styles, you can select a 'target' for your message.  It can be sent to the entire party, or just a single person.
When using Speech Bubble style, you can choose which 'volume/range' you want your message to reach. If you have whisper set to 1 square, people 2 squares away or more won't be able to see it!

<p align="right">(<a href="#theatre">back to top</a>)</p>

## <a id="dialogue-styles" name="dialogue-styles">Dialogue Styles

#### <a id="style-dialogue"></a>1. Dialogue
The Dialogue style is your typical JRPG text-box that display in type-writer fashion.  If there are pages of text, a 'Next' arrow will flash next to where the close button is.
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-style1.png)
#### <a id="style-bubble"></a>2. Speech Bubble
Speech Bubbles are more of a chat-system than a post-it message, and is likely better suited to the style of game that wants to have more RP-based chats.  If you have 'View on Send' checked, you will also see the resulting speech bubble pop up on the token it was sent from.
There are some things to note in how it's used;
1. The outline and casing of the message is based on the volume.  Whispers are lower-cased and Blue. Talking is as-is and White.  Yelling is upper-cased and Red.
![notice view](https://battle-system.com/owlbear/theatre-docs/ui-speech1.png)
![notice view](https://battle-system.com/owlbear/theatre-docs/ui-speech2.png)
![notice view](https://battle-system.com/owlbear/theatre-docs/ui-speech3.png)
2. Who can see the message is based on WHERE the token is, what RANGE the token said the message at and WHO owns which tokens. As with the example below, Greensley cannot hear the whisper until he is 1 square away. (I have Whisper range set to 1 in this example.) ![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-whisper.webp)
And the following example shows a Yell, where the range is set to 20 squares.  So Greensley is able to see this despite not being close at all.
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-yell.webp)
3. For the person who sent the message, if you have 'View on Send' turned on - the speech bubble will stay attached to that character if you move the token.  THIS DOES NOT HAPPEN ON THE OTHER USERS END. To make it clear where something was said, the bubble stays where it was made.  You wouldn't want to whisper something, and then walk up to someone, and have that whisper travel with you right? No. (The correct answer is no.) The whisper stays where the whisper was made.
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-fart.webp)
<i>Note: I am aware that farts travel.</i>
4. Speech bubbles stay open until they are either closed (via the X button), the page is refreshed or until a new message is sent.  A new message will replace an old message. They are not queued up, it's similar to them talking too fast.


#### <a id="style-notification"></a>3. Notification
The notification style mimics the dialogue one, but in a 'poster' fashion. It's more suited to pre-prepped copy/pasted text as the formatting can be fickle at times. (Improvements to this will be made at a later date.)
![notice view](https://battle-system.com/owlbear/theatre-docs/theatre-notification.png)

<p align="right">(<a href="#theatre">back to top</a>)</p>

## Support

If you have questions, please join the [Owlbear Rodeo Discord](https://discord.gg/UY8AXjhzhe).

Or you can reach out to me at manuel@battle-system.com.
You can also support these projects at the [Battle-System Patreon](https://www.patreon.com/battlesystem).
<p align="right">(<a href="#flip">back to top</a>)</p>
`}export{xn as C,bn as O,Ln as a,Mn as b,C as c};
