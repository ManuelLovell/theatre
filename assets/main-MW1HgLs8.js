import{O as n,S as h,G as p,C as i}from"./utilities-UC5jPV8m.js";function f(m){return m.type==="IMAGE"}let l,d,T=[],s=[],u="",g={};await n.onReady(async()=>{await n.scene.isReady()&&await I(),n.scene.onReadyChange(async r=>{r?await I():document.querySelector("#app").innerHTML=""});async function I(){if(l=await n.player.getRole(),d=(await n.theme.getTheme()).mode,h(d,document),w(),l!=="GM"){document.getElementById("app").innerHTML=`<b>LOG HISTORY</b><div class="full-container">
                    <ul id="dialogLog">
                    </ul>
                </div>`;return}document.querySelector("#app").innerHTML=`
        <label for="CharacterSelect">Character:</label>
        <select id="CharacterSelect"></select>
        
        <label for="MessageTextarea">Message:</label>
        <textarea id="MessageTextarea" rows="4" cols="50"></textarea>
        
        <button id="sendMessage">SUBMIT</button>`;const r=document.getElementById("sendMessage");r.onclick=async()=>await S(),s=await n.scene.items.getItems(e=>e.layer==="CHARACTER"&&f(e)),E(),n.scene.items.onChange(async e=>{s=e.filter(t=>f(t));const a=s.map(t=>t.id);a.every(t=>T.includes(t))||(E(),T=a)});async function S(){const e=document.getElementById("CharacterSelect"),a=document.getElementById("MessageTextarea");if(!a.value.trim())return console.log("NO MESSAGE");const t=s.find(M=>M.id===e.value);if(!t||!t.image?.url)return console.log("NO IMAGE");const o=p(),c={Id:e.value,Name:t.name,ImageUrl:t.image.url,Message:a.value==="test"?i.FRESHPRINCE:a.value,Code:o,Created:new Date().toLocaleTimeString()},N={[`${i.EXTENSIONID}/dialogueBox`]:c,[`${i.EXTENSIONID}/dialogueCode`]:o};await n.scene.setMetadata(N),await n.scene.setMetadata({[`${i.EXTENSIONID}/dialogueCode`]:void 0})}function C(e,a,t="DIALOG"){const o=`${a}_${t}}`,c=g[o];return c?c!==e?(g[o]=e,!1):!0:(g[o]=e,!1)}async function y(e){const a=document.querySelector("#dialogLog");if(e[`${i.EXTENSIONID}/dialogueBox`]!=null){const t=e[`${i.EXTENSIONID}/dialogueBox`];if(!C(t.Created,"DIALOG","DIALOG")){const o=document.createElement("li");o.innerHTML=`<div class="author">${t.Name}:</div>âž¤ ${t.Message.trim()}`,a.append(o)}}}function w(){n.theme.onChange(e=>{d=e.mode,h(e.mode,document)}),n.scene.onMetadataChange(async e=>{const a=e[`${i.EXTENSIONID}/dialogueCode`];if(a!==void 0){a!==u&&await n.popover.close(i.EXTENSIONID),u=e[`${i.EXTENSIONID}/dialogueCode`];const t=await n.viewport.getWidth()-100,o=await n.viewport.getHeight()-250;await n.popover.open({id:i.EXTENSIONID,url:`/submenu/subindex.html?code=${u}`,height:200,width:t,hidePaper:!0,disableClickAway:!0,anchorPosition:{top:o,left:50},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"LEFT"},transformOrigin:{vertical:"CENTER",horizontal:"LEFT"}}),l==="PLAYER"&&await y(e)}})}function E(){const e=document.getElementById("CharacterSelect");e.innerHTML="",s.forEach(a=>{const t=document.createElement("option");t.value=a.id,t.text=a.name,e.add(t)})}}});
